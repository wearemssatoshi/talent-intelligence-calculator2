<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SVD MINDFUL v5.0</title>
    <!-- v5.0: „Éò„ÉÉ„ÉÄ„ÉºÊ®™‰∏¶„Å≥„ÄÅÂÜôÁúüÊ∞∏Á∂öÂåñ„ÄÅÊã†ÁÇπÁßªÁ±çÊ©üËÉΩ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="SVD MINDFUL">
    <link rel="apple-touch-icon" sizes="180x180" href="logo/SVD_icon_square.png">
    <link rel="apple-touch-icon" sizes="152x152" href="logo/SVD_icon_square.png">
    <link rel="apple-touch-icon" sizes="120x120" href="logo/SVD_icon_square.png">
    <link rel="apple-touch-icon" href="logo/SVD_icon_square.png">
    <link rel="icon" type="image/png" href="logo/SVD_icon_square.png">
    <link rel="manifest" href="manifest.json">
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Inter:wght@400;500;600&family=Shippori+Mincho:wght@400;600&family=Noto+Sans+JP:wght@400;500;700&display=swap"
        rel="stylesheet">
    <!-- PDF.js for in-app PDF viewing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        :root {
            --white: #FFFFFF;
            --off-white: #FAFAFA;
            --light-gray: #F5F5F5;
            --navy: #1E3A5F;
            --navy-dark: #0F2A4A;
            --gold: #C9A962;
            --gold-light: rgba(201, 169, 98, 0.15);
            --gold-glow: rgba(201, 169, 98, 0.3);
            --text-dark: #1E3A5F;
            --text-gray: #6B7B8C;
            --border: rgba(30, 58, 95, 0.1);
            --success: #22C55E;
            --warning: #F59E0B;
            --danger: #EF4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* „É¢„Éº„ÉÄ„É´Ë°®Á§∫ÊôÇ„ÅÆbody„Çπ„ÇØ„É≠„Éº„É´ÁÑ°ÂäπÂåñ */
        body.modal-open {
            overflow: hidden;
            /* position: fixed „ÇíÂâäÈô§ - iOSÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„Å®„ÅÆ‰∫íÊèõÊÄßÂêë‰∏ä */
        }

        body {
            font-family: 'Shippori Mincho', serif;
            background-color: var(--off-white);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            padding: 12px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            background: rgba(255, 255, 255, 0.94);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            position: sticky;
            top: 0;
            z-index: 9999;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.04);
        }

        .header-main {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .logo-container {
            display: flex;
            align-items: center;
        }

        .logo-container img {
            height: 32px;
        }

        h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 24px;
            font-weight: 600;
            letter-spacing: 0.12em;
            color: var(--navy);
            margin: 0;
        }

        .header-sub {
            font-family: 'Montserrat', sans-serif;
            font-size: 10px;
            color: var(--gold);
            letter-spacing: 0.25em;
            margin-top: 4px;
            font-weight: 500;
        }

        .user-badge {
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            color: var(--text-gray);
            margin-top: 10px;
            padding: 5px 14px;
            background: var(--light-gray);
            border-radius: 20px;
            display: inline-block;
        }

        /* TOKEN SYSTEM */
        .token-display {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, rgba(201, 169, 98, 0.15), rgba(201, 169, 98, 0.05));
            border: 1px solid var(--gold);
            padding: 6px 14px;
            border-radius: 25px;
            margin-top: 10px;
            margin-left: 8px;
        }

        .token-icon {
            font-size: 16px;
            animation: coinSpin 3s linear infinite;
        }

        @keyframes coinSpin {

            0%,
            100% {
                transform: rotateY(0deg);
            }

            50% {
                transform: rotateY(180deg);
            }
        }

        .token-balance {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 13px;
            color: var(--gold);
        }

        .token-label {
            font-family: 'Montserrat', sans-serif;
            font-size: 9px;
            letter-spacing: 0.1em;
            color: var(--text-gray);
        }

        /* TOKEN EARNED ANIMATION */
        .token-earned-container {
            text-align: center;
            margin: 20px 0;
        }

        .token-earned-badge {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 30px;
            background: linear-gradient(145deg, var(--navy), var(--navy-dark));
            border: 2px solid var(--gold);
            border-radius: 16px;
            box-shadow: 0 0 30px var(--gold-glow);
            animation: tokenPulse 2s ease-in-out infinite;
        }

        @keyframes tokenPulse {

            0%,
            100% {
                box-shadow: 0 0 20px var(--gold-glow);
            }

            50% {
                box-shadow: 0 0 40px var(--gold), 0 0 60px var(--gold-glow);
            }
        }

        .token-earned-icon {
            font-size: 40px;
            margin-bottom: 8px;
            animation: tokenBounce 0.6s ease-out;
        }

        @keyframes tokenBounce {
            0% {
                transform: scale(0) rotate(-45deg);
            }

            50% {
                transform: scale(1.2) rotate(10deg);
            }

            100% {
                transform: scale(1) rotate(0);
            }
        }

        .token-earned-amount {
            font-family: 'Montserrat', sans-serif;
            font-size: 28px;
            font-weight: 700;
            color: var(--gold);
            text-shadow: 0 0 12px var(--gold-glow);
        }

        .token-earned-label {
            font-family: 'Montserrat', sans-serif;
            font-size: 10px;
            letter-spacing: 0.2em;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 4px;
        }

        .token-breakdown {
            margin-top: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
        }

        .token-breakdown-item {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }

        main {
            flex-grow: 1;
            padding: 22px;
            overflow-y: auto;
            padding-bottom: 120px;
            position: relative;
            z-index: 0;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        /* PDF„Éì„É•„Éº„ÉØ„ÉºÂ∞ÇÁî®: active„ÅÆÊôÇ„ÅØflex„Å´ */
        #screen-pdf-viewer.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 11px;
            color: var(--gold);
            letter-spacing: 0.25em;
            text-transform: uppercase;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }

        .section-title::before,
        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--gold-light), transparent);
        }

        /* REGISTRATION */
        .register-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px 25px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
        }

        .register-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 8px;
            letter-spacing: 0.05em;
            color: var(--navy);
        }

        .register-sub {
            font-size: 13px;
            color: var(--text-gray);
            margin-bottom: 25px;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-label {
            font-family: 'Montserrat', sans-serif;
            font-size: 10px;
            color: var(--gold);
            letter-spacing: 0.15em;
            margin-bottom: 8px;
            display: block;
            font-weight: 600;
        }

        .text-input {
            width: 100%;
            background: var(--light-gray);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px 16px;
            color: var(--text-dark);
            font-family: 'Inter', sans-serif;
            font-size: 15px;
        }

        .text-input::placeholder {
            color: var(--text-gray);
        }

        .text-input:focus {
            outline: none;
            border-color: var(--gold);
        }

        .base-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .base-option {
            padding: 16px 12px;
            background: var(--light-gray);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .base-option:hover {
            border-color: var(--gold);
        }

        .base-option.selected {
            border-color: var(--gold);
            background: var(--gold-light);
        }

        .base-icon {
            font-size: 24px;
            margin-bottom: 6px;
        }

        .base-name {
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            font-weight: 600;
            color: var(--navy);
        }

        .base-code {
            font-family: 'Montserrat', sans-serif;
            font-size: 9px;
            color: var(--text-gray);
            letter-spacing: 0.1em;
            margin-top: 3px;
        }

        /* PRINCIPLES */
        .principle-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
        }

        .principle-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--gold), rgba(201, 169, 98, 0.3));
        }

        .principle-num {
            font-family: 'Montserrat', sans-serif;
            font-size: 18px;
            color: var(--gold);
            letter-spacing: 0.05em;
            font-weight: 700;
        }

        .principle-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 11px;
            font-weight: 600;
            margin: 2px 0 8px 0;
            letter-spacing: 0.05em;
            color: var(--navy);
        }

        .principle-desc {
            font-size: 12px;
            color: var(--text-gray);
            line-height: 1.7;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding-top 0.3s ease;
            padding-top: 0;
        }

        .principle-card.expanded .principle-desc {
            max-height: 300px;
            padding-top: 10px;
        }

        .principle-card {
            cursor: pointer;
        }

        .principle-card::after {
            content: '‚ñº';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 10px;
            color: var(--gold);
            transition: transform 0.3s ease;
        }

        .principle-card.expanded::after {
            transform: rotate(180deg);
        }

        /* HEALTH CHECK */
        .health-check-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 18px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
        }

        .health-check-card.complete {
            border-color: rgba(34, 197, 94, 0.4);
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.05), var(--white));
        }

        .health-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: 0.05em;
            color: var(--navy);
        }

        .health-title .icon {
            font-size: 18px;
        }

        .check-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .check-item:last-child {
            border-bottom: none;
        }

        .check-label {
            font-size: 13px;
            color: var(--text-dark);
            flex: 1;
        }

        .check-toggle {
            display: flex;
            gap: 6px;
        }

        .toggle-btn {
            padding: 7px 14px;
            border-radius: 18px;
            border: 1px solid var(--border);
            background: var(--light-gray);
            color: var(--text-gray);
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .toggle-btn.ok.selected {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .toggle-btn.ng.selected {
            background: var(--danger);
            border-color: var(--danger);
            color: white;
        }

        .toggle-btn.selected {
            background: var(--gold);
            border-color: var(--gold);
            color: white;
        }

        .health-status {
            text-align: center;
            padding: 12px;
            margin-top: 12px;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 12px;
        }

        .health-status.ok {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
        }

        .health-status.incomplete {
            background: var(--light-gray);
            color: var(--text-gray);
        }

        .health-status.ng {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .health-status.warning {
            background: rgba(201, 169, 98, 0.15);
            color: var(--gold);
            border: 1px solid var(--gold);
        }

        /* DRAW AREA */
        .draw-area {
            text-align: center;
            padding: 25px 20px;
            margin-top: 12px;
        }

        .draw-area.disabled {
            opacity: 0.25;
            pointer-events: none;
        }

        .draw-card-back {
            width: 140px;
            height: 190px;
            margin: 0 auto;
            background: var(--white);
            background-image: url('./logo/SVD_logo_standard.png');
            background-size: 85%;
            background-repeat: no-repeat;
            background-position: center 35%;
            border: 2px solid var(--border);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            padding-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .draw-card-back::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 1px solid var(--border);
            border-radius: 8px;
        }

        .draw-card-back:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
            border-color: var(--gold);
        }

        .draw-logo {
            display: none;
        }

        .draw-subtitle {
            font-family: 'Montserrat', sans-serif;
            font-size: 8px;
            color: var(--navy);
            letter-spacing: 0.2em;
            margin-top: 5px;
        }

        .draw-hint {
            font-family: 'Inter', sans-serif;
            font-size: 10px;
            color: var(--text-gray);
            margin-top: 18px;
            opacity: 0.7;
        }

        /* QUEST CARDS CONTAINER */
        .quest-cards-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .quest-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 18px;
            text-align: center;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
            animation: revealCard 0.5s ease;
            display: none;
            position: relative;
            overflow: hidden;
        }

        .quest-card::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 90%;
            background-image: url('logo/SVD_logo_standard.png');
            background-size: 77%;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.12;
            pointer-events: none;
            z-index: 0;
        }

        .quest-card>* {
            position: relative;
            z-index: 1;
        }

        .quest-card.revealed {
            display: block;
        }

        @keyframes revealCard {
            0% {
                opacity: 0;
                transform: scale(0.9) rotateY(90deg);
            }

            50% {
                opacity: 1;
                transform: scale(1.02) rotateY(0deg);
            }

            100% {
                transform: scale(1);
            }
        }

        .quest-label {
            font-family: 'Montserrat', sans-serif;
            font-size: 9px;
            color: var(--gold);
            letter-spacing: 0.25em;
            font-weight: 600;
        }

        .quest-number {
            font-family: 'Montserrat', sans-serif;
            font-size: 32px;
            font-weight: 700;
            color: var(--navy);
            text-shadow: none;
            margin: 4px 0;
        }

        .quest-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
            letter-spacing: 0.02em;
            color: var(--navy);
        }

        .quest-subtitle {
            font-size: 12px;
            color: var(--text-gray);
            margin-bottom: 8px;
        }

        .quest-philosophy {
            font-size: 12px;
            line-height: 1.7;
            background: rgba(245, 247, 250, 0.65);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 12px;
            border-radius: 8px;
            margin-top: 8px;
            color: var(--navy);
            font-weight: 500;
        }

        /* BUTTONS */
        .btn-main {
            background: var(--gold);
            color: var(--navy-dark);
            border: none;
            padding: 15px;
            border-radius: 50px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 13px;
            letter-spacing: 0.1em;
            width: 100%;
            cursor: pointer;
            box-shadow: 0 4px 15px var(--gold-glow);
            transition: all 0.2s;
            margin-top: 18px;
        }

        .btn-main:disabled {
            opacity: 0.25;
            cursor: not-allowed;
        }

        .btn-main:hover:not(:disabled) {
            box-shadow: 0 6px 20px var(--gold-glow);
        }

        .btn-main:active:not(:disabled) {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-gray);
            padding: 11px;
            border-radius: 50px;
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            width: 100%;
            cursor: pointer;
            margin-top: 8px;
        }

        .btn-secondary:hover {
            border-color: var(--gold);
            color: var(--gold);
        }

        /* ACTIVE DAY */
        .active-quests-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .active-quest-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 18px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
            position: relative;
            overflow: hidden;
        }

        .active-quest-card::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 90%;
            background-image: url('logo/SVD_logo_standard.png');
            background-size: 77%;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.10;
            pointer-events: none;
            z-index: 0;
        }

        .active-quest-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--gold), rgba(201, 169, 98, 0.3));
        }

        .active-quest-card>* {
            position: relative;
            z-index: 1;
        }

        .active-quest-card .quest-number {
            font-size: 36px;
            color: var(--navy);
            text-shadow: none;
        }

        .active-quest-card .quest-title {
            color: var(--navy);
            font-size: 14px;
        }

        .active-quest-card .quest-subtitle {
            color: var(--text-gray);
            font-size: 11px;
        }

        .active-quest-card .quest-philosophy {
            background: var(--light-gray);
            color: var(--text-dark);
            font-size: 11px;
        }

        /* KIRARA CARD SYSTEM */
        .kirara-card {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #1a1a2e 75%, #16213e 100%);
            border: 2px solid rgba(201, 169, 98, 0.6);
            border-radius: 14px;
            padding: 18px;
            text-align: center;
            box-shadow: 0 0 20px rgba(201, 169, 98, 0.3), 0 0 60px rgba(201, 169, 98, 0.1);
            position: relative;
            overflow: hidden;
            animation: kirara-entrance 1.2s ease-out;
        }

        .kirara-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent 0%, rgba(255, 215, 0, 0.08) 10%, transparent 20%, rgba(201, 169, 98, 0.06) 30%, transparent 40%, rgba(255, 255, 255, 0.05) 50%, transparent 60%, rgba(255, 215, 0, 0.08) 70%, transparent 80%, rgba(201, 169, 98, 0.06) 90%, transparent 100%);
            animation: kirara-rotate 4s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        .kirara-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at 30% 20%, rgba(255, 215, 0, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(201, 169, 98, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .kirara-card>* {
            position: relative;
            z-index: 1;
        }

        .kirara-rarity {
            font-family: 'Montserrat', sans-serif;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.15em;
            padding: 3px 10px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 6px;
        }

        .kirara-rarity.sr {
            background: linear-gradient(135deg, rgba(192, 192, 192, 0.3), rgba(255, 255, 255, 0.15));
            color: #C0C0C0;
            border: 1px solid rgba(192, 192, 192, 0.4);
        }

        .kirara-rarity.ssr {
            background: linear-gradient(135deg, rgba(201, 169, 98, 0.3), rgba(255, 215, 0, 0.15));
            color: #FFD700;
            border: 1px solid rgba(255, 215, 0, 0.4);
        }

        .kirara-rarity.ur {
            background: linear-gradient(135deg, rgba(255, 0, 128, 0.2), rgba(255, 215, 0, 0.2), rgba(0, 191, 255, 0.2));
            color: #FFF;
            border: 1px solid rgba(255, 215, 0, 0.5);
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
        }

        .kirara-particles {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .kirara-particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #FFD700;
            border-radius: 50%;
            animation: kirara-float 3s ease-in-out infinite;
            box-shadow: 0 0 6px rgba(255, 215, 0, 0.6);
        }

        @keyframes kirara-entrance {
            0% {
                opacity: 0;
                transform: scale(0.5) rotateY(180deg);
            }

            40% {
                opacity: 1;
                transform: scale(1.08) rotateY(0deg);
            }

            60% {
                transform: scale(0.96);
            }

            80% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes kirara-rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @keyframes kirara-float {

            0%,
            100% {
                opacity: 0;
                transform: translateY(0) scale(0);
            }

            20% {
                opacity: 1;
                transform: translateY(-15px) scale(1);
            }

            80% {
                opacity: 0.6;
                transform: translateY(-50px) scale(0.5);
            }
        }

        .kirara-collection {
            margin-top: 16px;
            padding: 16px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 14px;
            border: 1px solid rgba(201, 169, 98, 0.2);
        }

        .kirara-collection-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.1em;
            color: var(--gold);
            margin-bottom: 12px;
        }

        .kirara-collection-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .kirara-slot {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 700;
            transition: all 0.3s;
        }

        .kirara-slot.locked {
            background: rgba(255, 255, 255, 0.05);
            border: 1px dashed rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.2);
            font-size: 12px;
        }

        .kirara-slot.unlocked {
            background: linear-gradient(135deg, rgba(201, 169, 98, 0.2), rgba(255, 215, 0, 0.1));
            border: 1px solid rgba(201, 169, 98, 0.4);
            color: #FFD700;
            box-shadow: 0 0 10px rgba(201, 169, 98, 0.2);
            font-size: 11px;
        }

        .kirara-slot.unlocked.ur-slot {
            background: linear-gradient(135deg, rgba(255, 0, 128, 0.15), rgba(255, 215, 0, 0.15), rgba(0, 191, 255, 0.15));
            border: 1px solid rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        .countdown-section {
            text-align: center;
            margin-top: 25px;
            padding: 20px;
            background: var(--white);
            border-radius: 14px;
            border: 1px solid var(--border);
        }

        .countdown-label {
            font-family: 'Montserrat', sans-serif;
            font-size: 10px;
            color: var(--text-gray);
            letter-spacing: 0.2em;
        }

        .countdown-time {
            font-family: 'Montserrat', sans-serif;
            font-size: 36px;
            font-weight: 600;
            color: var(--navy);
            margin-top: 5px;
        }

        /* REFLECTION */
        .reflection-prompt {
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 22px;
            line-height: 1.7;
            color: var(--navy);
        }

        .star-rating {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 22px;
        }

        .star {
            font-size: 36px;
            cursor: pointer;
            color: var(--light-gray);
            transition: all 0.2s;
        }

        .star.active,
        .star:hover {
            color: var(--gold);
            transform: scale(1.1);
        }

        .memo-input {
            width: 100%;
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px;
            color: var(--text-dark);
            font-family: 'Shippori Mincho', serif;
            font-size: 13px;
            resize: none;
            height: 90px;
            line-height: 1.7;
        }

        .memo-input::placeholder {
            color: var(--text-gray);
        }

        .memo-input:focus {
            outline: none;
            border-color: var(--gold);
        }

        /* COMPLETION */
        .completion-icon {
            font-size: 60px;
            text-align: center;
            margin-bottom: 18px;
        }

        .completion-message {
            font-family: 'Montserrat', sans-serif;
            font-size: 24px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 6px;
            color: var(--navy);
        }

        .completion-sub {
            font-size: 13px;
            color: var(--text-gray);
            text-align: center;
            line-height: 1.7;
        }

        /* HISTORY */
        .history-item {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.02);
        }

        .history-date {
            font-family: 'Inter', sans-serif;
            font-size: 10px;
            color: var(--text-gray);
        }

        .history-quest {
            font-family: 'Montserrat', sans-serif;
            font-size: 12px;
            font-weight: 600;
            color: var(--navy);
        }

        .history-stars {
            color: var(--gold);
            font-size: 12px;
        }

        /* FOOTER */
        footer {
            padding: 12px;
            text-align: center;
            border-top: 1px solid var(--border);
            background: var(--white);
            font-family: 'Montserrat', sans-serif;
            font-size: 9px;
            letter-spacing: 0.3em;
            color: var(--text-gray);
        }

        /* NAV */
        nav {
            display: flex;
            border-top: 1px solid var(--border);
            background: var(--white);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.03);
        }

        .nav-item {
            flex: 1;
            padding: 11px 0;
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            font-size: 8px;
            letter-spacing: 0.05em;
            color: var(--text-gray);
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-item.active {
            color: var(--gold);
        }

        .nav-icon {
            font-size: 16px;
            margin-bottom: 2px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .nav-icon svg {
            width: 20px;
            height: 20px;
            stroke: var(--text-gray);
            fill: none;
            stroke-width: 1.8;
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: stroke 0.2s;
        }

        .nav-item.active .nav-icon svg {
            stroke: var(--gold);
        }

        /* INSIGHT - ARTICLE CAROUSEL */
        .article-carousel {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .article-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: block;
        }

        .article-card:hover {
            border-color: var(--gold);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .article-source {
            font-family: 'Montserrat', sans-serif;
            font-size: 9px;
            color: var(--gold);
            letter-spacing: 0.1em;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .article-title {
            font-family: 'Shippori Mincho', serif;
            font-size: 14px;
            font-weight: 600;
            color: var(--navy);
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .article-date {
            font-family: 'Inter', sans-serif;
            font-size: 10px;
            color: var(--text-gray);
        }

        .article-loading {
            text-align: center;
            padding: 30px;
            color: var(--text-gray);
            font-size: 12px;
        }

        /* INSIGHT - AI CHAT */
        .ai-chat-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
        }

        .ai-intro {
            text-align: center;
            font-size: 12px;
            color: var(--text-gray);
            margin-bottom: 16px;
            padding: 12px;
            background: var(--light-gray);
            border-radius: 10px;
        }

        .ai-intro-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .chat-messages {
            min-height: 120px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 16px;
            padding: 8px;
        }

        .chat-bubble {
            padding: 12px 16px;
            border-radius: 16px;
            margin-bottom: 10px;
            font-size: 13px;
            line-height: 1.6;
            max-width: 85%;
            animation: fadeIn 0.3s ease;
        }

        .chat-bubble.user {
            background: linear-gradient(135deg, var(--navy), var(--navy-dark));
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .chat-bubble.ai {
            background: var(--light-gray);
            color: var(--text-dark);
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }

        .chat-bubble.ai .ai-name {
            font-family: 'Montserrat', sans-serif;
            font-size: 10px;
            color: var(--gold);
            font-weight: 600;
            margin-bottom: 6px;
        }

        .ai-token-notice {
            margin-top: 10px;
            padding: 6px 10px;
            background: rgba(201, 169, 98, 0.15);
            border-radius: 8px;
            font-size: 11px;
            color: var(--gold);
            font-weight: 600;
            text-align: center;
        }

        .chat-input-area {
            display: flex;
            gap: 10px;
        }

        .chat-input-area input {
            flex: 1;
            background: var(--light-gray);
            border: 1px solid var(--border);
            border-radius: 25px;
            padding: 12px 18px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            color: var(--text-dark);
        }

        .chat-input-area input:focus {
            outline: none;
            border-color: var(--gold);
        }

        .chat-input-area button {
            background: var(--gold);
            color: var(--navy-dark);
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chat-input-area button:hover {
            box-shadow: 0 4px 12px var(--gold-glow);
        }

        .chat-input-area button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .ai-typing {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 12px 16px;
        }

        .ai-typing span {
            width: 8px;
            height: 8px;
            background: var(--gold);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .ai-typing span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .ai-typing span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            60%,
            100% {
                transform: translateY(0);
                opacity: 0.4;
            }

            30% {
                transform: translateY(-6px);
                opacity: 1;
            }
        }

        /* SENDING OVERLAY */
        .sending-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }

        .sending-overlay.active {
            display: flex;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--light-gray);
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .sending-text {
            font-family: 'Montserrat', sans-serif;
            font-size: 12px;
            color: var(--text-gray);
            margin-top: 15px;
            letter-spacing: 0.1em;
        }

        /* TO-DO LIST */
        .todo-container {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
            margin-bottom: 20px;
        }

        .todo-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .todo-tab {
            flex: 1;
            padding: 10px 8px;
            background: var(--light-gray);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 0.1em;
            color: var(--text-gray);
            cursor: pointer;
            transition: all 0.2s;
        }

        .todo-tab:hover {
            border-color: var(--gold);
            color: var(--gold);
        }

        .todo-tab.active {
            background: var(--gold);
            border-color: var(--gold);
            color: var(--navy-dark);
        }

        .todo-content {
            display: none;
        }

        .todo-content.active {
            display: block;
        }

        .todo-input-area {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .todo-input-area input {
            flex: 1;
            padding: 12px 14px;
            background: var(--light-gray);
            border: 1px solid var(--border);
            border-radius: 10px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            color: var(--text-dark);
        }

        .todo-input-area input::placeholder {
            color: var(--text-gray);
        }

        .todo-input-area input:focus {
            outline: none;
            border-color: var(--gold);
        }

        .todo-input-area button {
            width: 44px;
            height: 44px;
            background: var(--gold);
            border: none;
            border-radius: 10px;
            font-size: 20px;
            font-weight: 700;
            color: var(--navy-dark);
            cursor: pointer;
            transition: all 0.2s;
        }

        .todo-input-area button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px var(--gold-glow);
        }

        .todo-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .todo-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: var(--light-gray);
            border-radius: 10px;
            transition: all 0.2s;
        }

        .todo-item.completed {
            opacity: 0.6;
        }

        .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: var(--text-gray);
        }

        .todo-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .todo-checkbox:hover {
            border-color: var(--gold);
        }

        .todo-checkbox.checked {
            background: var(--gold);
            border-color: var(--gold);
        }

        .todo-checkbox.checked::after {
            content: '‚úì';
            color: var(--navy-dark);
            font-size: 14px;
            font-weight: 700;
        }

        .todo-text {
            flex: 1;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            color: var(--navy);
        }

        .todo-delete {
            width: 28px;
            height: 28px;
            background: transparent;
            border: none;
            border-radius: 6px;
            color: var(--text-gray);
            cursor: pointer;
            font-size: 16px;
            opacity: 0.5;
            transition: all 0.2s;
        }

        .todo-delete:hover {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            opacity: 1;
        }

        .todo-empty {
            text-align: center;
            padding: 20px;
            color: var(--text-gray);
            font-size: 12px;
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body>

    <header>
        <div class="header-main">
            <div class="logo-container">
                <img src="logo/SVD_logo_standard.png" alt="SVD" onerror="this.style.display='none'">
            </div>
            <h1>MINDFUL</h1>
        </div>
        <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 4px;">
            <div class="header-sub">IGNITION ‚Äî GET YOUR GREEN LIGHT</div>
            <div
                style="font-family: 'Montserrat', sans-serif; font-size: 9px; color: var(--gold); letter-spacing: 0.1em; font-weight: 500; opacity: 0.8;">
                v5.0</div>
        </div>
        <div style="display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 5px;">
            <div class="user-badge" id="userBadge" style="display: none;"></div>
            <div class="token-display" id="tokenDisplay" style="display: none;">
                <span class="token-icon">ü™ô</span>
                <span class="token-balance" id="tokenBalance">0</span>
                <span class="token-label">TOKEN</span>
            </div>
        </div>
        <!-- Goals Display - Accordion Style -->
        <div id="goalsDisplay"
            style="display: none; margin-top: 12px; max-width: 350px; margin-left: 12px; margin-right: auto; text-align: left;">
            <div id="goalsAccordionHeader"
                style="padding: 12px 16px; background: var(--gold-light); border: 1px solid var(--gold); border-radius: 12px; cursor: pointer; transition: all 0.3s;"
                onclick="toggleGoalsAccordion()">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div id="goalsPhotoContainerHeader"
                            style="width: 36px; height: 36px; border-radius: 50%; background: var(--light-gray); border: 2px solid var(--gold); display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0;">
                            <img id="goalsPhotoHeader" src=""
                                style="width: 100%; height: 100%; object-fit: cover; display: none;">
                            <span id="goalsPhotoPlaceholderHeader" style="font-size: 18px;">üë§</span>
                        </div>
                        <div
                            style="font-family: 'Montserrat', sans-serif; font-size: 10px; color: var(--gold); letter-spacing: 0.1em; font-weight: 600;">
                            üìå MY VISION
                        </div>
                    </div>
                    <span id="goalsAccordionArrow"
                        style="font-size: 12px; color: var(--gold); transition: transform 0.3s;">‚ñº</span>
                </div>
            </div>
            <div id="goalsAccordionContent"
                style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; background: var(--gold-light); border: 1px solid var(--gold); border-top: none; border-radius: 0 0 12px 12px; margin-top: -1px;">
                <div style="padding: 12px 16px;">
                    <div style="font-size: 11px;">
                        <div style="color: var(--navy); margin-bottom: 10px;">
                            <strong style="color: var(--gold);">üéØ ‰ªäÂπ¥„ÅÆÁõÆÊ®ô</strong>
                            <div id="goalsThisYearList" style="margin-top: 3px; color: var(--text-gray);">-</div>
                        </div>
                        <div style="color: var(--navy);">
                            <strong style="color: var(--gold);">‚ú® SVD„ÅßÂè∂„Åà„Åü„ÅÑ„Ç≠„É£„É™„Ç¢„Åæ„Åü„ÅØÂ∞ÜÊù•„ÅÆÂ§¢</strong>
                            <div id="goalsFutureList" style="margin-top: 3px; color: var(--text-gray);">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <!-- SCREEN 0: REGISTRATION -->
        <div class="screen" id="screen-register">
            <div class="register-card">
                <div class="register-title">Welcome to MINDFUL</div>
                <div class="register-sub">„ÅÇ„Å™„Åü„ÅÆÊÉÖÂ†±„ÇíÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                <div class="input-group">
                    <label class="input-label">YOUR NAME</label>
                    <input type="text" class="text-input" id="inputName" placeholder="‰æã: Â±±Áî∞Â§™ÈÉé">
                </div>
                <div class="input-group">
                    <label class="input-label">üîê PINÔºà4Ê°Å„ÅÆÊï∞Â≠óÔºâ</label>
                    <input type="password" class="text-input" id="inputPin" placeholder="‰æã: 1234" maxlength="4"
                        pattern="[0-9]*" inputmode="numeric"
                        style="letter-spacing: 0.3em; text-align: center; font-size: 18px;">
                    <div style="font-size: 10px; color: var(--text-gray); margin-top: 4px;">‚Äª „Éá„Éº„ÇøÂæ©ÂÖÉÊôÇ„Å´ÂøÖË¶Å„Åß„Åô„ÄÇÂøò„Çå„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">YOUR BASE</label>
                    <div class="base-selector">
                        <div class="base-option" data-base="moiwayama" onclick="selectBase(this)">
                            <div class="base-icon">üèîÔ∏è</div>
                            <div class="base-name">ËóªÂ≤©Â±±</div>
                            <div class="base-code">MOIWAYAMA</div>
                        </div>
                        <div class="base-option" data-base="okurayama" onclick="selectBase(this)">
                            <div class="base-icon">‚õ∑Ô∏è</div>
                            <div class="base-name">Â§ßÂÄâÂ±±</div>
                            <div class="base-code">OKURAYAMA</div>
                        </div>
                        <div class="base-option" data-base="tvtower" onclick="selectBase(this)">
                            <div class="base-icon">üóº</div>
                            <div class="base-name">„ÉÜ„É¨„ÉìÂ°î</div>
                            <div class="base-code">TV TOWER</div>
                        </div>
                        <div class="base-option" data-base="akarenga" onclick="selectBase(this)">
                            <div class="base-icon">üß±</div>
                            <div class="base-name">Ëµ§„Çå„Çì„Åå</div>
                            <div class="base-code">AKARENGA</div>
                        </div>
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">üéØ ‰ªäÂπ¥„ÅÆÁõÆÊ®ôÔºà3„Å§„Åæ„ÅßÔºâ</label>
                    <input type="text" class="text-input" id="inputGoalThisYear1" placeholder="ÁõÆÊ®ô 1"
                        style="margin-bottom: 8px;">
                    <input type="text" class="text-input" id="inputGoalThisYear2" placeholder="ÁõÆÊ®ô 2Ôºà‰ªªÊÑèÔºâ"
                        style="margin-bottom: 8px;">
                    <input type="text" class="text-input" id="inputGoalThisYear3" placeholder="ÁõÆÊ®ô 3Ôºà‰ªªÊÑèÔºâ">
                </div>
                <div class="input-group">
                    <label class="input-label">‚ú® SVD„ÅßÂè∂„Åà„Åü„ÅÑ„Ç≠„É£„É™„Ç¢„Åæ„Åü„ÅØÂ∞ÜÊù•„ÅÆÂ§¢Ôºà3„Å§„Åæ„ÅßÔºâ</label>
                    <input type="text" class="text-input" id="inputGoalFuture1" placeholder="Â§¢ 1"
                        style="margin-bottom: 8px;">
                    <input type="text" class="text-input" id="inputGoalFuture2" placeholder="Â§¢ 2Ôºà‰ªªÊÑèÔºâ"
                        style="margin-bottom: 8px;">
                    <input type="text" class="text-input" id="inputGoalFuture3" placeholder="Â§¢ 3Ôºà‰ªªÊÑèÔºâ">
                </div>
                <button class="btn-main" id="registerBtn" onclick="register()" disabled>REGISTER</button>

                <!-- „É≠„Ç∞„Ç§„É≥„É™„É≥„ÇØ -->
                <div
                    style="margin-top: 20px; text-align: center; padding-top: 20px; border-top: 1px solid var(--border);">
                    <div style="font-size: 11px; color: var(--text-gray); margin-bottom: 8px;">Êó¢„Å´ÁôªÈå≤Ê∏à„Åø„ÅÆÊñπ</div>
                    <button onclick="showLoginScreen()"
                        style="background: none; border: 1px solid var(--gold); color: var(--gold); padding: 10px 24px; border-radius: 25px; font-size: 12px; font-weight: 600; cursor: pointer;">
                        üîë „É≠„Ç∞„Ç§„É≥
                    </button>
                </div>
            </div>
        </div>

        <!-- SCREEN 0.5: LOGIN -->
        <div class="screen" id="screen-login">
            <div class="register-card">
                <div class="register-title">üîë „É≠„Ç∞„Ç§„É≥</div>
                <div class="register-sub">ÂêçÂâç„Å®PIN„ÇíÂÖ•Âäõ„Åó„Å¶„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ</div>
                <div class="input-group">
                    <label class="input-label">YOUR NAME</label>
                    <input type="text" class="text-input" id="loginName" placeholder="‰æã: Â±±Áî∞Â§™ÈÉé">
                </div>
                <div class="input-group">
                    <label class="input-label">üîê PIN</label>
                    <input type="password" class="text-input" id="loginPin" placeholder="4Ê°Å„ÅÆPIN" maxlength="4"
                        pattern="[0-9]*" inputmode="numeric"
                        style="letter-spacing: 0.3em; text-align: center; font-size: 18px;">
                </div>
                <button class="btn-main" onclick="performLogin()">„É≠„Ç∞„Ç§„É≥</button>
                <div id="loginError"
                    style="color: var(--danger); font-size: 11px; text-align: center; margin-top: 10px; display: none;">
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="showScreen('screen-register')"
                        style="background: none; border: none; color: var(--text-gray); font-size: 11px; cursor: pointer; text-decoration: underline;">
                        Êñ∞Ë¶èÁôªÈå≤„ÅØ„Åì„Å°„Çâ
                    </button>
                </div>
            </div>
        </div>

        <!-- SCREEN 1: MORNING RITUAL -->
        <div class="screen" id="screen-morning">
            <!-- Today's Work Location Selector -->
            <div class="section-title">üìç TODAY'S LOCATION</div>
            <div class="health-check-card" id="todayLocationCard" style="margin-bottom: 20px;">
                <div style="text-align: center; margin-bottom: 10px;">
                    <span style="font-size: 10px; color: var(--text-gray); display: block; margin-bottom: 4px;">üìÖ
                        Âã§ÂãôÊó•</span>
                    <input type="date" id="workDateInput"
                        style="padding: 5px 8px; border: 1px solid var(--border); border-radius: 6px; font-size: 12px; font-family: 'Inter', sans-serif; background: var(--light-gray); color: var(--navy); font-weight: 600; width: auto;"
                        onchange="updateWorkDate(this.value)">
                </div>
                <div class="health-title"><span class="icon">üè¢</span> ‰ªäÊó•„ÅØ„Å©„Åì„ÅßÂÉç„Åç„Åæ„Åô„ÅãÔºü</div>
                <div class="base-selector" style="margin-top: 12px;">
                    <div class="base-option today-base" data-base="moiwayama" onclick="selectTodayBase(this)">
                        <div class="base-icon">üèîÔ∏è</div>
                        <div class="base-name">ËóªÂ≤©Â±±</div>
                        <div class="base-code">MOIWAYAMA</div>
                    </div>
                    <div class="base-option today-base" data-base="okurayama" onclick="selectTodayBase(this)">
                        <div class="base-icon">‚õ∑Ô∏è</div>
                        <div class="base-name">Â§ßÂÄâÂ±±</div>
                        <div class="base-code">OKURAYAMA</div>
                    </div>
                    <div class="base-option today-base" data-base="tvtower" onclick="selectTodayBase(this)">
                        <div class="base-icon">üóº</div>
                        <div class="base-name">„ÉÜ„É¨„ÉìÂ°î</div>
                        <div class="base-code">TV TOWER</div>
                    </div>
                    <div class="base-option today-base" data-base="akarenga" onclick="selectTodayBase(this)">
                        <div class="base-icon">üß±</div>
                        <div class="base-name">Ëµ§„Çå„Çì„Åå</div>
                        <div class="base-code">AKARENGA</div>
                    </div>
                </div>
                <div id="todayLocationStatus"
                    style="margin-top: 12px; text-align: center; font-size: 11px; color: var(--text-gray);">Âã§ÂãôÂÖà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                </div>

                <!-- C/IN„ÉªC/OUT „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫ -->
                <div id="dailyStatusBadges"
                    style="display: flex; justify-content: center; gap: 12px; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border);">
                    <div id="checkinStatusBadge"
                        style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; border-radius: 20px; font-size: 11px; font-weight: 600; background: var(--light-gray); color: var(--text-gray);">
                        <span>üì•</span> C/IN: <span id="checkinStatusText">Êú™ÂÆå‰∫Ü</span>
                    </div>
                    <div id="checkoutStatusBadge"
                        style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; border-radius: 20px; font-size: 11px; font-weight: 600; background: var(--light-gray); color: var(--text-gray);">
                        <span>üì§</span> C/OUT: <span id="checkoutStatusText">Êú™ÂÆå‰∫Ü</span>
                    </div>
                </div>
            </div>

            <div class="section-title">PRINCIPLE</div>
            <div class="principle-card" onclick="this.classList.toggle('expanded')">
                <div class="principle-num">01 PURPOSE</div>
                <div class="principle-title">„Éë„Éº„Éë„ÇπÔºàÂ≠òÂú®ÊÑèÁæ©Ôºâ</div>
                <div class="principle-desc" style="font-weight: 500;">SAPPORO VIEWTIFUL
                    DINING„ÅØÊú≠Âπå„Å®„ÅÑ„ÅÜÈÉΩÂ∏Ç„ÅåÊúâ„Åô„Çã„ÄåË¶≥ÂÖâ„Äç„ÇÑ„ÄåÈ£ü„Äç„ÇíÂÆà„Çä„ÄÅÂåóÊµ∑ÈÅì„ÅÆÊñáÂåñ„Çí„ÄåÊú™Êù•„Äç„Å∏„Å®Á¥°„ÅêÊóóÊâã„Å®„Å™„Çã„É¨„Çπ„Éà„É©„É≥„Éª„Ç≥„É¨„ÇØ„ÉÜ„Ç£„Éñ„Åß„Åô„ÄÇ</div>
            </div>
            <div class="principle-card" onclick="this.classList.toggle('expanded')">
                <div class="principle-num">02 MISSION</div>
                <div class="principle-title">„Äå„Åì„Åì„Å†„Åë„ÅÆÁæéÂë≥„Åó„Åï„ÄÇ<br>„Åì„Åì„Å†„Åë„ÅÆ„Ç®„É≥„Çø„Éº„ÉÜ„Ç§„É≥„É°„É≥„Éà„ÄÇ„Äç</div>
                <div class="principle-desc" style="font-weight: 500;">
                    „ÅîÊù•Â∫ó„ÅÑ„Åü„Å†„Åè„ÅäÂÆ¢Êßò„ÅÆÂ§ßÂàá„Å™„Ç∑„Éº„É≥„ÇíÂΩ©„ÇãÁâπÂà•„Å™ÊñôÁêÜ„Å®Á©∫Èñì„ÇíÊèê‰æõ„Åó„ÄÅ„Äå„Åì„Åì„Äç„Å´„Åó„Åã„Å™„ÅÑÁæéÂë≥„Åó„Åï„Å®ÊÑüÂãï„ÇíËøΩÊ±Ç„Åó„ÄÅÂ±ä„Åë„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ</div>
            </div>
            <div class="principle-card" onclick="this.classList.toggle('expanded')">
                <div class="principle-num">03 VISION</div>
                <div class="principle-title">„Åì„ÅÆË°ó„ÅÆÈ£ü„Å®ÊñáÂåñ„Å®Áâ©Ë™û„Çí100Âπ¥ÂÖà„Å∏</div>
                <div class="principle-desc" style="font-weight: 500;">
                    100Âπ¥ÂÖà„ÇÇÊú≠ÂπåÂ∏ÇÊ∞ë„Å´ÊÑõ„Åï„Çå„Çã„É¨„Çπ„Éà„É©„É≥„Å•„Åè„Çä„ÄÇÁßÅ„Åü„Å°„ÅåÁõÆÊåá„Åô„ÅÆ„ÅØ„ÄÅ„É¨„Çπ„Éà„É©„É≥„ÅÆ‰æ°ÂÄ§„Çí„ÄåÈ£ü„Äç„Å†„Åë„Åß„ÅØ„Å™„Åè„Äå‰∫∫Áîü„ÅÆ„Çπ„Éà„Éº„É™„Éº„ÇíÂâµ„ÇãÂ†¥ÊâÄ„Äç„Å∏„Å®ÈÄ≤Âåñ„Åï„Åõ„ÄÅÊú≠Âπå„ÅÆË°óÂÖ®‰Ωì„Çí„Çà„ÇäË±ä„Åã„Å™Áâ©Ë™û„ÇíÁ¥°„ÅêÂ†¥„Å®„Åó„Å¶„ÅÑ„Åè„Åì„Å®„ÄÇ„Åù„Åó„Å¶„ÄÅ„Åì„ÅÆË°ó„ÅÆÁæé„Åó„ÅÑÁâ©Ë™û„ÅåÊ¨°„ÅÆ‰∏ñ‰ª£„Å´„ÇÇÂèó„ÅëÁ∂ô„Åå„Çå„Å¶„ÅÑ„Åè„Åì„Å®„ÇíÁõÆÊåá„Åó„Åæ„Åô„ÄÇ
                </div>
            </div>
            <div class="principle-card" onclick="this.classList.toggle('expanded')">
                <div class="principle-num">04 VALUE</div>
                <div class="principle-title">Ë°ó„ÅÆÊú™Êù•„Çí„É¨„Çπ„Éà„É©„É≥„Åã„Çâ„Å§„Åè„Å£„Å¶„ÅÑ„Åè</div>
                <div class="principle-desc" style="font-weight: 500;">
                    ÁßÅ„Åü„Å°„ÅÆÂèñ„ÇäÁµÑ„Åø„ÅØ„ÄÅÂçò„Å™„ÇãÈ£≤È£üÂ∫ó„ÅÆÈÅãÂñ∂„Åß„ÅØ„Å™„Åè„ÄÅÊú≠Âπå„ÅÆÊú™Êù•„ÇíÂΩ¢„Å•„Åè„ÇãÂ≠òÂú®„Å´„Å™„Çã„Åì„Å®„ÄÇ„Åü„Å†„ÅÆÂïÜÊ•≠ÊñΩË®≠„Åß„ÅØ„Å™„ÅÑ„ÄåÂÖ¨ÂÖ±ÊÄß„Å®ÊñáÂåñÊÄß„ÇíÂÇô„Åà„Åü„É¨„Çπ„Éà„É©„É≥„Äç„ÇíËÇ≤„Å¶„ÄÅÁ§æÂÜÖ„ÅÆÂêÑ‰∫ãÊ•≠ÈÉ®„ÅÆÁöÜ„Åï„Çì„Å®ÈÄ£Êê∫„Åó„Å™„Åå„Çâ„ÄÅÊú≠Âπå„ÅÆÊàêÈï∑„Å®„Å®„ÇÇ„Å´Êñ∞„Åó„ÅÑ‰æ°ÂÄ§„ÇíÂâµ„Çä„Å†„Åó„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ
                </div>
            </div>

            <!-- SVD Brand Guide PDF „É™„É≥„ÇØ -->
            <div onclick="confirmOpenPdf('SVD_BRANDGUIDE_v.1.1.pdf')"
                style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, var(--gold-light), rgba(212,175,55,0.1)); border: 1px solid var(--gold); border-radius: 12px; cursor: pointer;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 24px;">üìñ</span>
                    <div>
                        <div
                            style="font-family: 'Montserrat', sans-serif; font-size: 13px; font-weight: 600; color: var(--navy);">
                            SVD Brand Guide</div>
                        <div style="font-size: 11px; color: var(--text-gray);">v1.1 - „Éñ„É©„É≥„Éâ„Ç≥„É≥„Çª„Éó„Éà„ÇíÁ¢∫Ë™ç„Åô„Çã</div>
                    </div>
                    <span style="margin-left: auto; font-size: 18px;">‚Üí</span>
                </div>
            </div>

            <div class="section-title" style="margin-top: 25px;">Health Check</div>
            <div class="health-check-card" id="healthCheckCard">
                <div class="health-title"><span class="icon">ü©∫</span> Â∞±Ê•≠Ââç„ÉÅ„Çß„ÉÉ„ÇØ„Ç∑„Éº„Éà</div>
                <div class="check-item">
                    <div class="check-label">‰ΩìË™ø„ÅØËâØÂ•Ω„Åß„Åô„ÅãÔºü</div>
                    <div class="check-toggle"><button class="toggle-btn ok" data-field="condition"
                            onclick="setCheck(this, 'ok')">OK</button><button class="toggle-btn ng"
                            data-field="condition" onclick="setCheck(this, 'ng')">NG</button></div>
                </div>
                <div class="check-item">
                    <div class="check-label">‰ΩìÊ∏©„ÅØ37.5‚ÑÉÊú™Ê∫Ä„Åß„Åô„ÅãÔºü</div>
                    <div class="check-toggle"><button class="toggle-btn ok" data-field="temp"
                            onclick="setCheck(this, 'ok')">OK</button><button class="toggle-btn ng" data-field="temp"
                            onclick="setCheck(this, 'ng')">NG</button></div>
                </div>
                <div class="check-item">
                    <div class="check-label">‰Ωì„Åå„Å†„Çã„Åè„Å™„ÅÑ„Åß„Åô„ÅãÔºü</div>
                    <div class="check-toggle"><button class="toggle-btn ok" data-field="fatigue"
                            onclick="setCheck(this, 'ok')">OK</button><button class="toggle-btn ng" data-field="fatigue"
                            onclick="setCheck(this, 'ng')">NG</button></div>
                </div>
                <div class="check-item">
                    <div class="check-label">ËÉ∏„ÅÆ„ÇÄ„Åã„Å§„Åç„ÉªÂêê„ÅçÊ∞ó„ÅØ„Å™„ÅÑ„Åß„Åô„ÅãÔºü</div>
                    <div class="check-toggle"><button class="toggle-btn ok" data-field="nausea"
                            onclick="setCheck(this, 'ok')">OK</button><button class="toggle-btn ng" data-field="nausea"
                            onclick="setCheck(this, 'ng')">NG</button></div>
                </div>
                <div class="check-item">
                    <div class="check-label">Áà™„ÅÆÊâãÂÖ•„Çå„ÅØ„Åß„Åç„Å¶„ÅÑ„Åæ„Åô„ÅãÔºü</div>
                    <div class="check-toggle"><button class="toggle-btn ok" data-field="nails"
                            onclick="setCheck(this, 'ok')">OK</button><button class="toggle-btn ng" data-field="nails"
                            onclick="setCheck(this, 'ng')">NG</button></div>
                </div>
                <div class="check-item">
                    <div class="check-label">ÊâãÊåá„Å´ÁÅ´ÂÇ∑„ÇÑÊâãËçí„Çå„ÅØ„Å™„ÅÑ„Åß„Åô„ÅãÔºü</div>
                    <div class="check-toggle"><button class="toggle-btn ok" data-field="hands"
                            onclick="setCheck(this, 'ok')">OK</button><button class="toggle-btn ng" data-field="hands"
                            onclick="setCheck(this, 'ng')">NG</button></div>
                </div>
                <div class="check-item">
                    <div class="check-label">Âà∂Êúç„ÉªÈ†≠È´™„ÉªÈù¥„ÅØÊ∏ÖÊΩî„Åß„Åô„ÅãÔºü</div>
                    <div class="check-toggle"><button class="toggle-btn ok" data-field="uniform"
                            onclick="setCheck(this, 'ok')">OK</button><button class="toggle-btn ng" data-field="uniform"
                            onclick="setCheck(this, 'ng')">NG</button></div>
                </div>
                <div class="health-status incomplete" id="healthStatus">„Åô„Åπ„Å¶„ÅÆÈ†ÖÁõÆ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
            </div>

            <div class="section-title" style="margin-top: 20px;">Mind Check</div>
            <div class="health-check-card" id="mindCheckCard">
                <div class="health-title"><span class="icon">üí≠</span> ÂøÉ„ÅÆ„Çª„É´„Éï„ÉÅ„Çß„ÉÉ„ÇØ</div>
                <div class="check-item" style="flex-direction: column; align-items: flex-start;">
                    <div class="check-label" style="margin-bottom: 10px;">ÊúÄËøë1ÈÄ±Èñì„Åß„ÄÅ‰ªï‰∫ã„ÇíÊ•Ω„Åó„ÅÑ„Å®ÊÑü„Åò„Åü„Åì„Å®„Åå„ÅÇ„Çã</div>
                    <div class="check-toggle"
                        style="width: 100%; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <button class="toggle-btn" data-field="mind_enjoy"
                            onclick="setMindCheck(this, 'many')">„Åü„Åè„Åï„Çì„ÅÇ„Çã</button>
                        <button class="toggle-btn" data-field="mind_enjoy"
                            onclick="setMindCheck(this, 'yes')">„ÅÇ„Çã</button>
                        <button class="toggle-btn" data-field="mind_enjoy"
                            onclick="setMindCheck(this, 'neutral')">„Å©„Å°„Çâ„Å®„ÇÇ</button>
                        <button class="toggle-btn" data-field="mind_enjoy"
                            onclick="setMindCheck(this, 'no')">„Å™„ÅÑ</button>
                    </div>
                </div>
                <div class="check-item" style="flex-direction: column; align-items: flex-start;">
                    <div class="check-label" style="margin-bottom: 10px;">Êúù„ÄÅ‰ªï‰∫ã„Å´Âêë„Åã„ÅÜ„Å®„Åç„ÅÆÁ¨¨‰∏ÄÊÑüÊÉÖ„ÅØÔºü</div>
                    <div class="check-toggle"
                        style="width: 100%; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <button class="toggle-btn" data-field="mind_morning"
                            onclick="setMindCheck(this, 'excited')">Ê•Ω„Åó„Åø</button>
                        <button class="toggle-btn" data-field="mind_morning"
                            onclick="setMindCheck(this, 'normal')">ÊôÆÈÄö</button>
                        <button class="toggle-btn" data-field="mind_morning"
                            onclick="setMindCheck(this, 'heavy')">Â∞ë„ÅóÈáç„ÅÑ</button>
                        <button class="toggle-btn" data-field="mind_morning"
                            onclick="setMindCheck(this, 'very_heavy')">„Åã„Å™„ÇäÈáç„ÅÑ</button>
                    </div>
                </div>
                <div class="check-item" style="flex-direction: column; align-items: flex-start;">
                    <div class="check-label" style="margin-bottom: 10px;">Áõ∏Ë´á„Åó„Åü„ÅÑ„Åì„Å®„ÅØÔºü</div>
                    <div class="check-toggle"
                        style="width: 100%; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <button class="toggle-btn" data-field="mind_consult"
                            onclick="setMindCheck(this, 'urgent')">„Åô„Åê„Å´„Åß„ÇÇ</button>
                        <button class="toggle-btn" data-field="mind_consult"
                            onclick="setMindCheck(this, 'sometime')">Êäò„ÇíË¶ã„Å¶</button>
                        <button class="toggle-btn" data-field="mind_consult"
                            onclick="setMindCheck(this, 'notyet')">„Åæ„Å†Â§ß‰∏àÂ§´</button>
                        <button class="toggle-btn" data-field="mind_consult"
                            onclick="setMindCheck(this, 'none')">„Å™„ÅÑ</button>
                    </div>
                </div>
                <div class="health-status incomplete" id="mindStatus">ÂøÉ„ÅÆÁä∂ÊÖã„ÇÇÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
            </div>

            <div class="section-title" style="margin-top: 20px;">Today's Quests</div>
            <div class="draw-area disabled" id="drawArea">
                <div class="draw-card-back" onclick="drawQuests()">
                    <div class="draw-logo"></div>
                    <div class="draw-subtitle">PLAYBOOK 100</div>
                </div>
                <div class="draw-hint">ÂÖ®È†ÖÁõÆOK„Åß3Êûö„ÅÆ„Ç´„Éº„Éâ„ÇíÂºï„Åë„Åæ„Åô</div>
            </div>

            <div class="quest-cards-container" id="questCardsContainer"></div>
            <button class="btn-main" id="startBtn" style="display: none;" onclick="startDay()">CHECK IN ‚úì</button>
        </div>

        <!-- SCREEN 2: ACTIVE DAY -->
        <div class="screen" id="screen-active">
            <!-- ON STAGE Status -->
            <div id="onStageStatus"
                style="text-align: center; margin-bottom: 20px; padding: 20px; background: linear-gradient(145deg, var(--navy), var(--navy-dark)); border-radius: 16px; border: 2px solid var(--gold); box-shadow: 0 0 20px rgba(201, 169, 98, 0.2);">
                <div
                    style="font-family: 'Montserrat', sans-serif; font-size: 10px; color: var(--gold); letter-spacing: 0.3em; margin-bottom: 6px; font-weight: 500;">
                    YOU ARE NOW</div>
                <div
                    style="font-family: 'Montserrat', sans-serif; font-size: 28px; font-weight: 700; color: var(--white); letter-spacing: 0.15em; text-shadow: 0 0 20px rgba(255,255,255,0.3);">
                    ON STAGE</div>
                <div id="shiftTimeDisplay"
                    style="font-family: 'Montserrat', sans-serif; font-size: 14px; color: var(--gold); margin-top: 12px; font-weight: 600;">
                    <!-- „Ç∑„Éï„ÉàÊôÇÈñì„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                </div>
            </div>

            <!-- Announcements Section -->
            <div id="announcementsSection" style="margin-bottom: 20px;">
                <div class="section-title" style="display: flex; align-items: center; gap: 8px;">
                    üì¢ „ÅäÁü•„Çâ„Åõ
                    <span id="announcementsCount"
                        style="background: var(--gold); color: var(--navy); font-size: 10px; padding: 2px 8px; border-radius: 10px; font-weight: 600;"></span>
                </div>
                <div id="announcementsList" style="display: flex; flex-direction: column; gap: 10px;"></div>
            </div>

            <div class="section-title">Today's Shift</div>
            <div class="health-check-card" style="padding: 16px; margin-bottom: 20px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <select id="shiftStartSelect" onchange="shiftTimes.start = this.value; updateShiftTimeDisplay();"
                        style="flex: 1; padding: 12px; border: 1px solid var(--border); border-radius: 10px; font-size: 16px; font-family: 'Inter', sans-serif; background: var(--light-gray); color: var(--navy); font-weight: 600; text-align: center;">
                        <option value="">ÈñãÂßã</option>
                        <option value="08:00">8:00</option>
                        <option value="08:30">8:30</option>
                        <option value="09:00">9:00</option>
                        <option value="09:30">9:30</option>
                        <option value="10:00">10:00</option>
                        <option value="10:30">10:30</option>
                        <option value="11:00">11:00</option>
                        <option value="11:30">11:30</option>
                        <option value="12:00">12:00</option>
                        <option value="12:30">12:30</option>
                        <option value="13:00">13:00</option>
                        <option value="13:30">13:30</option>
                        <option value="14:00">14:00</option>
                        <option value="14:30">14:30</option>
                        <option value="15:00">15:00</option>
                        <option value="15:30">15:30</option>
                        <option value="16:00">16:00</option>
                        <option value="16:30">16:30</option>
                        <option value="17:00">17:00</option>
                    </select>
                    <span style="font-weight: 700; color: var(--navy); font-size: 18px;">„Äú</span>
                    <select id="shiftEndSelect" onchange="shiftTimes.end = this.value; updateShiftTimeDisplay();"
                        style="flex: 1; padding: 12px; border: 1px solid var(--border); border-radius: 10px; font-size: 16px; font-family: 'Inter', sans-serif; background: var(--light-gray); color: var(--navy); font-weight: 600; text-align: center;">
                        <option value="">ÁµÇ‰∫Ü</option>
                        <option value="17:00">17:00</option>
                        <option value="17:30">17:30</option>
                        <option value="18:00">18:00</option>
                        <option value="18:30">18:30</option>
                        <option value="19:00">19:00</option>
                        <option value="19:30">19:30</option>
                        <option value="20:00">20:00</option>
                        <option value="20:30">20:30</option>
                        <option value="21:00">21:00</option>
                        <option value="21:30">21:30</option>
                        <option value="22:00">22:00</option>
                        <option value="22:30">22:30</option>
                        <option value="23:00">23:00</option>
                        <option value="23:30">23:30</option>
                        <option value="00:00">0:00</option>
                        <option value="00:30">0:30</option>
                        <option value="01:00">1:00</option>
                        <option value="01:30">1:30</option>
                        <option value="02:00">2:00</option>
                    </select>
                </div>
            </div>

            <div class="section-title">Today's Focus</div>
            <div class="active-quests-container" id="activeQuestsContainer"></div>

            <!-- TO-DO LIST -->
            <div class="section-title" style="margin-top: 25px;">üìã TO-DO LIST</div>
            <div class="todo-container">
                <div class="todo-tabs">
                    <button class="todo-tab active" onclick="showTodoTab('daily')">DAILY</button>
                    <button class="todo-tab" onclick="showTodoTab('weekly')">WEEKLY</button>
                    <button class="todo-tab" onclick="showTodoTab('monthly')">MONTHLY</button>
                </div>

                <div id="todo-daily" class="todo-content active">
                    <div class="todo-input-area">
                        <input type="text" id="dailyTodoInput" placeholder="‰ªäÊó•„ÇÑ„Çã„Åì„Å®..."
                            onkeypress="if(event.key==='Enter')addTodo('daily')">
                        <button onclick="addTodo('daily')">+</button>
                    </div>
                    <div id="dailyTodoList" class="todo-list"></div>
                </div>

                <div id="todo-weekly" class="todo-content">
                    <div class="todo-input-area">
                        <input type="text" id="weeklyTodoInput" placeholder="‰ªäÈÄ±„ÇÑ„Çã„Åì„Å®..."
                            onkeypress="if(event.key==='Enter')addTodo('weekly')">
                        <button onclick="addTodo('weekly')">+</button>
                    </div>
                    <div id="weeklyTodoList" class="todo-list"></div>
                </div>

                <div id="todo-monthly" class="todo-content">
                    <div class="todo-input-area">
                        <input type="text" id="monthlyTodoInput" placeholder="‰ªäÊúà„ÇÑ„Çã„Åì„Å®..."
                            onkeypress="if(event.key==='Enter')addTodo('monthly')">
                        <button onclick="addTodo('monthly')">+</button>
                    </div>
                    <div id="monthlyTodoList" class="todo-list"></div>
                </div>
            </div>

            <button class="btn-main" id="reflectionBtn" onclick="showReflection()">CHECK OUT ‚Üí</button>
            <div id="reflectionNotice"
                style="display: none; margin-top: 12px; padding: 10px; background: rgba(201, 169, 98, 0.1); border: 1px solid var(--gold); border-radius: 8px; text-align: center; font-size: 12px; color: var(--navy);">
                ‚è∞ Ê•≠ÂãôÁµÇ„Çè„Çä„Å´ÊåØ„ÇäËøî„Çä„Çí„Åó„Å¶„Åè„Å†„Åï„ÅÑ<br>
                <span id="reflectionTimer" style="font-family: 'Montserrat', sans-serif; font-weight: 600;"></span>
            </div>
        </div>

        <!-- SCREEN 3: REFLECTION -->
        <div class="screen" id="screen-reflection">
            <div class="reflection-prompt">‰ªäÊó•„ÅÆ3„Å§„ÅÆQuest<br><span style="color: var(--gold);"
                    id="reflectionQuestTitles"></span><br>„ÇíÊÑèË≠ò„Åß„Åç„Åæ„Åó„Åü„ÅãÔºü<br><span
                    style="font-size: 13px; color: var(--text-gray);">‚òÖ„ÅßË©ï‰æ°„Åó„Å¶„Åè„Å†„Åï„ÅÑ</span></div>
            <div class="star-rating" id="starRating"><span class="star" data-value="1">‚òÖ</span><span class="star"
                    data-value="2">‚òÖ</span><span class="star" data-value="3">‚òÖ</span><span class="star"
                    data-value="4">‚òÖ</span><span class="star" data-value="5">‚òÖ</span></div>
            <textarea class="memo-input" id="memoInput" placeholder="‰ªäÊó•„ÅÆÊ∞ó„Å•„Åç„ÇÑÂ≠¶„Å≥„Çí„É°„É¢Ôºà‰ªªÊÑèÔºâ"></textarea>
            <button class="btn-main" id="completeBtn" onclick="submitReflection()">COMPLETE</button>
        </div>

        <!-- SCREEN 4: COMPLETION -->
        <div class="screen" id="screen-completion">
            <div class="completion-icon">‚ú®</div>
            <div class="completion-message">Great Work!</div>
            <div class="completion-sub">‰ªäÊó•„ÇÇMINDFUL„Å™‰∏ÄÊó•„ÇíÈÅé„Åî„Åó„Åæ„Åó„Åü„Å≠„ÄÇ<br>„Åì„ÅÆÁ©ç„ÅøÈáç„Å≠„Åå„ÅÇ„Å™„Åü„ÇíÊú™Êù•„Å∏„Å®ÈÅã„Å≥„Åæ„Åô„ÄÇ</div>

            <div class="token-earned-container" id="tokenEarnedContainer">
                <div class="token-earned-badge">
                    <div class="token-earned-icon">ü™ô</div>
                    <div class="token-earned-amount" id="tokenEarnedAmount">+0</div>
                    <div class="token-earned-label">TOKEN EARNED</div>
                    <div class="token-breakdown" id="tokenBreakdown"></div>
                </div>
            </div>

            <button class="btn-main" onclick="resetApp()">NEXT DAY ‚Üí</button>
            <button class="btn-secondary" onclick="showHistory()">VIEW HISTORY</button>
        </div>

        <!-- SCREEN 5: HISTORY -->
        <div class="screen" id="screen-history">
            <div class="section-title">My Mindful Log</div>
            <div id="historyList"></div>
            <div id="kiraraCollectionContainer"></div>
            <button class="btn-secondary" onclick="showScreen('screen-morning')">BACK</button>
        </div>

        <!-- SCREEN 6: INSIGHT (AIÁõ∏Ë´á + Ë®ò‰∫ã) -->
        <div class="screen" id="screen-insight">
            <div class="section-title">ü§ñ SATOSHI AI</div>
            <div class="ai-chat-card"
                style="font-family: 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', sans-serif;">
                <div class="ai-intro" style="text-align: center;">
                    <div class="ai-intro-icon">üí¨</div>
                    „É¨„Çπ„Éà„É©„É≥ÁµåÂñ∂„Éª„Ç≠„É£„É™„Ç¢„Éª„ÉÅ„Éº„É†„Éû„Éç„Ç∏„É°„É≥„Éà„Åã„Çâ„ÄÅ„Çµ„Éº„Éì„Çπ„ÅÆÂü∫Êú¨„Åæ„ÅßSATOSHI AI„Å´Áõ∏Ë´á„Åß„Åç„Åæ„Åô
                </div>
                <div id="chatMessages" class="chat-messages">
                    <div class="chat-bubble ai">
                        <div class="ai-name">SATOSHI</div>
                        „Åì„Çì„Å´„Å°„ÅØÔºÅ‰Ωï„Åß„ÇÇÁõ∏Ë´á„Åó„Å¶„Å≠„ÄÇ„É¨„Çπ„Éà„É©„É≥ÁµåÂñ∂„ÄÅ„ÉÅ„Éº„É†„Å•„Åè„Çä„ÄÅ„Ç≠„É£„É™„Ç¢„Å´„Å§„ÅÑ„Å¶‰∏ÄÁ∑í„Å´ËÄÉ„Åà„Çà„ÅÜÔºÅ üåü
                    </div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chatInput" placeholder="Ë≥™Âïè„ÇíÂÖ•Âäõ..."
                        onkeypress="if(event.key==='Enter')sendToAI()">
                    <button id="sendAIBtn" onclick="sendToAI()">ÈÄÅ‰ø°</button>
                </div>
                <div
                    style="margin-top: 12px; text-align: center; font-size: 9px; color: var(--text-gray); opacity: 0.7;">
                    Powered by <span style="font-weight: 600;">Gemini 3 Flash</span> | SATOSHI AI v5.0
                </div>
            </div>

            <div class="section-title" style="margin-top: 25px;">üì∞ INDUSTRY NEWS</div>
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <a href="https://www.inshokuten.com/" target="_blank" rel="noopener" style="text-decoration: none;">
                    <div
                        style="background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; transition: all 0.2s;">
                        <span style="font-size: 20px;">üçΩÔ∏è</span>
                        <div>
                            <div
                                style="font-family: 'Montserrat', sans-serif; font-size: 12px; font-weight: 600; color: var(--navy);">
                                È£≤È£üÂ∫ó.com</div>
                            <div style="font-size: 10px; color: var(--text-gray);">È£≤È£üÊ•≠Áïå„ÅÆÁ∑èÂêàÊÉÖÂ†±„Çµ„Ç§„Éà</div>
                        </div>
                    </div>
                </a>
                <a href="https://note.com/svd_sard_satoshi" target="_blank" rel="noopener"
                    style="text-decoration: none;">
                    <div
                        style="background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; transition: all 0.2s;">
                        <span style="font-size: 20px;">üìö</span>
                        <div>
                            <div
                                style="font-family: 'Montserrat', sans-serif; font-size: 12px; font-weight: 600; color: var(--navy);">
                                „É¨„Çπ„Éà„É©„É≥„ÅÆÊïôÁßëÊõ∏</div>
                            <div style="font-size: 10px; color: var(--text-gray);">SVD„ÅÆÁü•Ë¶ã„Çí„Åæ„Å®„ÇÅ„Åü„Ç≥„É©„É†</div>
                        </div>
                    </div>
                </a>
                <div
                    style="font-family: 'Montserrat', sans-serif; font-size: 11px; font-weight: 700; color: var(--gold); letter-spacing: 0.15em; margin-top: 25px; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid rgba(201,169,98,0.3);">
                    üéØ SVD TACTICS</div>
                <div onclick="trackKnowledgeView('tactics')" style="cursor: pointer; text-decoration: none;">
                    <div
                        style="background: linear-gradient(135deg, var(--white), rgba(212,175,55,0.05)); border: 1px solid var(--gold); border-radius: 12px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; transition: all 0.2s; margin-bottom: 10px;">
                        <span style="font-size: 20px;">üìä</span>
                        <div style="flex: 1;">
                            <div
                                style="font-family: 'Montserrat', sans-serif; font-size: 12px; font-weight: 600; color: var(--navy);">
                                È£üÂìÅÊ∂àË≤ªÁ®é„Çº„É≠ÊîøÁ≠ñ ÂΩ±ÈüøÂàÜÊûê</div>
                            <div style="font-size: 10px; color: var(--text-gray);">SVD Intelligence Report ‚Äî 2026.02
                            </div>
                        </div>
                        <span id="knowledgeBadge_tactics"
                            style="font-family: 'Montserrat', sans-serif; font-size: 10px; font-weight: 700; color: var(--gold); white-space: nowrap;">ü™ô
                            +5</span>
                    </div>
                </div>
                <div onclick="trackKnowledgeView('tvtower')" style="cursor: pointer; text-decoration: none;">
                    <div
                        style="background: linear-gradient(135deg, var(--white), rgba(232,85,53,0.05)); border: 1px solid rgba(232,85,53,0.4); border-radius: 12px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; transition: all 0.2s; margin-bottom: 10px;">
                        <span style="font-size: 20px;">üóº</span>
                        <div style="flex: 1;">
                            <div
                                style="font-family: 'Montserrat', sans-serif; font-size: 12px; font-weight: 600; color: var(--navy);">
                                TV TOWER ‚Äî 3Âπ¥Èñì„ÅÆËªåË∑°</div>
                            <div style="font-size: 10px; color: var(--text-gray);">„ÉÜ„É¨„ÉìÂ°îÊã†ÁÇπ Â£≤‰∏ä„Éª„ÉÅ„Éº„É†ÈÄ≤Âåñ„É¨„Éù„Éº„Éà
                            </div>
                        </div>
                        <span id="knowledgeBadge_tvtower"
                            style="font-family: 'Montserrat', sans-serif; font-size: 10px; font-weight: 700; color: var(--gold); white-space: nowrap;">ü™ô
                            +5</span>
                    </div>
                </div>

                <div
                    style="font-family: 'Montserrat', sans-serif; font-size: 11px; font-weight: 700; color: var(--navy); letter-spacing: 0.15em; margin-top: 25px; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border); opacity: 0.6;">
                    üìö KNOWLEDGE</div>
                <div onclick="trackKnowledgeView('deliciousness')"
                    style="cursor: pointer; text-decoration: none; margin-bottom: 10px;">
                    <div
                        style="background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; transition: all 0.2s;">
                        <span style="font-size: 20px;">‚ú®</span>
                        <div style="flex: 1;">
                            <div
                                style="font-family: 'Montserrat', sans-serif; font-size: 12px; font-weight: 600; color: var(--navy);">
                                ÁæéÂë≥„Åó„Åï„ÅÆÂÆöÁæ©</div>
                            <div style="font-size: 10px; color: var(--text-gray);">The Definition of Deliciousness</div>
                        </div>
                        <span id="knowledgeBadge_deliciousness"
                            style="font-family: 'Montserrat', sans-serif; font-size: 10px; font-weight: 700; color: var(--gold); white-space: nowrap;">ü™ô
                            +5</span>
                    </div>
                </div>
                <div onclick="trackKnowledgeView('momentum')" style="cursor: pointer; text-decoration: none;">
                    <div
                        style="background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; transition: all 0.2s;">
                        <span style="font-size: 20px;">üìà</span>
                        <div style="flex: 1;">
                            <div
                                style="font-family: 'Montserrat', sans-serif; font-size: 12px; font-weight: 600; color: var(--navy);">
                                MOMENTUM PEAKS „Å®„ÅØÔºü</div>
                            <div style="font-size: 10px; color: var(--text-gray);">SVD„ÅÆÁ≤æÂØÜ‰∫àÊ∏¨„É≠„Ç∏„ÉÉ„ÇØ„ÇíËß£Ë™¨</div>
                        </div>
                        <span id="knowledgeBadge_momentum"
                            style="font-family: 'Montserrat', sans-serif; font-size: 10px; font-weight: 700; color: var(--gold); white-space: nowrap;">ü™ô
                            +5</span>
                    </div>
                </div>
                <a href="https://guide.michelin.com/jp/ja" target="_blank" rel="noopener"
                    style="text-decoration: none;">
                    <div
                        style="background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; transition: all 0.2s;">
                        <span style="font-size: 20px;">‚≠ê</span>
                        <div>
                            <div
                                style="font-family: 'Montserrat', sans-serif; font-size: 12px; font-weight: 600; color: var(--navy);">
                                „Éü„Ç∑„É•„É©„É≥„Ç¶„Çß„Éñ</div>
                            <div style="font-size: 10px; color: var(--text-gray);">„Éü„Ç∑„É•„É©„É≥„Ç¨„Ç§„ÉâÂÖ¨Âºè„Çµ„Ç§„Éà</div>
                        </div>
                    </div>
                </a>
                <a href="https://cuisine-kingdom.com/" target="_blank" rel="noopener" style="text-decoration: none;">
                    <div
                        style="background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; transition: all 0.2s;">
                        <span style="font-size: 20px;">üë®‚Äçüç≥</span>
                        <div>
                            <div
                                style="font-family: 'Montserrat', sans-serif; font-size: 12px; font-weight: 600; color: var(--navy);">
                                ÊñôÁêÜÁéãÂõΩ</div>
                            <div style="font-size: 10px; color: var(--text-gray);">„Éó„É≠„ÅÆ„Åü„ÇÅ„ÅÆÊñôÁêÜÂ∞ÇÈñÄË™å</div>
                        </div>
                    </div>
                </a>
                <a href="https://tabelog.com/" target="_blank" rel="noopener" style="text-decoration: none;">
                    <div
                        style="background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; transition: all 0.2s;">
                        <span style="font-size: 20px;">üìù</span>
                        <div>
                            <div
                                style="font-family: 'Montserrat', sans-serif; font-size: 12px; font-weight: 600; color: var(--navy);">
                                È£ü„Åπ„É≠„Ç∞</div>
                            <div style="font-size: 10px; color: var(--text-gray);">Êó•Êú¨ÊúÄÂ§ßÁ¥ö„ÅÆ„Ç∞„É´„É°„Çµ„Ç§„Éà</div>
                        </div>
                    </div>
                </a>
                <a href="https://www.sommelier.jp/" target="_blank" rel="noopener" style="text-decoration: none;">
                    <div
                        style="background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; transition: all 0.2s;">
                        <span style="font-size: 20px;">üç∑</span>
                        <div>
                            <div
                                style="font-family: 'Montserrat', sans-serif; font-size: 12px; font-weight: 600; color: var(--navy);">
                                Êó•Êú¨„ÇΩ„É†„É™„Ç®Âçî‰ºö</div>
                            <div style="font-size: 10px; color: var(--text-gray);">J.S.A.ÂÖ¨Âºè„Çµ„Ç§„Éà</div>
                        </div>
                    </div>
                </a>
                <a href="https://www.nrn.com/" target="_blank" rel="noopener" style="text-decoration: none;">
                    <div
                        style="background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; transition: all 0.2s;">
                        <span style="font-size: 20px;">üåê</span>
                        <div>
                            <div
                                style="font-family: 'Montserrat', sans-serif; font-size: 12px; font-weight: 600; color: var(--navy);">
                                Nation's Restaurant News</div>
                            <div style="font-size: 10px; color: var(--text-gray);">Á±≥ÂõΩ„É¨„Çπ„Éà„É©„É≥Ê•≠Áïå„Éã„É•„Éº„Çπ</div>
                        </div>
                    </div>
                </a>
                <a href="https://www.eater.com/" target="_blank" rel="noopener" style="text-decoration: none;">
                    <div
                        style="background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; transition: all 0.2s;">
                        <span style="font-size: 20px;">üç¥</span>
                        <div>
                            <div
                                style="font-family: 'Montserrat', sans-serif; font-size: 12px; font-weight: 600; color: var(--navy);">
                                Eater</div>
                            <div style="font-size: 10px; color: var(--text-gray);">„Ç∞„É≠„Éº„Éê„É´„Éï„Éº„ÉâÔºÜ„ÉÄ„Ç§„Éã„É≥„Ç∞</div>
                        </div>
                    </div>
                </a>
            </div>

            <button class="btn-secondary" style="margin-top: 20px;" onclick="showScreen('screen-morning')">BACK</button>
        </div>

        <!-- SCREEN 7: PROFILE VIEW -->
        <!-- PDF Viewer Screen -->
        <div class="screen" id="screen-pdf-viewer"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; background: #222; flex-direction: column;">
            <!-- Close button -->
            <div onclick="closePdf()"
                style="position: absolute; top: 10px; right: 10px; z-index: 10001; width: 40px; height: 40px; background: rgba(0,0,0,0.6); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; color: white; font-size: 20px;">
                ‚úï</div>
            <!-- PDF Content -->
            <div id="pdfContainer"
                style="flex: 1; overflow: auto; -webkit-overflow-scrolling: touch; display: flex; flex-direction: column; align-items: center; padding: 10px; gap: 10px;">
            </div>
            <!-- Zoom Controls -->
            <div style="background: var(--navy); padding: 8px; display: flex; justify-content: center; gap: 20px;">
                <button onclick="pdfZoomOut()"
                    style="background: none; color: white; border: none; font-size: 24px; cursor: pointer; padding: 8px 16px;">‚àí</button>
                <span id="pdfZoomLevel"
                    style="color: white; font-size: 14px; display: flex; align-items: center;">100%</span>
                <button onclick="pdfZoomIn()"
                    style="background: none; color: white; border: none; font-size: 24px; cursor: pointer; padding: 8px 16px;">+</button>
            </div>
        </div>

        <div class="screen" id="screen-profile">
            <div class="section-title">My Profile</div>
            <div class="register-card">
                <div style="text-align: center; margin-bottom: 20px;">
                    <!-- Profile Photo -->
                    <div style="position: relative; display: inline-block;">
                        <div id="profilePhotoContainer"
                            style="width: 100px; height: 100px; border-radius: 50%; background: var(--light-gray); border: 3px solid var(--gold); display: flex; align-items: center; justify-content: center; overflow: hidden; cursor: pointer; transition: all 0.2s;"
                            onclick="document.getElementById('photoInput').click()">
                            <img id="profilePhoto" src=""
                                style="width: 100%; height: 100%; object-fit: cover; display: none;">
                            <span id="profilePhotoPlaceholder" style="font-size: 40px;">üë§</span>
                        </div>
                        <div style="position: absolute; bottom: 0; right: 0; background: var(--gold); width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.2);"
                            onclick="document.getElementById('photoInput').click()">
                            <span style="font-size: 14px;">üì∑</span>
                        </div>
                    </div>
                    <input type="file" id="photoInput" accept="image/*" style="display: none;"
                        onchange="handlePhotoUpload(event)">
                    <div style="font-size: 10px; color: var(--text-gray); margin-top: 8px;">„Çø„ÉÉ„Éó„Åó„Å¶ÂÜôÁúü„ÇíÂ§âÊõ¥</div>
                    <div style="font-family: 'Montserrat', sans-serif; font-size: 20px; font-weight: 600; color: var(--navy); margin-top: 12px;"
                        id="profileName">-</div>
                    <div style="font-size: 13px; color: var(--text-gray); margin-top: 5px;" id="profileBase">-</div>
                </div>

                <div
                    style="background: var(--gold-light); border: 1px solid var(--gold); border-radius: 12px; padding: 16px; margin-bottom: 20px;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                        <div
                            style="font-family: 'Montserrat', sans-serif; font-size: 14px; color: var(--gold); letter-spacing: 0.15em; font-weight: 700;">
                            üìå MY VISION</div>
                        <button onclick="openGoalsEditor()"
                            style="padding: 6px 12px; background: var(--gold); color: white; border: none; border-radius: 6px; font-size: 11px; cursor: pointer; font-family: 'Inter', sans-serif;">
                            ‚úèÔ∏è Á∑®ÈõÜ
                        </button>
                    </div>

                    <!-- ‰ªäÂπ¥„ÅÆÁõÆÊ®ô -->
                    <div style="font-size: 13px; color: var(--navy); margin-bottom: 12px; text-align: left;">
                        <strong style="color: var(--gold);">üéØ ‰ªäÂπ¥„ÅÆÁõÆÊ®ô</strong>
                        <div id="profileGoalsThisYear" style="margin-top: 8px;"></div>
                        <button onclick="addGoal('thisYear')"
                            style="margin-top: 8px; padding: 8px 12px; background: transparent; color: var(--gold); border: 1px dashed var(--gold); border-radius: 6px; font-size: 12px; cursor: pointer;">
                            + ÁõÆÊ®ô„ÇíËøΩÂä†
                        </button>
                    </div>

                    <!-- Â∞ÜÊù•„ÅÆÂ§¢ -->
                    <div style="font-size: 13px; color: var(--navy); text-align: left;">
                        <strong style="color: var(--gold);">‚ú® Â∞ÜÊù•„ÅÆÂ§¢</strong>
                        <div id="profileGoalsFuture" style="margin-top: 8px;"></div>
                        <button onclick="addGoal('future')"
                            style="margin-top: 8px; padding: 8px 12px; background: transparent; color: var(--gold); border: 1px dashed var(--gold); border-radius: 6px; font-size: 12px; cursor: pointer;">
                            + Â§¢„ÇíËøΩÂä†
                        </button>
                    </div>
                </div>

                <div
                    style="display: flex; align-items: center; justify-content: center; gap: 10px; padding: 12px; background: var(--light-gray); border-radius: 10px; margin-bottom: 20px;">
                    <span class="token-icon">ü™ô</span>
                    <span
                        style="font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 24px; color: var(--gold);"
                        id="profileTokens">0</span>
                    <span
                        style="font-family: 'Montserrat', sans-serif; font-size: 11px; color: var(--text-gray);">TOKEN</span>
                </div>

                <!-- PINÂ§âÊõ¥„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div style="border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 20px;">
                    <div
                        style="font-family: 'Montserrat', sans-serif; font-size: 12px; color: var(--text-gray); letter-spacing: 0.1em; margin-bottom: 10px;">
                        üîê „Çª„Ç≠„É•„É™„ÉÜ„Ç£</div>
                    <button onclick="openPinChangeModal()"
                        style="width: 100%; padding: 12px; background: var(--light-gray); color: var(--navy); border: 1px solid var(--border); border-radius: 8px; font-family: 'Inter', sans-serif; font-size: 13px; cursor: pointer;">
                        PIN„ÇíÂ§âÊõ¥„Åô„Çã
                    </button>
                </div>

                <!-- Êã†ÁÇπÂ§âÊõ¥„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div style="border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 20px;">
                    <div
                        style="font-family: 'Montserrat', sans-serif; font-size: 12px; color: var(--text-gray); letter-spacing: 0.1em; margin-bottom: 10px;">
                        üè¢ Êã†ÁÇπÁÆ°ÁêÜ</div>
                    <button onclick="openBaseTransferModal()"
                        style="width: 100%; padding: 12px; background: var(--light-gray); color: var(--navy); border: 1px solid var(--border); border-radius: 8px; font-family: 'Inter', sans-serif; font-size: 13px; cursor: pointer;">
                        Êã†ÁÇπ„ÇíÂ§âÊõ¥„Åô„ÇãÔºà„Éá„Éº„ÇøÂºï„ÅçÁ∂ô„ÅéÔºâ
                    </button>
                </div>

                <button class="btn-main" onclick="confirmEditProfile()">„Éó„É≠„Éï„Ç£„Éº„É´„ÇíÁ∑®ÈõÜ„Åô„Çã</button>
                <button class="btn-secondary" onclick="showScreen('screen-morning')">Êàª„Çã</button>
                <button class="btn-secondary" onclick="forceUpdate()" style="margin-top: 10px; font-size: 10px;">üîÑ
                    Force Update (v5.0)</button>
            </div>
        </div>

        <!-- Êã†ÁÇπÁßªÁ±ç„É¢„Éº„ÉÄ„É´ -->
        <div id="baseTransferModal"
            style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 1000; padding: 20px; overflow-y: auto;">
            <div
                style="background: var(--white); border-radius: 16px; padding: 25px; max-width: 350px; margin: 20px auto;">
                <div
                    style="font-family: 'Montserrat', sans-serif; font-size: 18px; font-weight: 600; color: var(--navy); text-align: center; margin-bottom: 20px;">
                    üè¢ Êã†ÁÇπ„ÇíÂ§âÊõ¥
                </div>
                <div style="font-size: 13px; color: var(--text-gray); text-align: center; margin-bottom: 20px;">
                    „Éà„Éº„ÇØ„É≥„ÉªÁõÆÊ®ô„ÉªÂÜôÁúü„Å™„Å©ÂÖ®„Éá„Éº„Çø„ÇíÂºï„ÅçÁ∂ô„ÅÑ„ÅßÁßªÁ±ç„Åó„Åæ„Åô
                </div>
                <div id="baseTransferOptions" style="display: grid; gap: 10px; margin-bottom: 20px;">
                    <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
                <div id="transferError"
                    style="display: none; color: var(--danger); font-size: 12px; text-align: center; margin-bottom: 10px;">
                </div>
                <div style="display: flex; gap: 10px;">
                    <button onclick="closeBaseTransferModal()"
                        style="flex: 1; padding: 12px; background: var(--light-gray); color: var(--navy); border: none; border-radius: 8px; font-size: 14px; cursor: pointer;">
                        „Ç≠„É£„É≥„Çª„É´
                    </button>
                    <button id="confirmTransferBtn" onclick="confirmBaseTransfer()"
                        style="flex: 1; padding: 12px; background: var(--gold); color: white; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; font-weight: 600;">
                        ÁßªÁ±ç„Åô„Çã
                    </button>
                </div>
            </div>
        </div>

        <!-- PINÂ§âÊõ¥„É¢„Éº„ÉÄ„É´ -->
        <div id="pinChangeModal"
            style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 1000; padding: 20px; overflow-y: auto; -webkit-overflow-scrolling: touch;">
            <div
                style="background: var(--white); border-radius: 16px; padding: 25px; max-width: 350px; margin: 20px auto; max-height: calc(100vh - 80px); overflow-y: auto; -webkit-overflow-scrolling: touch;">
                <div
                    style="font-family: 'Montserrat', sans-serif; font-size: 18px; font-weight: 600; color: var(--navy); text-align: center; margin-bottom: 20px;">
                    üîê PINÂ§âÊõ¥
                </div>

                <div class="input-group" style="margin-bottom: 15px;">
                    <label class="input-label">ÁèæÂú®„ÅÆPIN</label>
                    <input type="password" class="text-input" id="currentPin" placeholder="ÁèæÂú®„ÅÆ4Ê°ÅPIN" maxlength="4"
                        pattern="[0-9]*" inputmode="numeric"
                        style="letter-spacing: 0.3em; text-align: center; font-size: 18px;">
                </div>

                <div class="input-group" style="margin-bottom: 15px;">
                    <label class="input-label">Êñ∞„Åó„ÅÑPIN</label>
                    <input type="password" class="text-input" id="newPin" placeholder="Êñ∞„Åó„ÅÑ4Ê°ÅPIN" maxlength="4"
                        pattern="[0-9]*" inputmode="numeric"
                        style="letter-spacing: 0.3em; text-align: center; font-size: 18px;">
                </div>

                <div class="input-group" style="margin-bottom: 20px;">
                    <label class="input-label">Êñ∞„Åó„ÅÑPINÔºàÁ¢∫Ë™çÔºâ</label>
                    <input type="password" class="text-input" id="confirmNewPin" placeholder="„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÂÖ•Âäõ" maxlength="4"
                        pattern="[0-9]*" inputmode="numeric"
                        style="letter-spacing: 0.3em; text-align: center; font-size: 18px;">
                </div>

                <div id="pinChangeError"
                    style="color: var(--danger); font-size: 11px; text-align: center; margin-bottom: 15px; display: none;">
                </div>
                <div id="pinChangeSuccess"
                    style="color: var(--success); font-size: 11px; text-align: center; margin-bottom: 15px; display: none;">
                </div>

                <button onclick="changePin()" class="btn-main" style="margin-top: 0;">Â§âÊõ¥„Åô„Çã</button>
                <button onclick="closePinChangeModal()" class="btn-secondary">„Ç≠„É£„É≥„Çª„É´</button>
            </div>
        </div>

        <!-- Êó¢Â≠ò„É¶„Éº„Ç∂„ÉºÁî®PINË®≠ÂÆö„É¢„Éº„ÉÄ„É´ÔºàÂøÖÈ†à„ÉªÈñâ„Åò„Çå„Å™„ÅÑÔºâ -->
        <div id="pinSetupModal"
            style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 2000; padding: 20px; overflow-y: auto; -webkit-overflow-scrolling: touch;">
            <div
                style="background: var(--white); border-radius: 16px; padding: 25px; max-width: 380px; margin: 30px auto; max-height: calc(100vh - 80px); overflow-y: auto; -webkit-overflow-scrolling: touch;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 50px; margin-bottom: 10px;">üîê</div>
                    <div
                        style="font-family: 'Montserrat', sans-serif; font-size: 18px; font-weight: 600; color: var(--navy);">
                        PIN„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                    <div style="font-size: 12px; color: var(--text-gray); margin-top: 8px;">„Éá„Éº„Çø‰øùË≠∑„ÅÆ„Åü„ÇÅ„ÄÅ4Ê°Å„ÅÆPIN„ÅåÂøÖË¶Å„Åß„Åô</div>
                </div>

                <div
                    style="background: rgba(201, 169, 98, 0.1); border: 1px solid var(--gold); border-radius: 10px; padding: 12px; margin-bottom: 20px;">
                    <div style="font-size: 11px; color: var(--navy);">
                        <strong>ü™ô ÁèæÂú®„ÅÆ„Éà„Éº„ÇØ„É≥: <span id="setupTokenDisplay">0</span></strong><br>
                        <span style="color: var(--text-gray);">PIN„ÇíË®≠ÂÆö„Åô„Çã„Å®„ÄÅ„Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢Âæå„ÇÇ„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ„Åß„Åç„Åæ„Åô„ÄÇ</span>
                    </div>
                </div>

                <div class="input-group" style="margin-bottom: 15px;">
                    <label class="input-label">4Ê°Å„ÅÆPIN„ÇíÂÖ•Âäõ</label>
                    <input type="password" class="text-input" id="setupPin" placeholder="‰æã: 1234" maxlength="4"
                        pattern="[0-9]*" inputmode="numeric"
                        style="letter-spacing: 0.3em; text-align: center; font-size: 20px;">
                </div>

                <div class="input-group" style="margin-bottom: 20px;">
                    <label class="input-label">PIN„ÇíÁ¢∫Ë™çÔºà„ÇÇ„ÅÜ‰∏ÄÂ∫¶Ôºâ</label>
                    <input type="password" class="text-input" id="setupPinConfirm" placeholder="„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÂÖ•Âäõ" maxlength="4"
                        pattern="[0-9]*" inputmode="numeric"
                        style="letter-spacing: 0.3em; text-align: center; font-size: 20px;">
                </div>

                <div id="setupPinError"
                    style="color: var(--danger); font-size: 11px; text-align: center; margin-bottom: 15px; display: none;">
                </div>

                <button onclick="savePinSetup()" class="btn-main">üîê PIN„ÇíË®≠ÂÆö„Åó„Å¶Á∂ö„Åë„Çã</button>

                <div style="font-size: 10px; color: var(--text-gray); text-align: center; margin-top: 15px;">
                    ‚ö†Ô∏è „Åì„ÅÆPIN„ÅØÂøò„Çå„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ„Éá„Éº„ÇøÂæ©ÂÖÉ„Å´ÂøÖË¶Å„Åß„Åô„ÄÇ
                </div>
            </div>
        </div>

        <!-- GOALS EDIT MODAL -->
        <div id="goalsEditModal"
            style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 9999; padding: 20px; overflow-y: scroll; -webkit-overflow-scrolling: touch;">
            <div
                style="background: var(--white); border-radius: 16px; padding: 25px; max-width: 500px; margin: 20px auto; position: relative; z-index: 10000;">
                <div
                    style="font-family: 'Montserrat', sans-serif; font-size: 18px; font-weight: 600; color: var(--navy); text-align: center; margin-bottom: 20px;">
                    üéØ MY VISION „ÇíÊõ¥Êñ∞
                </div>

                <div class="input-group" style="margin-bottom: 20px;">
                    <label class="input-label">üéØ ‰ªäÂπ¥„ÅÆÁõÆÊ®ôÔºà3„Å§„Åæ„ÅßÔºâ</label>
                    <input type="text" class="text-input" id="editGoalThisYear1" placeholder="ÁõÆÊ®ô 1"
                        style="margin-bottom: 8px;">
                    <input type="text" class="text-input" id="editGoalThisYear2" placeholder="ÁõÆÊ®ô 2Ôºà‰ªªÊÑèÔºâ"
                        style="margin-bottom: 8px;">
                    <input type="text" class="text-input" id="editGoalThisYear3" placeholder="ÁõÆÊ®ô 3Ôºà‰ªªÊÑèÔºâ">
                </div>

                <div class="input-group" style="margin-bottom: 25px;">
                    <label class="input-label">‚ú® SVD„ÅßÂè∂„Åà„Åü„ÅÑ„Ç≠„É£„É™„Ç¢„Åæ„Åü„ÅØÂ∞ÜÊù•„ÅÆÂ§¢Ôºà3„Å§„Åæ„ÅßÔºâ</label>
                    <input type="text" class="text-input" id="editGoalFuture1" placeholder="Â§¢ 1"
                        style="margin-bottom: 8px;">
                    <input type="text" class="text-input" id="editGoalFuture2" placeholder="Â§¢ 2Ôºà‰ªªÊÑèÔºâ"
                        style="margin-bottom: 8px;">
                    <input type="text" class="text-input" id="editGoalFuture3" placeholder="Â§¢ 3Ôºà‰ªªÊÑèÔºâ">
                </div>

                <button onclick="saveGoalsEdit()" class="btn-main" style="margin-top: 0;">‰øùÂ≠ò„Åô„Çã</button>
                <button onclick="closeGoalsEditor()" class="btn-secondary">„Ç≠„É£„É≥„Çª„É´</button>
            </div>
        </div>
    </main>

    <footer>SAPPORO VIEWTIFUL DINING ‚Äî ORIGIN <span style="opacity: 0.6; margin-left: 10px;">v5.0</span></footer>

    <nav>
        <div class="nav-item active" onclick="showScreen('screen-morning')">
            <div class="nav-icon"><svg viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="4" />
                    <path
                        d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41" />
                </svg></div>
            <div>C/IN</div>
        </div>
        <div class="nav-item" onclick="showScreen('screen-active')">
            <div class="nav-icon"><svg viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10" />
                    <circle cx="12" cy="12" r="6" />
                    <circle cx="12" cy="12" r="2" />
                </svg></div>
            <div>STAY-C/O</div>
        </div>
        <div class="nav-item" onclick="showHistory()">
            <div class="nav-icon"><svg viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10" />
                    <polyline points="12 6 12 12 16 14" />
                </svg></div>
            <div>HISTORY</div>
        </div>
        <div class="nav-item" onclick="showInsight()">
            <div class="nav-icon"><svg viewBox="0 0 24 24">
                    <path
                        d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7z" />
                    <line x1="9" y1="21" x2="15" y2="21" />
                </svg></div>
            <div>INSIGHT</div>
        </div>
        <div class="nav-item" onclick="showProfile()">
            <div class="nav-icon"><svg viewBox="0 0 24 24">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                    <circle cx="12" cy="7" r="4" />
                </svg></div>
            <div>PROFILE</div>
        </div>
    </nav>

    <div class="sending-overlay" id="sendingOverlay">
        <div class="spinner"></div>
        <div class="sending-text">SENDING DATA...</div>
    </div>

    <script>
        const SCRIPT_URLS = { moiwayama: 'https://script.google.com/macros/s/AKfycbxGL8p3a8-k7xnhz2jfmyq39fXplB0qGI55urinPg9tRBWmbmKEEWcqZNSpUxhs5K3T/exec', okurayama: 'https://script.google.com/macros/s/AKfycbxVVfr-XAgj4n-hOEobZ2wwbgk3QIKQk1T9qFSDsk7PdQ4J8cd5WGH-KA0K9z_x_Vip/exec', tvtower: 'https://script.google.com/macros/s/AKfycbxlj2-3R6HcTd5A45azVScgQDvUBSTGC8faWBXDRI_ck7kbCltTYKnkfaW6njZ88bsi/exec', akarenga: 'https://script.google.com/macros/s/AKfycbzHN2p9eYAFFxip_Wj6b0J_Qm9SIxjetvPJENTBIBiBwLuEPaej_iJC4AUghIJF1cwZZQ/exec' };
        // ‚îÄ‚îÄ SVD API Token (PropertiesService„Å´Ë®≠ÂÆö„Åô„Çã„ÇÇ„ÅÆ„Å®Âêå„ÅòÂÄ§) ‚îÄ‚îÄ
        const SVD_API_TOKEN = 'a6b93874301b54dac9a37afc89d04f56'; // ‚Üê „Éá„Éó„É≠„Ç§ÊôÇ„Å´Ë®≠ÂÆö„ÄÇÁ©∫ÊñáÂ≠ó„Å™„Çâ„Éà„Éº„ÇØ„É≥„Å™„ÅóÔºàÊÆµÈöéÁöÑÂ∞éÂÖ•Ôºâ
        function tokenParam() { return SVD_API_TOKEN ? `&token=${encodeURIComponent(SVD_API_TOKEN)}` : ''; }
        const BASE_NAMES = { moiwayama: 'ËóªÂ≤©Â±±', okurayama: 'Â§ßÂÄâÂ±±', tvtower: '„ÉÜ„É¨„ÉìÂ°î', akarenga: 'Ëµ§„Çå„Çì„Åå' };

        const playbook = [
            // ===== AWAKENING (001-010) =====
            { id: "001", titleEn: "MAGIC MOMENT CAPTURE", titleJp: "„Éû„Ç∏„ÉÉ„ÇØ„Éª„É¢„Éº„É°„É≥„Éà„Éª„Ç≠„É£„Éó„ÉÅ„É£", action: "ÊÑüÂãïÁöÑ„Å™Áû¨Èñì„ÅåÁîü„Åæ„Çå„ÅüÊôÇ„ÄÅ„ÄåGod Job!„Äç„Å®ÂÖ±Êúâ„Åô„Çã„ÄÇ„ÉÅ„Éº„É†ÂÖ®Âì°„Åß„Åù„ÅÆÂñú„Å≥„ÇíÂë≥„Çè„Åä„ÅÜ„ÄÇ" },
            { id: "002", titleEn: "SILENT CHEERS", titleJp: "„Çµ„Ç§„É¨„É≥„Éà„Éª„ÉÅ„Ç¢„Éº„Ç∫", action: "„Ç≤„Çπ„Éà„ÅÆ‰πæÊùØ„ÅÆÁû¨Èñì„ÄÅ‰ΩúÊ•≠„Çí‰∏ÄÁû¨Ê≠¢„ÇÅ„ÄÅ„Åù„ÅÆ‰∏ÄÁÇπ„Å´Ë¶ñÁ∑ö„Å®ÂøÉ„ÇíÈÄÅ„Çã„ÄÇ" },
            { id: "003", titleEn: "THE ENTRANCE OATH", titleJp: "„Ç®„É≥„Éà„É©„É≥„Çπ„Éª„Ç™„Éº„Çπ", action: "ÈñãÂ∫óÂâç„ÄÅ„Ç®„É≥„Éà„É©„É≥„Çπ„ÅÆ„Éû„ÉÉ„Éà„ÇíË∏è„ÇÄÁû¨Èñì„ÄÅ„ÄåÊó•Â∏∏„ÅÆËá™ÂàÜ„Äç„ÇíÊç®„Å¶„ÄÅÂΩπ„Å´ÂÖ•„Çã„ÄÇ" },
            { id: "004", titleEn: "INGREDIENT ORIGIN STORY", titleJp: "„Ç§„É≥„Ç∞„É™„Éá„Ç£„Ç®„É≥„Éà„Éª„Ç™„É™„Ç∏„É≥„Éª„Çπ„Éà„Éº„É™„Éº", action: "‰ªäÊó•‰Ωø„ÅÜÈ£üÊùê„ÅÆÁîüÁî£ËÄÖ„ÇíÊÄù„ÅÑÊµÆ„Åã„Åπ„ÄÅ„ÄåÂëΩ„Äç„Å®„Åó„Å¶„ÄÅ„ÄåË®ó„Åï„Çå„Åü„Éê„Éà„É≥„Äç„Å®„Åó„Å¶Êâ±„ÅÜ„ÄÇ" },
            { id: "005", titleEn: "MOMENTUM HANDICAP", titleJp: "„É¢„É°„É≥„Çø„É†„Éª„Éè„É≥„Éá„Ç£„Ç≠„É£„ÉÉ„Éó", action: "Êñ∞‰∫∫„Å´„ÅØÂÑ™„Åó„Åè„ÄÅ„Ç®„Éº„Çπ„Å´„ÅØÈ´ò„ÅÑÁõÆÊ®ô„Çí„ÄÇÂÖ®Âì°„Åå„ÄåÈÅîÊàê„Äç„ÅÆÂë≥„ÇíÁü•„ÇãÁí∞Â¢É„Çí‰Ωú„Çã„ÄÇ" },
            { id: "006", titleEn: "THE FIRST 10 SECONDS", titleJp: "„Ç∂„Éª„Éï„Ç°„Éº„Çπ„Éà„Éª„ÉÜ„É≥", action: "„Ç≤„Çπ„ÉàÁùÄÂ∏≠Âæå„ÅÆÊúÄÂàù„ÅÆ10Áßí„Åß„ÄÅÂøÖ„Åö„Äå‰∫àÊÉ≥Â§ñ„ÅÆ„Éó„É©„Çπ„Ç¢„ÇØ„Ç∑„Éß„É≥„Äç„Çí‰∏Ä„Å§ÂÖ•„Çå„Çã„ÄÇ" },
            { id: "007", titleEn: "CROSS-POLLINATION", titleJp: "„ÇØ„É≠„Çπ„Éª„Éù„É™„Éç„Éº„Ç∑„Éß„É≥", action: "‰ªñÂ∫óËàó„ÅÆ„Çπ„Çø„ÉÉ„Éï„Å®ÊÉÖÂ†±‰∫§Êèõ„Åó„ÄÅÁï∞„Å™„ÇãÁæéÂ≠¶„ÇÑ„Ç¢„Ç§„Éá„Ç¢„ÇíÊåÅ„Å°Â∏∞„Çã„ÄÇ" },
            { id: "008", titleEn: "SHADOW CEO", titleJp: "„Ç∑„É£„Éâ„Ç¶CEO", action: "„Äå„Å™„Åú„ÅÇ„ÅÆÊåáÁ§∫„ÅåÂá∫„Åü„ÅÆ„Åã„Äç„ÇíÂ∏∏„Å´ËÄÉ„Åà„ÄÅÁõ£Áù£„ÅÆÁõÆ„ÇíÈ§ä„ÅÜ„ÄÇ" },
            { id: "009", titleEn: "DIGITAL DETOX HOUR", titleJp: "„Éá„Ç∏„Çø„É´„Éª„Éá„Éà„ÉÉ„ÇØ„Çπ", action: "Á´ØÊú´„Å´È†º„Çâ„Åö„ÄÅË®òÊÜ∂„Å®Ë¶≥ÂØüÂäõ„Åß„Ç≤„Çπ„Éà„ÅÆ„Éã„Éº„Ç∫„Å´Âøú„Åà„ÇãÊôÇÈñì„ÇíÊÑèË≠òÁöÑ„Å´‰Ωú„Çã„ÄÇ" },
            { id: "010", titleEn: "POST-MATCH MVP", titleJp: "„Éù„Çπ„Éà„Éû„ÉÉ„ÉÅMVP", action: "„Äå‰ªäÊó•‰∏ÄÁï™Áæé„Åó„Åã„Å£„Åü„Éó„É¨„Éº„Äç„Çí‰ª≤Èñì„Å´‰ºù„Åà„Çã„ÄÇÂ£≤‰∏ä„ÇÇÂ§ß‰∫ã„Å†„Åë„Å©‰ª≤Èñì„ÇÇÂ§ß‰∫ã„ÄÇ" },
            // ===== FIRST IMPRESSION (011-020) =====
            { id: "011", titleEn: "FIRST SMILE", titleJp: "„Éï„Ç°„Éº„Çπ„Éà„Éª„Çπ„Éû„Ç§„É´", action: "„Ç≤„Çπ„Éà„Å®ÁõÆ„ÅåÂêà„Å£„ÅüÁû¨Èñì„ÄÅËá™ÂàÜ„Åã„ÇâÂÖà„Å´Á¨ëÈ°î„ÇíÂ±ä„Åë„Çã„ÄÇ„Åù„ÅÆ‰∏ÄÁû¨„Åå„Åô„Åπ„Å¶„ÅÆÂßã„Åæ„Çä„ÄÇ" },
            { id: "012", titleEn: "THE NAME CALLER", titleJp: "„Ç∂„Éª„Éç„Éº„É†„Ç≥„Éº„É©„Éº", action: "„ÅäÂÆ¢„Åï„Åæ„Åå„ÅäÂ∏∞„Çä„Å´„Å™„Çã„Åæ„Åß„Å´„ÄÅ„ÅäÂêçÂâç„Çí3Âõû‰ª•‰∏äÂëº„Å∂„ÄÇ" },
            { id: "013", titleEn: "COAT CARE CEREMONY", titleJp: "„Ç≥„Éº„Éà„Éª„Ç±„Ç¢„Éª„Çª„É¨„É¢„Éã„Éº", action: "„Ç≥„Éº„Éà„ÇíÈ†ê„Åã„ÇãÈöõ„ÄÅ‰∏ÅÂØß„Å´Êâ±„ÅÑ„ÄåÂ§ßÂàá„Å´„ÅäÈ†ê„Åã„Çä„Åó„Åæ„Åô„Äç„Å®‰∏ÄË®ÄÊ∑ª„Åà„Çã„ÄÇ" },
            { id: "014", titleEn: "THE PERFECT TIMING", titleJp: "„Éë„Éº„Éï„Çß„ÇØ„Éà„Éª„Çø„Ç§„Éü„É≥„Ç∞", action: "„É°„Éã„É•„Éº„ÇíÊ∏°„Åô„Çø„Ç§„Éü„É≥„Ç∞„ÄÅÊ∞¥„ÇíÊ≥®„Åê„Çø„Ç§„Éü„É≥„Ç∞„ÄÇ„Äå‰ªä„Å†„Äç„ÇíÈÄÉ„Åï„Å™„ÅÑ„ÄÇ" },
            { id: "015", titleEn: "EYE LEVEL CONNECTION", titleJp: "„Ç¢„Ç§„É¨„Éô„É´„Éª„Ç≥„Éç„ÇØ„Ç∑„Éß„É≥", action: "„Ç™„Éº„ÉÄ„Éº„ÇíÂèñ„ÇãÊôÇ„ÄÅ„Ç≤„Çπ„Éà„Å®Âêå„ÅòÁõÆÁ∑ö„ÅÆÈ´ò„Åï„Å´„Å™„Çã„Çà„ÅÜÊÑèË≠ò„Åô„Çã„ÄÇ" },
            { id: "016", titleEn: "THE MEMORY PALACE", titleJp: "„É°„É¢„É™„Éº„Éª„Éë„É¨„Çπ", action: "Â∏∏ÈÄ£„Ç≤„Çπ„Éà„ÅÆÂ•Ω„Åø„ÇÑÂâçÂõû„ÅÆ‰ºöË©±„ÇíË¶ö„Åà„Å¶„Åä„Åç„ÄÅÊ¨°Âõû„Åï„Çä„Åí„Å™„ÅèÊ¥ª„Åã„Åô„ÄÇ" },
            { id: "017", titleEn: "ANTICIPATION MASTER", titleJp: "„Ç¢„É≥„ÉÜ„Ç£„Ç∑„Éö„Éº„Ç∑„Éß„É≥„Éª„Éû„Çπ„Çø„Éº", action: "„Ç≤„Çπ„Éà„Åå‰Ωï„Åã„ÇíÊé¢„Åó„Å¶„ÅÑ„ÇãÁ¥†ÊåØ„Çä„ÇíË¶ã„Åõ„Åü„Çâ„ÄÅË®Ä„Çè„Çå„ÇãÂâç„Å´Âãï„Åè„ÄÇ" },
            { id: "018", titleEn: "THE INVISIBLE HAND", titleJp: "„Ç§„É≥„Éì„Ç∏„Éñ„É´„Éª„Éè„É≥„Éâ", action: "„Çµ„Éº„Éì„Çπ„ÅØÊ∞óÈÖç„Å™„Åè„ÄÇ„Ç≤„Çπ„Éà„ÅåÊ∞ó„Å•„Åã„Å™„ÅÑ„ÅÜ„Å°„Å´„ÄÅ„Åô„Åπ„Å¶„ÅåÊï¥„Å£„Å¶„ÅÑ„ÇãÁä∂ÊÖã„Çí‰Ωú„Çã„ÄÇ" },
            { id: "019", titleEn: "WARM FAREWELL", titleJp: "„Ç¶„Ç©„Éº„É†„Éª„Éï„Çß„Ç¢„Ç¶„Çß„É´", action: "„ÅäË¶ãÈÄÅ„Çä„ÅØÊúÄÈ´ò„ÅÆÁ¨ëÈ°î„Åß„ÄÇ„Äå„Åæ„Åü‰ºö„ÅÑ„Åü„ÅÑ„Äç„Å®ÊÄù„Å£„Å¶„ÇÇ„Çâ„Åà„ÇãÂøÉ„Åã„Çâ„ÅÆ„Äå„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„Äç„Çí„ÄÇ" },
            { id: "020", titleEn: "THE LAST LOOK", titleJp: "„É©„Çπ„Éà„Éª„É´„ÉÉ„ÇØ", action: "„Ç≤„Çπ„Éà„ÅåÊåØ„ÇäËøî„Å£„ÅüÊôÇ„ÄÅ„Åæ„Å†Ë¶ãÈÄÅ„Å£„Å¶„ÅÑ„ÇãËá™ÂàÜ„Åß„ÅÑ„Çã„ÄÇÊúÄÂæå„Åæ„ÅßË¶ãÂ±ä„Åë„Çã„ÄÇ" },
            // ===== TEAMWORK (021-030) =====
            { id: "021", titleEn: "THE SILENT PASS", titleJp: "„Çµ„Ç§„É¨„É≥„Éà„Éª„Éë„Çπ", action: "‰ª≤Èñì„ÅÆË¶ñÁ∑ö„ÅÆÂÖà„ÇíË™≠„Åø„ÄÅÈ†º„Åæ„Çå„ÇãÂâç„Å´„Çµ„Éù„Éº„Éà„ÄÇË®ÄËëâ„Å™„Åó„ÅßÈÄö„Åò„ÇãÈÄ£Êê∫„Çí„ÄÇ" },
            { id: "022", titleEn: "BACKUP BUDDY", titleJp: "„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éª„Éê„Éá„Ç£", action: "„Åæ„Åö„ÅØËá™ÂàÜ„ÅÆ„Ç®„É™„Ç¢„ÇíÂÆà„Å£„Å¶„Åã„Çâ„ÄÅÂøô„Åó„Åù„ÅÜ„Å™‰ª≤Èñì„ÅÆ„Éò„É´„Éó„Å´Ë°å„Åè„ÄÇ" },
            { id: "023", titleEn: "THE RELAY RACE", titleJp: "„É™„É¨„Éº„Éª„É¨„Éº„Çπ", action: "ÊñôÁêÜ„ÇíÈÅã„Å∂„Éª‰∏ã„Åí„Çã„ÄÅ„Åô„Åπ„Å¶„ÅÆÂãï„Åç„Å´„Éê„Éà„É≥„ÇíÊ∏°„ÅôÊÑèË≠ò„ÇíÊåÅ„Å§„ÄÇ" },
            { id: "024", titleEn: "KITCHEN BRIDGE", titleJp: "„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éñ„É™„ÉÉ„Ç∏", action: "„Ç≠„ÉÉ„ÉÅ„É≥„Å®„Éõ„Éº„É´„ÅÆÊû∂„ÅëÊ©ã„Å´„Å™„Çã„ÄÇÊÉÖÂ†±ÂÖ±Êúâ„ÅØË™∞„Çà„Çä„ÇÇÊó©„Åè„ÄÅÊ≠£Á¢∫„Å´„ÄÇ" },
            { id: "025", titleEn: "VOICE OF ENCOURAGEMENT", titleJp: "„Éú„Ç§„Çπ„Éª„Ç™„Éñ„Éª„Ç®„É≥„Ç´„É¨„ÉÉ„Ç∏„É°„É≥„Éà", action: "Âøô„Åó„ÅÑÊôÇ„Åì„Åù„ÄÅ‰ª≤Èñì„Å´„Äå„Éä„Ç§„ÇπÔºÅ„Äç„Äå„ÅÑ„ÅÑ„Å≠ÔºÅ„Äç„Å®Â£∞„Çí„Åã„Åë„Çã„ÄÇ" },
            { id: "026", titleEn: "THE ZONE AWARENESS", titleJp: "„Çæ„Éº„É≥„Éª„Ç¢„Ç¶„Çß„Ç¢„Éç„Çπ", action: "Ëá™ÂàÜ„ÅÆÊãÖÂΩì„Ç®„É™„Ç¢„Å†„Åë„Åß„Å™„Åè„ÄÅ„Éï„É≠„Ç¢ÂÖ®‰Ωì„ÅÆÁä∂Ê≥Å„ÇíÂ∏∏„Å´Ê∞ó„Å´„Åô„Çã„ÄÇ" },
            { id: "027", titleEn: "PROBLEM SHIELD", titleJp: "„Éó„É≠„Éñ„É¨„É†„Éª„Ç∑„Éº„É´„Éâ", action: "ÂïèÈ°å„ÅåËµ∑„Åç„Åü„Çâ„ÄÅ‰∏Ä‰∫∫„ÅßÊä±„ÅàËæº„Åæ„Åö„ÄÅ„Åô„Åê„Å´„ÉÅ„Éº„É†„ÅßÂÖ±Êúâ„Åô„Çã„ÄÇ" },
            { id: "028", titleEn: "THE THANK YOU CULTURE", titleJp: "„Çµ„É≥„Ç≠„É•„Éº„Éª„Ç´„É´„ÉÅ„É£„Éº", action: "„Äå„ÅÇ„Çä„Åå„Å®„ÅÜ„Äç„Çí‰∏ÄÊó•50Âõû‰ª•‰∏äË®Ä„ÅÜ„ÄÇÊÑüË¨ù„ÅØ„ÉÅ„Éº„É†„ÅÆÊΩ§ÊªëÊ≤π„ÄÇ" },
            { id: "029", titleEn: "NEWCOMER NAVIGATOR", titleJp: "„Éã„É•„Éº„Ç´„Éû„Éº„Éª„Éä„Éì„Ç≤„Éº„Çø„Éº", action: "Êñ∞‰∫∫„Å´„ÅØ„ÄÅË≥™Âïè„Åó„ÇÑ„Åô„ÅÑÈõ∞Âõ≤Ê∞ó„Çí‰Ωú„Çã„ÄÇ„Äå‰Ωï„Åß„ÇÇËÅû„ÅÑ„Å¶„Äç„ÇíË°åÂãï„ÅßÁ§∫„Åô„ÄÇ" },
            { id: "030", titleEn: "THE CELEBRATION MOMENT", titleJp: "„Çª„É¨„Éñ„É¨„Éº„Ç∑„Éß„É≥„Éª„É¢„Éº„É°„É≥„Éà", action: "„ÉÅ„Éº„É†„ÅÆÂ∞è„Åï„Å™ÊàêÂäü„ÇÇË¶ãÈÄÉ„Åï„Åö„ÄÅÁöÜ„ÅßÂñú„Å≥„ÇíÂàÜ„Åã„Å°Âêà„ÅÜ„ÄÇ" },
            // ===== CHEMISTRY (031-040) =====
            { id: "031", titleEn: "THE HUDDLE", titleJp: "„Ç∂„Éª„Éè„Éâ„É´", action: "„Éî„Éº„ÇØ„Çø„Ç§„É†Áõ¥Ââç„ÄÅ„ÉÅ„Éº„É†„ÅßÈ°î„ÇíÂêà„Çè„Åõ„Å¶„Äå‰ªäÊó•„ÇÇË°å„Åì„ÅÜÔºÅ„Äç„ÅÆ‰∏ÄÂ£∞„ÄÇÊ∞óÊåÅ„Å°„Çí‰∏Ä„Å§„Å´„ÄÇ" },
            { id: "032", titleEn: "BRIEFING BRILLIANCE", titleJp: "„Éñ„É™„Éº„Éï„Ç£„É≥„Ç∞„Éª„Éñ„É™„É™„Ç¢„É≥„Çπ", action: "ÊúùÁ§º„Åß‰ªäÊó•„ÅÆÁõÆÊ®ô„ÇíÊòéÁ¢∫„Å´ÂÖ±Êúâ„ÄÇÂÖ®Âì°„ÅåÂêå„ÅòÊñπÂêë„ÇíÂêë„Åè„ÄÇ" },
            { id: "033", titleEn: "THE SYNC SIGNAL", titleJp: "„Ç∑„É≥„ÇØ„Éª„Ç∑„Ç∞„Éä„É´", action: "„Äå„Äá„Äá„Åï„Çì‰∫ÜËß£ÔºÅ„Äç„Å™„Å©„ÄÅÁõ∏Êâã„ÅÆÂêçÂâç„ÇíÂëº„Çì„ÅßËøî‰∫ã„Åô„Çã„ÄÇ" },
            { id: "034", titleEn: "ENERGY AMPLIFIER", titleJp: "„Ç®„Éä„Ç∏„Éº„Éª„Ç¢„É≥„Éó„É™„Éï„Ç°„Ç§„Ç¢", action: "„ÉÅ„Éº„É†„ÅÆ„Ç®„Éç„É´„ÇÆ„Éº„Åå‰∏ã„Åå„Å£„Å¶„ÅÑ„Åü„Çâ„ÄÅËá™ÂàÜ„ÅåÁéáÂÖà„Åó„Å¶‰∏ä„Åí„Çã„ÄÇ" },
            { id: "035", titleEn: "THE TRUST DEPOSIT", titleJp: "„Éà„É©„Çπ„Éà„Éª„Éá„Éù„Ç∏„ÉÉ„Éà", action: "Á¥ÑÊùü„ÇíÂÆà„Çã„ÄÇÂ∞è„Åï„Å™Á¥ÑÊùü„Åì„ÅùÁ¢∫ÂÆü„Å´„ÄÇ‰ø°È†º„ÅÆË≤ØÈáë„ÇíÂ¢ó„ÇÑ„Åô„ÄÇ" },
            { id: "036", titleEn: "HONEST FEEDBACK", titleJp: "„Ç™„Éç„Çπ„Éà„Éª„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ", action: "‰ª≤Èñì„ÅÆËâØ„ÅÑ„Å®„Åì„Çç„ÅØÂç≥Â∫ß„Å´‰ºù„Åà„ÄÅÊîπÂñÑÁÇπ„ÅØÂÑ™„Åó„Åè„ÄÅ„Åß„ÇÇÊ≠£Áõ¥„Å´‰ºù„Åà„Çã„ÄÇ" },
            { id: "037", titleEn: "THE COVER MOVE", titleJp: "„Ç´„Éê„Éº„Éª„É†„Éº„Éñ", action: "‰ª≤Èñì„Åå„Éü„Çπ„Çí„Åó„ÅüÊôÇ„ÄÅË≤¨„ÇÅ„Åö„Å´„Åï„Çä„Åí„Å™„Åè„Ç´„Éê„Éº„Åô„Çã„ÄÇ" },
            { id: "038", titleEn: "SHARED VICTORY", titleJp: "„Ç∑„Çß„Ç¢„Éº„Éâ„Éª„Éì„ÇØ„Éà„É™„Éº", action: "„ÉÅ„Éº„É†„ÅÆÊàêÂäü„ÇíËá™ÂàÜ„ÅÆ„Åì„Å®„ÅÆ„Çà„ÅÜ„Å´Âñú„Å∂„ÄÇ„ÄåËá™ÂàÜ„Åå„Äç„Åß„ÅØ„Å™„Åè„ÄåËá™ÂàÜ„Åü„Å°„Åå„Äç„ÄÇ" },
            { id: "039", titleEn: "THE QUICK SYNC", titleJp: "„ÇØ„Ç§„ÉÉ„ÇØ„Éª„Ç∑„É≥„ÇØ", action: "5ÂàÜ„Åß„ÇÇÁ©∫„ÅÑ„Åü„Çâ„ÄÅ‰ª≤Èñì„Å®ÊÉÖÂ†±ÂÖ±Êúâ„ÄÇ„Äå‰ªä„Å©„Çì„Å™Áä∂Ê≥ÅÔºü„Äç„ÇíËÅû„ÅèÁøíÊÖ£„ÄÇ" },
            { id: "040", titleEn: "AFTER HOURS BOND", titleJp: "„Ç¢„Éï„Çø„Éº„Éª„Ç¢„ÉØ„Éº„Ç∫„Éª„Éú„É≥„Éâ", action: "‰ªï‰∫ã‰ª•Â§ñ„ÅÆÊôÇÈñì„Åß„ÇÇ„ÄÅ„ÉÅ„Éº„É†„É°„Ç§„Éà„Å®„ÅÆÈñ¢‰øÇ„ÇíÂ§ßÂàá„Å´„Åô„Çã„ÄÇ" },
            // ===== RESILIENCE (041-050) =====
            { id: "041", titleEn: "RECOVERY SHOT", titleJp: "„É™„Ç´„Éê„É™„Éº„Éª„Ç∑„Éß„ÉÉ„Éà", action: "„Éü„Çπ„Çí„Åó„ÅüÊôÇ„Åì„Åù„ÉÅ„É£„É≥„Çπ„ÄÇ„ÄåÈÄÜ„Å´„Éï„Ç°„É≥„Å´„Åô„Çã„Äç„É™„Ç´„Éê„É™„Éº„Çí„ÄÇ" },
            { id: "042", titleEn: "THE CALM ANCHOR", titleJp: "„Ç´„Éº„É†„Éª„Ç¢„É≥„Ç´„Éº", action: "„Å©„Çå„Å†„ÅëÂøô„Åó„Åè„Å¶„ÇÇ„ÄÅÂøÉ„ÅÆ‰∏≠„Å´Èùô„Åë„Åï„Çí‰øù„Å§„ÄÇÊÖå„Å¶„Å™„ÅÑ„ÄÇ" },
            { id: "043", titleEn: "COMPLAINT TRANSFORMER", titleJp: "„Ç≥„É≥„Éó„É¨„Ç§„É≥„Éà„Éª„Éà„É©„É≥„Çπ„Éï„Ç©„Éº„Éû„Éº", action: "„ÇØ„É¨„Éº„É†„ÅØË¥à„ÇäÁâ©„ÄÇ„Ç≤„Çπ„Éà„ÅÆ‰∏çÊ∫Ä„ÇíÊÑüÂãï„Å´Â§â„Åà„ÇãÊ©ü‰ºö„Å®Êçâ„Åà„Çã„ÄÇ" },
            { id: "044", titleEn: "THE RESET BUTTON", titleJp: "„É™„Çª„ÉÉ„Éà„Éª„Éú„Çø„É≥", action: "Â§±Êïó„ÇíÂºï„Åç„Åö„Çâ„Å™„ÅÑ„ÄÇÊ¨°„ÅÆ„ÉÜ„Éº„Éñ„É´„Å´Âêë„Åã„ÅÜÂâç„Å´„ÄÅÂøÉ„Çí„É™„Çª„ÉÉ„Éà„ÄÇ" },
            { id: "045", titleEn: "PRESSURE DIAMOND", titleJp: "„Éó„É¨„ÉÉ„Ç∑„É£„Éº„Éª„ÉÄ„Ç§„É§„É¢„É≥„Éâ", action: "„Éó„É¨„ÉÉ„Ç∑„É£„Éº„ÇíËºù„Åç„Å´Â§â„Åà„Çã„ÄÇÂøô„Åó„ÅÑÊôÇ„Åª„Å©„ÄÅ‰∏ÅÂØß„Å´„ÄÅÁæé„Åó„Åè„ÄÇ" },
            { id: "046", titleEn: "THE FLEXIBILITY FLEX", titleJp: "„Éï„É¨„Ç≠„Ç∑„Éì„É™„ÉÜ„Ç£„Éª„Éï„É¨„ÉÉ„ÇØ„Çπ", action: "‰∫àÂÆöÈÄö„Çä„Å´„ÅÑ„Åã„Å™„ÅÑ„ÅÆ„ÅåÂΩì„Åü„ÇäÂâç„ÄÇÊüîËªü„Å´ÂØæÂøú„Åó„ÄÅÊúÄÂñÑ„ÇíÂ∞Ω„Åè„Åô„ÄÇ" },
            { id: "047", titleEn: "LEARN FROM LOSS", titleJp: "„É©„Éº„É≥„Éª„Éï„É≠„É†„Éª„É≠„Çπ", action: "Â§±Êïó„Åó„Åü„Çâ„ÄÅ‰Ωï„ÇíÂ≠¶„Åπ„Çã„Åã„ÇíËÄÉ„Åà„Çã„ÄÇÂêå„ÅòÂ§±Êïó„ÅØ‰∫åÂ∫¶„Å®„Åó„Å™„ÅÑ„ÄÇ" },
            { id: "048", titleEn: "THE ENDURANCE ENGINE", titleJp: "„Ç®„É≥„Éá„É•„É©„É≥„Çπ„Éª„Ç®„É≥„Ç∏„É≥", action: "Èï∑ÊôÇÈñì„ÅÆ„Ç∑„Éï„Éà„Åß„ÇÇ„ÄÅÊúÄÂæå„Åæ„ÅßÂêå„Åò„ÇØ„Ç™„É™„ÉÜ„Ç£„ÇíÁ∂≠ÊåÅ„Åô„Çã„ÄÇ" },
            { id: "049", titleEn: "POSITIVE REFRAME", titleJp: "„Éù„Ç∏„ÉÜ„Ç£„Éñ„Éª„É™„Éï„É¨„Éº„É†", action: "„ÄåÂ§ßÂ§â„Å†„Äç„Çí„Äå„ÇÑ„Çä„Åå„ÅÑ„Åå„ÅÇ„Çã„Äç„Å´Â§âÊèõ„ÄÇË®ÄËëâ„ÅåÂøÉ„Çí‰Ωú„Çã„ÄÇ" },
            { id: "050", titleEn: "SMILING THROUGH CHAOS", titleJp: "„Çπ„Éû„Ç§„É™„É≥„Ç∞„Éª„Çπ„É´„Éº„Éª„Ç´„Ç™„Çπ", action: "„Å©„Çå„Å†„ÅëÂøô„Åó„Åè„Å¶„ÇÇ„ÄÅ„Ç≤„Çπ„Éà„ÅÆÂâç„Åß„ÅØÊ∂º„Åó„ÅÑÁ¨ëÈ°î„ÄÇ„Éó„É≠„ÅÆÊºîÊäÄÂäõ„ÇíÁ£®„Åì„ÅÜ„ÄÇ" },
            // ===== PERSONAL BRANDING (051-060) =====
            { id: "051", titleEn: "SIGNATURE MOVE", titleJp: "„Ç∑„Ç∞„Éç„ÉÅ„É£„Éº„Éª„É†„Éº„Éñ", action: "Ëá™ÂàÜ„Å†„Åë„ÅÆ„ÄåÁæé„Åó„Åô„Åé„ÇãÊâÄ‰Ωú„Äç„Çí‰∏Ä„Å§ÈñãÁô∫„Åô„Çã„ÄÇÊ≥®„ÅéÊñπ„ÄÅÁ´ã„Å°Êñπ„ÄÅ‰Ωï„Åß„ÇÇ„ÄÇ" },
            { id: "052", titleEn: "THE NAME TAG PRIDE", titleJp: "„Éç„Éº„É†„Çø„Ç∞„Éª„Éó„É©„Ç§„Éâ", action: "Ëá™ÂàÜ„ÅÆÂêçÂâç„ÇíË™á„Çä„Å´ÊÄù„ÅÜ„ÄÇÂêçÂà∫‰ª£„Çè„Çä„ÅÆÊé•ÂÆ¢„ÇíÂøÉ„Åå„Åë„Çã„ÄÇ" },
            { id: "053", titleEn: "STORY COLLECTOR", titleJp: "„Çπ„Éà„Éº„É™„Éº„Éª„Ç≥„É¨„ÇØ„Çø„Éº", action: "„Ç≤„Çπ„Éà„ÅÆË©±„Å´ËÄ≥„ÇíÂÇæ„Åë„ÄÅ„Åù„ÅÆ‰∫∫„Å†„Åë„ÅÆÁâ©Ë™û„ÇíÂøÉ„Å´Âàª„ÇÄ„ÄÇ" },
            { id: "054", titleEn: "THE KNOWLEDGE HUNTER", titleJp: "„Éä„É¨„ÉÉ„Ç∏„Éª„Éè„É≥„Çø„Éº", action: "ÊñôÁêÜ„Éª„ÉØ„Ç§„É≥„ÉªÈ£üÊùê„Å´„Å§„ÅÑ„Å¶„ÄÅÊØéÊó•‰∏Ä„Å§Êñ∞„Åó„ÅÑ„Åì„Å®„ÇíÂ≠¶„Å∂„ÄÇ" },
            { id: "055", titleEn: "STYLE STATEMENT", titleJp: "„Çπ„Çø„Ç§„É´„Éª„Çπ„ÉÜ„Éº„Éà„É°„É≥„Éà", action: "„É¶„Éã„Éï„Ç©„Éº„É†„ÅÆÁùÄ„Åì„Å™„Åó„Å´„Åì„Å†„Çè„Çã„ÄÇÊ∏ÖÊΩîÊÑü„Å®ÂÄãÊÄß„Çí‰∏°Á´ã„ÄÇ" },
            { id: "056", titleEn: "THE VOICE CRAFT", titleJp: "„Éú„Ç§„Çπ„Éª„ÇØ„É©„Éï„Éà", action: "Â£∞„ÅÆ„Éà„Éº„É≥„ÄÅ„Çπ„Éî„Éº„Éâ„ÄÅÊäëÊèö„ÄÇË®ÄËëâ„Å†„Åë„Åß„Å™„Åè„ÄÅÂ£∞„ÅÆË≥™„ÇíÁ£®„Åè„ÄÇ" },
            { id: "057", titleEn: "PERSONAL MISSION", titleJp: "„Éë„Éº„ÇΩ„Éä„É´„Éª„Éü„ÉÉ„Ç∑„Éß„É≥", action: "„Äå„Å™„ÅúËá™ÂàÜ„ÅØ„Åì„ÅÆ‰ªï‰∫ã„Çí„Åó„Å¶„ÅÑ„Çã„ÅÆ„Åã„Äç„ÇíË®ÄËëâ„Å´„Åß„Åç„Çã„Çà„ÅÜ„Å´„Åô„Çã„ÄÇ" },
            { id: "058", titleEn: "THE GROWTH JOURNAL", titleJp: "„Ç∞„É≠„Éº„Çπ„Éª„Ç∏„É£„Éº„Éä„É´", action: "ÊØéÊó•„ÅÆÂ≠¶„Å≥„ÇíË®òÈå≤„Åô„Çã„ÄÇ1ÈÄ±ÈñìÂæå„ÄÅ1„É∂ÊúàÂæå„Å´ÊåØ„ÇäËøî„Çã„ÄÇ" },
            { id: "059", titleEn: "MENTOR SEEKER", titleJp: "„É°„É≥„Çø„Éº„Éª„Ç∑„Éº„Ç´„Éº", action: "Â∞äÊï¨„Åô„ÇãÂÖàËº©„ÇíË¶ã„Å§„Åë„ÄÅ„Åù„ÅÆ‰∫∫„Åã„ÇâÁ©çÊ•µÁöÑ„Å´Â≠¶„Å∂„ÄÇ" },
            { id: "060", titleEn: "THE CONFIDENCE BUILDER", titleJp: "„Ç≥„É≥„Éï„Ç£„Éá„É≥„Çπ„Éª„Éì„É´„ÉÄ„Éº", action: "„Åß„Åç„Çã„Åì„Å®„ÇíÂ¢ó„ÇÑ„Åó„ÄÅËá™‰ø°„ÇíÁ©ç„Åø‰∏ä„Åí„Çã„ÄÇËá™‰ø°„ÅØÊúÄÈ´ò„ÅÆ„Ç¢„ÇØ„Çª„Çµ„É™„Éº„ÄÇ" },
            // ===== INNOVATION (061-070) =====
            { id: "061", titleEn: "THE OUTSIDER VIEW", titleJp: "„Ç¢„Ç¶„Éà„Çµ„Ç§„ÉÄ„Éº„Éª„Éì„É•„Éº", action: "„É¨„Çπ„Éà„É©„É≥‰ª•Â§ñ„ÅÆÂ†¥ÊâÄ„Åã„Çâ„Éí„É≥„Éà„ÇíÂæó„Çã„ÄÇÁæéË°ìÈ§®„ÄÅÊò†Áîª„ÄÅË°óÊ≠©„Åç„ÄÇ" },
            { id: "062", titleEn: "IDEA SPARK", titleJp: "„Ç¢„Ç§„Éá„Ç¢„Éª„Çπ„Éë„Éº„ÇØ", action: "„Äå„Åì„ÅÜ„Åó„Åü„Çâ„ÇÇ„Å£„Å®ËâØ„Åè„Å™„Çã„Äç„ÇíÊØéÊó•‰∏Ä„Å§ËÄÉ„Åà„Çã„ÄÇ" },
            { id: "063", titleEn: "THE EXPERIMENT", titleJp: "„Ç∏„Éª„Ç®„ÇØ„Çπ„Éö„É™„É°„É≥„Éà", action: "Â∞è„Åï„Å™ÊîπÂñÑ„ÇíË©¶„Åó„Å¶„Åø„Çã„ÄÇÂ§±Êïó„Åó„Å¶„ÇÇ„ÄÅ„Éá„Éº„Çø„Å´„Å™„Çã„ÄÇ" },
            { id: "064", titleEn: "CUSTOMER INSIGHT", titleJp: "„Ç´„Çπ„Çø„Éû„Éº„Éª„Ç§„É≥„Çµ„Ç§„Éà", action: "„Ç≤„Çπ„Éà„ÅÆÂèçÂøú„ÇíË¶≥ÂØü„Åó„ÄÅ‰Ωï„ÅåÂñú„Å∞„Çå„Çã„Åã„ÇíÂàÜÊûê„Åô„Çã„ÄÇ" },
            { id: "065", titleEn: "THE WHY QUESTION", titleJp: "„Ç∂„Éª„Éõ„ÉØ„Ç§„Éª„ÇØ„Ç®„Çπ„ÉÅ„Éß„É≥", action: "„Äå„Å™„Åú‰ªä„ÅÆ„ÇÑ„ÇäÊñπ„Å™„ÅÆ„Åã„Äç„ÇíÂ∏∏„Å´Âïè„ÅÑÁ∂ö„Åë„Çã„ÄÇ" },
            { id: "066", titleEn: "TECH EXPLORER", titleJp: "„ÉÜ„ÉÉ„ÇØ„Éª„Ç®„ÇØ„Çπ„Éó„É≠„Éº„É©„Éº", action: "Êñ∞„Åó„ÅÑ„ÉÑ„Éº„É´„ÇÑ„ÉÜ„ÇØ„Éé„É≠„Ç∏„Éº„Å´ËààÂë≥„ÇíÊåÅ„Å°„ÄÅÊ¥ªÁî®Ê≥ï„ÇíËÄÉ„Åà„Çã„ÄÇ" },
            { id: "067", titleEn: "THE PROPOSAL", titleJp: "„Ç∂„Éª„Éó„É≠„Éù„Éº„Ç∂„É´", action: "„Ç¢„Ç§„Éá„Ç¢„ÇíÊÄù„ÅÑ„Å§„ÅÑ„Åü„Çâ„ÄÅ‰∏äÂè∏„Å´ÊèêÊ°à„Åô„ÇãÂãáÊ∞ó„ÇíÊåÅ„Å§„ÄÇ" },
            { id: "068", titleEn: "BENCHMARK HUNTER", titleJp: "„Éô„É≥„ÉÅ„Éû„Éº„ÇØ„Éª„Éè„É≥„Çø„Éº", action: "‰ªñÂ∫ó„ÅÆËâØ„ÅÑÂèñ„ÇäÁµÑ„Åø„ÇíÂ≠¶„Å≥„ÄÅËá™Â∫ó„Å´Ê¥ª„Åã„Åô„ÄÇ" },
            { id: "069", titleEn: "THE SIMPLIFIER", titleJp: "„Ç∂„Éª„Ç∑„É≥„Éó„É™„Éï„Ç°„Ç§„Ç¢", action: "Ë§áÈõë„Å™„ÇÇ„ÅÆ„Çí„Ç∑„É≥„Éó„É´„Å´„ÄÇÂäπÁéáÂåñ„ÅÆ„Ç¢„Ç§„Éá„Ç¢„ÇíËÄÉ„Åà„Çã„ÄÇ" },
            { id: "070", titleEn: "FUTURE VISION", titleJp: "„Éï„É•„Éº„ÉÅ„É£„Éº„Éª„Éì„Ç∏„Éß„É≥", action: "5Âπ¥Âæå„ÅÆËá™ÂàÜ„ÄÅ5Âπ¥Âæå„ÅÆ„ÅäÂ∫ó„ÇíÊÉ≥ÂÉè„Åô„Çã„ÄÇ‰ªäÊó•„ÅØ„Åù„Åì„Å∏„ÅÆ‰∏ÄÊ≠©„ÄÇ" },
            // ===== LEADERSHIP (071-080) =====
            { id: "071", titleEn: "THE FIRST FOLLOWER", titleJp: "„Éï„Ç°„Éº„Çπ„Éà„Éª„Éï„Ç©„É≠„ÉØ„Éº", action: "Êñ∞„Åó„ÅÑÊèêÊ°à„ÅåÂá∫„ÅüÊôÇ„ÄÅÊâπÂà§„Åô„ÇãÂâç„Å´„Åæ„Åö„Äå„ÅÑ„ÅÑ„Å≠ÔºÅ„Äç„Å®ÊúÄÂàù„Å´‰πó„Å£„Åã„Çã„ÄÇ" },
            { id: "072", titleEn: "LEAD BY EXAMPLE", titleJp: "„É™„Éº„Éâ„Éª„Éê„Ç§„Éª„Ç§„Ç∞„Ç∂„É≥„Éó„É´", action: "Ë®ÄËëâ„Çà„ÇäË°åÂãï„ÄÇËá™ÂàÜ„ÅåÁéáÂÖà„Åó„Å¶Âãï„Åè„Åì„Å®„Åß„ÄÅÂë®„Çä„ÇíÂãï„Åã„Åô„ÄÇ" },
            { id: "073", titleEn: "THE DECISION MAKER", titleJp: "„Éá„Ç£„Ç∑„Ç∏„Éß„É≥„Éª„É°„Ç§„Ç´„Éº", action: "Ëø∑„Å£„Åü„ÇâÊ±∫„ÇÅ„Çã„ÄÇÊ±∫Êñ≠Âäõ„ÅØ„É™„Éº„ÉÄ„Éº„ÅÆË®º„ÄÇ" },
            { id: "074", titleEn: "RESPONSIBILITY OWNER", titleJp: "„É¨„Çπ„Éù„É≥„Ç∑„Éì„É™„ÉÜ„Ç£„Éª„Ç™„Éº„Éä„Éº", action: "Ëá™ÂàÜ„ÅÆÊãÖÂΩì„Å´Ë≤¨‰ªª„ÇíÊåÅ„Å§„ÄÇË®Ä„ÅÑË®≥„Åß„ÅØ„Å™„Åè„ÄÅËß£Ê±∫Á≠ñ„ÇíÊèêÁ§∫„Åô„Çã„ÄÇ" },
            { id: "075", titleEn: "THE EMPOWERER", titleJp: "„Ç∏„Éª„Ç®„É≥„Éë„ÉØ„É©„Éº", action: "‰ª≤Èñì„ÅÆÂº∑„Åø„ÇíË¶ã„Å§„Åë„ÄÅÊ¥ª„Åã„ÅôÂ†¥„Çí‰Ωú„Çã„ÄÇ" },
            { id: "076", titleEn: "CALM COMMANDER", titleJp: "„Ç´„Éº„É†„Éª„Ç≥„Éû„É≥„ÉÄ„Éº", action: "Âç±Ê©üÁöÑÁä∂Ê≥Å„Åß„Åì„ÅùÂÜ∑Èùô„Å´„ÄÇÂë®„Çä„ÇíËêΩ„Å°ÁùÄ„Åã„Åõ„ÇãÂ≠òÂú®„Å´„Å™„Çã„ÄÇ" },
            { id: "077", titleEn: "THE VISION SHARER", titleJp: "„Éì„Ç∏„Éß„É≥„Éª„Ç∑„Çß„Ç¢„É©„Éº", action: "ÁõÆÊåá„ÅôÂ†¥ÊâÄ„ÇíÊòéÁ¢∫„Å´‰ºù„Åà„ÄÅ„ÉÅ„Éº„É†„ÇíÂêå„ÅòÊñπÂêë„Å´Â∞é„Åè„ÄÇ" },
            { id: "078", titleEn: "FEEDBACK RECEIVER", titleJp: "„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Éª„É¨„Ç∑„Éº„Éê„Éº", action: "ÊâπÂà§„ÇíÂèó„ÅëÂÖ•„Çå„ÇãÂô®„ÇíÊåÅ„Å§„ÄÇÊàêÈï∑„ÅÆ„ÉÅ„É£„É≥„Çπ„Å®„Åó„Å¶Êçâ„Åà„Çã„ÄÇ" },
            { id: "079", titleEn: "THE SERVANT LEADER", titleJp: "„Çµ„Éº„Éê„É≥„Éà„Éª„É™„Éº„ÉÄ„Éº", action: "„É™„Éº„ÉÄ„Éº„ÅØ„ÉÅ„Éº„É†„Å´‰ªï„Åà„ÇãÂ≠òÂú®„ÄÇÂõ∞„Å£„Å¶„ÅÑ„Çã‰∫∫„ÇíÊúÄÂÑ™ÂÖà„ÅßÂä©„Åë„Çã„ÄÇ" },
            { id: "080", titleEn: "NEXT GENERATION BUILDER", titleJp: "„Éç„ÇØ„Çπ„Éà„Éª„Ç∏„Çß„Éç„É¨„Éº„Ç∑„Éß„É≥„Éª„Éì„É´„ÉÄ„Éº", action: "ÂæåËº©„ÇíËÇ≤„Å¶„Çã„ÄÇËá™ÂàÜ„ÅÆÁü•Ë≠ò„Å®ÁµåÈ®ì„ÇíÊÉú„Åó„Åø„Å™„ÅèÂÖ±Êúâ„Åô„Çã„ÄÇ" },
            // ===== HOSPITALITY MASTERY (081-090) =====
            { id: "081", titleEn: "THE READING MASTER", titleJp: "„É™„Éº„Éá„Ç£„É≥„Ç∞„Éª„Éû„Çπ„Çø„Éº", action: "„Ç≤„Çπ„Éà„ÅÆË°®ÊÉÖ„ÄÅ‰ªïËçâ„Åã„ÇâÊ∞óÊåÅ„Å°„ÇíË™≠„ÅøÂèñ„Çã„ÄÇË®ÄËëâ„Å´„Å™„Çâ„Å™„ÅÑ„Éã„Éº„Ç∫„Å´Âøú„Åà„Çã„ÄÇ" },
            { id: "082", titleEn: "SPECIAL OCCASION MAKER", titleJp: "„Çπ„Éö„Ç∑„É£„É´„Éª„Ç™„Ç±„Éº„Ç∏„Éß„É≥„Éª„É°„Ç§„Ç´„Éº", action: "Ë®òÂøµÊó•„ÇÑ„ÅäÁ•ù„ÅÑ„ÇíÁâπÂà•„Å™‰ΩìÈ®ì„Å´Â§â„Åà„Çã„ÄÇ„Çµ„Éó„É©„Ç§„Ç∫„ÅÆÈÅî‰∫∫„Å´„Å™„Çã„ÄÇ" },
            { id: "083", titleEn: "THE ALLERGY GUARDIAN", titleJp: "„Ç¢„É¨„É´„ÇÆ„Éº„Éª„Ç¨„Éº„Éá„Ç£„Ç¢„É≥", action: "„Ç¢„É¨„É´„ÇÆ„Éº„ÇÑÈ£ü‰∫ãÂà∂Èôê„ÇíÂÆåÁíß„Å´ÊääÊè°„ÄÇ„Ç≤„Çπ„Éà„ÅÆÂÆâÂÖ®„ÇíÂÆà„Çã„ÄÇ" },
            { id: "084", titleEn: "CHILD FRIENDLY HERO", titleJp: "„ÉÅ„É£„Ç§„É´„Éâ„Éª„Éï„É¨„É≥„Éâ„É™„Éº„Éª„Éí„Éº„É≠„Éº", action: "Â≠ê„Å©„ÇÇÈÄ£„Çå„ÅÆ„Ç≤„Çπ„Éà„Å´ÂØÑ„ÇäÊ∑ª„ÅÜ„ÄÇÂ≠ê„Å©„ÇÇ„ÅåÁ¨ëÈ°î„Å™„Çâ„ÄÅË¶™„ÇÇÂπ∏„Åõ„ÄÇ" },
            { id: "085", titleEn: "THE TABLE ARTIST", titleJp: "„ÉÜ„Éº„Éñ„É´„Éª„Ç¢„Éº„ÉÜ„Ç£„Çπ„Éà", action: "„Éá„Ç∂„Ç§„É≥„ÅÆÂõõÂéüÂâá„ÇíÂü∫„Å´„ÄÅ„ÉÜ„Éº„Éñ„É´„Çª„ÉÉ„ÉÜ„Ç£„É≥„Ç∞„Å´È≠Ç„ÇíËæº„ÇÅ„Çã„ÄÇ" },
            { id: "086", titleEn: "TIMING VIRTUOSO", titleJp: "„Çø„Ç§„Éü„É≥„Ç∞„Éª„É¥„Ç£„É´„Éà„Ç•„Ç™„Éº„ÇΩ", action: "ÊñôÁêÜ„ÇíÂá∫„Åô„Çø„Ç§„Éü„É≥„Ç∞„ÄÅ„ÅäÁöø„Çí‰∏ã„Åí„Çã„Çø„Ç§„Éü„É≥„Ç∞„ÄÇÂÆåÁíß„Å™„É™„Ç∫„É†„ÇíÂ•è„Åß„Çã„ÄÇ" },
            { id: "087", titleEn: "THE STORYTELLER", titleJp: "„Ç∂„Éª„Çπ„Éà„Éº„É™„Éº„ÉÜ„É©„Éº", action: "ÊñôÁêÜ„ÇÑ„ÉØ„Ç§„É≥„ÅÆËÉåÊôØ„Å´„ÅÇ„ÇãÁâ©Ë™û„Çí„ÄÅÈ≠ÖÂäõÁöÑ„Å´‰ºù„Åà„Çã„ÄÇ" },
            { id: "088", titleEn: "EMOTIONAL INTELLIGENCE", titleJp: "„Ç®„É¢„Éº„Ç∑„Éß„Éä„É´„Éª„Ç§„É≥„ÉÜ„É™„Ç∏„Çß„É≥„Çπ", action: "„Ç≤„Çπ„Éà„ÅÆÊÑüÊÉÖ„Å´ÂØÑ„ÇäÊ∑ª„ÅÜ„ÄÇÂñú„Å≥„ÅØÂÖ±„Å´Âñú„Å≥„ÄÅÊÇ≤„Åó„Åø„Å´„ÅØÂÑ™„Åó„Åè„ÄÇ" },
            { id: "089", titleEn: "THE DETAIL DETECTIVE", titleJp: "„Éá„Ç£„ÉÜ„Éº„É´„Éª„Éá„Ç£„ÉÜ„ÇØ„ÉÜ„Ç£„Éñ", action: "Á¥∞ÈÉ®„Å´„Åì„Å†„Çè„Çã„ÄÇ„Ç∞„É©„Çπ„ÅÆÊõá„Çä„ÄÅ„Ç∑„Éß„Ç¶„Éó„É¨„Éº„Éà„ÅÆË£èÂÅ¥„Åæ„Åß„ÄÅ„Åô„Åπ„Å¶„Å´Ê∞ó„ÇíÈÖç„Çã„ÄÇ" },
            { id: "090", titleEn: "COMFORT ZONE CREATOR", titleJp: "„Ç≥„É≥„Éï„Ç©„Éº„Éà„Éª„Çæ„Éº„É≥„Éª„ÇØ„É™„Ç®„Ç§„Çø„Éº", action: "„Ç≤„Çπ„Éà„Åå„É™„É©„ÉÉ„ÇØ„Çπ„Åß„Åç„ÇãÁ©∫Èñì„Çí‰Ωú„Çã„ÄÇÁ∑äÂºµ„Åï„Åõ„Å™„ÅÑ„ÄÅ„Åß„ÇÇÁâπÂà•„Å™‰ΩìÈ®ì„Çí„ÄÇ" },
            // ===== LEGACY (091-100) =====
            { id: "091", titleEn: "THE LEGACY MINDSET", titleJp: "„É¨„Ç¨„Ç∑„Éº„Éª„Éû„Ç§„É≥„Éâ„Çª„ÉÉ„Éà", action: "‰ªäÊó•„ÅÆË°åÂãï„Åå„ÄÅ10Âπ¥Âæå„ÅÆ„ÅäÂ∫ó„Çí‰Ωú„Çã„ÄÇ„Åù„ÅÆÊÑèË≠ò„ÅßÂÉç„Åè„ÄÇ" },
            { id: "092", titleEn: "CULTURE CARRIER", titleJp: "„Ç´„É´„ÉÅ„É£„Éº„Éª„Ç≠„É£„É™„Ç¢„Éº", action: "„ÅäÂ∫ó„ÅÆÊñáÂåñ„Å®‰æ°ÂÄ§Ë¶≥„Çí‰ΩìÁèæ„Åó„ÄÅÊ¨°„ÅÆ‰∏ñ‰ª£„Å´‰ºù„Åà„Çã„ÄÇ" },
            { id: "093", titleEn: "THE PRIDE OF CRAFT", titleJp: "„Éó„É©„Ç§„Éâ„Éª„Ç™„Éñ„Éª„ÇØ„É©„Éï„Éà", action: "„É¨„Çπ„Éà„É©„É≥„ÅÆ‰ªï‰∫ã„ÇíË™á„Çä„Å´ÊÄù„ÅÜ„ÄÇ„Åì„ÅÆ‰ªï‰∫ã„ÅÆÁæé„Åó„Åï„Çí‰∏ñ„Å´Á§∫„Åô„ÄÇ" },
            { id: "094", titleEn: "COMMUNITY BUILDER", titleJp: "„Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Éª„Éì„É´„ÉÄ„Éº", action: "„ÉØ„Ç§„É≥‰ºö„Å™„Å©„ÅÆÈñãÂÇ¨„ÇíÈÄö„Åó„Å¶„ÄÅ„Ç∞„É´„Éº„Éó„Çí‰∏≠ÂøÉ„Å®„Åó„Åü„Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Çí‰Ωú„Çã„ÄÇ" },
            { id: "095", titleEn: "THE SUSTAINABILITY CHAMPION", titleJp: "„Çµ„Çπ„ÉÜ„Éä„Éì„É™„ÉÜ„Ç£„Éª„ÉÅ„É£„É≥„Éî„Ç™„É≥", action: "Áí∞Â¢É„Å´ÂÑ™„Åó„ÅÑÈÅ∏Êäû„ÇíÊÑèË≠ò„Åô„Çã„ÄÇÊú™Êù•„ÅÆ‰∏ñ‰ª£„ÅÆ„Åü„ÇÅ„Å´„ÄÇ" },
            { id: "096", titleEn: "INDUSTRY AMBASSADOR", titleJp: "„Ç§„É≥„ÉÄ„Çπ„Éà„É™„Éº„Éª„Ç¢„É≥„Éê„Çµ„ÉÄ„Éº", action: "„É¨„Çπ„Éà„É©„É≥Ê•≠Áïå„ÅÆÈ≠ÖÂäõ„ÇíÂ§ñÈÉ®„Å´Áô∫‰ø°„Åô„Çã„ÄÇ" },
            { id: "097", titleEn: "THE INSPIRATION SOURCE", titleJp: "„Ç§„É≥„Çπ„Éî„É¨„Éº„Ç∑„Éß„É≥„Éª„ÇΩ„Éº„Çπ", action: "‰ª≤Èñì„Å´„Ç§„É≥„Çπ„Éî„É¨„Éº„Ç∑„Éß„É≥„Çí‰∏é„Åà„ÇãÂ≠òÂú®„Å´„Å™„Çã„ÄÇ" },
            { id: "098", titleEn: "DREAM KEEPER", titleJp: "„Éâ„É™„Éº„É†„Éª„Ç≠„Éº„Éë„Éº", action: "Ëá™ÂàÜ„ÅÆÂ§¢„ÇíÂøò„Çå„Å™„ÅÑ„ÄÇÂ§¢„Åå„ÅÇ„Çã„Åã„Çâ„ÄÅ‰ªäÊó•„ÇÇÈ†ëÂºµ„Çå„Çã„ÄÇ" },
            { id: "099", titleEn: "THE GRATITUDE PRACTICE", titleJp: "„Ç∞„É©„ÉÜ„Ç£„ÉÅ„É•„Éº„Éâ„Éª„Éó„É©„ÇØ„ÉÜ„Ç£„Çπ", action: "ÊØéÊó•„ÄÅÊÑüË¨ù„Åß„Åç„Çã„Åì„Å®„Çí3„Å§Ë¶ã„Å§„Åë„Çã„ÄÇÊÑüË¨ù„ÅÆÂøÉ„ÅåÊúÄÈ´ò„ÅÆÊé•ÂÆ¢„ÇíÁîü„ÇÄ„ÄÇ" },
            { id: "100", titleEn: "ONE PURPOSE", titleJp: "„ÉØ„É≥„Éª„Éë„Éº„Éë„Çπ", action: "ÂÖ®„Å¶„ÅÆÂà§Êñ≠„Çí„Äå„É¨„Çπ„Éà„É©„É≥„ÅÆ‰ªï‰∫ã„ÅåÂ≠ê„Å©„ÇÇ„Åü„Å°„ÅÆÊÜß„Çå„ÅÆËÅ∑Ê•≠„Å´„Å™„Çã„Äç„Åü„ÇÅ„Å´Ë°å„ÅÜ„ÄÇ" }
        ];


        let currentQuests = [];
        let currentRating = 0;
        let selectedBase = null;
        let todayBase = null; // „Åù„ÅÆÊó•„ÅÆÂã§ÂãôÂÖà
        let workDate = null; // Âã§ÂãôÊó•
        const checkFields = ['condition', 'temp', 'fatigue', 'nausea', 'nails', 'hands', 'uniform'];
        const mindFields = ['mind_enjoy', 'mind_morning', 'mind_consult'];
        let checks = {};
        let mindChecks = {};
        let shiftTimes = { start: '', end: '' };

        // TO-DO LIST DATA
        let todos = {
            daily: [],
            weekly: [],
            monthly: []
        };

        // Load todos from localStorage
        function loadTodos() {
            const saved = localStorage.getItem('mindful_todos');
            if (saved) {
                todos = JSON.parse(saved);
            }
            renderTodos('daily');
            renderTodos('weekly');
            renderTodos('monthly');
        }

        // Save todos to localStorage
        function saveTodos() {
            localStorage.setItem('mindful_todos', JSON.stringify(todos));
        }

        // Show todo tab
        function showTodoTab(tab) {
            // Update tabs
            document.querySelectorAll('.todo-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // Update content
            document.querySelectorAll('.todo-content').forEach(c => c.classList.remove('active'));
            document.getElementById('todo-' + tab).classList.add('active');
        }

        // Add todo
        function addTodo(type) {
            const input = document.getElementById(type + 'TodoInput');
            const text = input.value.trim();
            if (!text) return;

            const newTodo = {
                id: Date.now(),
                text: text,
                completed: false,
                createdAt: new Date().toISOString()
            };

            todos[type].unshift(newTodo);
            saveTodos();
            renderTodos(type);
            input.value = '';
        }

        // Toggle todo completion
        function toggleTodo(type, id) {
            const todo = todos[type].find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                saveTodos();
                renderTodos(type);
            }
        }

        // Delete todo
        function deleteTodo(type, id) {
            todos[type] = todos[type].filter(t => t.id !== id);
            saveTodos();
            renderTodos(type);
        }

        // Render todos
        function renderTodos(type) {
            const list = document.getElementById(type + 'TodoList');
            if (!list) return;

            if (todos[type].length === 0) {
                list.innerHTML = '<div class="todo-empty">„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }

            list.innerHTML = todos[type].map(todo => `
                <div class="todo-item ${todo.completed ? 'completed' : ''}">
                    <div class="todo-checkbox ${todo.completed ? 'checked' : ''}" onclick="toggleTodo('${type}', ${todo.id})"></div>
                    <span class="todo-text">${escapeHtml(todo.text)}</span>
                    <button class="todo-delete" onclick="deleteTodo('${type}', ${todo.id})">√ó</button>
                </div>
            `).join('');
        }

        // Escape HTML for XSS prevention
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function setShiftTime(type, time) {
            shiftTimes[type] = time;
            const container = type === 'start' ? document.getElementById('shiftStartBtns') : document.getElementById('shiftEndBtns');
            container.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        function updateShiftTimeDisplay() {
            const display = document.getElementById('shiftTimeDisplay');
            if (display) {
                if (shiftTimes.start && shiftTimes.end) {
                    display.innerHTML = `üïê ${shiftTimes.start} „Äú ${shiftTimes.end}`;
                } else if (shiftTimes.start) {
                    display.innerHTML = `üïê ${shiftTimes.start} „Äú`;
                } else if (shiftTimes.end) {
                    display.innerHTML = `üïê „Äú ${shiftTimes.end}`;
                } else {
                    display.innerHTML = '';
                }
            }
        }

        function initWorkDate() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            workDate = `${yyyy}-${mm}-${dd}`;
            const dateInput = document.getElementById('workDateInput');
            if (dateInput) {
                dateInput.value = workDate;
            }
        }

        function updateWorkDate(value) {
            workDate = value;
            localStorage.setItem('mindful_work_date', workDate);

            // „Åù„ÅÆÊó•‰ªò„ÅßÊó¢„Å´C/IN„Åó„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            const checkedDates = JSON.parse(localStorage.getItem('mindful_checked_dates') || '[]');
            const alreadyCheckedIn = checkedDates.includes(workDate);

            const statusEl = document.getElementById('todayLocationStatus');
            const drawArea = document.getElementById('drawArea');

            if (alreadyCheckedIn) {
                if (statusEl) {
                    statusEl.innerHTML = '‚ö†Ô∏è „Åì„ÅÆÊó•‰ªò„ÅØÊó¢„Å´C/INÊ∏à„Åø„Åß„ÅôÔºà1Êó•1ÂõûÔºâ';
                    statusEl.style.color = 'var(--gold)';
                }
                if (drawArea) {
                    drawArea.style.pointerEvents = 'none';
                    drawArea.style.opacity = '0.5';
                }
            } else {
                if (statusEl && todayBase) {
                    statusEl.innerHTML = `‚úì ${todayBase.toUpperCase()} „Å´C/IN‰∫àÂÆö`;
                    statusEl.style.color = 'var(--success)';
                } else if (statusEl) {
                    statusEl.innerHTML = 'Âã§ÂãôÂÖà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                    statusEl.style.color = 'var(--text-gray)';
                }
                if (drawArea) {
                    drawArea.style.pointerEvents = 'auto';
                    drawArea.style.opacity = '1';
                }
            }

            // ===== „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏„ÇíÊõ¥Êñ∞ =====
            updateDailyStatusBadges();

            console.log('Work date updated:', value, 'Already checked in:', alreadyCheckedIn);
        }

        // ===== C/IN„ÉªC/OUT „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏Êõ¥Êñ∞ =====
        function updateDailyStatusBadges() {
            const targetDate = workDate || new Date().toISOString().split('T')[0];
            console.log('[StatusBadge] Checking date:', targetDate);

            // C/IN„Çπ„ÉÜ„Éº„Çø„Çπ
            const checkedInDates = JSON.parse(localStorage.getItem('mindful_checked_dates') || '[]');
            const isCheckedIn = checkedInDates.includes(targetDate);
            console.log('[StatusBadge] C/IN dates:', checkedInDates, 'isCheckedIn:', isCheckedIn);

            // C/OUT„Çπ„ÉÜ„Éº„Çø„Çπ
            const checkedOutDates = JSON.parse(localStorage.getItem('mindful_checkout_dates') || '[]');
            const isCheckedOut = checkedOutDates.includes(targetDate);
            console.log('[StatusBadge] C/OUT dates:', checkedOutDates, 'isCheckedOut:', isCheckedOut);

            // C/IN„Éê„ÉÉ„Ç∏Êõ¥Êñ∞
            const checkinBadge = document.getElementById('checkinStatusBadge');
            const checkinText = document.getElementById('checkinStatusText');
            if (checkinBadge && checkinText) {
                if (isCheckedIn) {
                    checkinBadge.style.background = 'rgba(34, 197, 94, 0.15)';
                    checkinBadge.style.color = 'var(--success)';
                    checkinText.textContent = 'ÂÆå‰∫Ü ‚úì';
                } else {
                    checkinBadge.style.background = 'var(--light-gray)';
                    checkinBadge.style.color = 'var(--text-gray)';
                    checkinText.textContent = 'Êú™ÂÆå‰∫Ü';
                }
            }

            // C/OUT„Éê„ÉÉ„Ç∏Êõ¥Êñ∞
            const checkoutBadge = document.getElementById('checkoutStatusBadge');
            const checkoutText = document.getElementById('checkoutStatusText');
            if (checkoutBadge && checkoutText) {
                if (isCheckedOut) {
                    checkoutBadge.style.background = 'rgba(201, 169, 98, 0.2)';
                    checkoutBadge.style.color = 'var(--gold)';
                    checkoutText.textContent = 'ÂÆå‰∫Ü ‚úì';
                } else if (isCheckedIn) {
                    checkoutBadge.style.background = 'rgba(245, 158, 11, 0.15)';
                    checkoutBadge.style.color = 'var(--warning)';
                    checkoutText.textContent = 'Êú™ÂÆå‰∫Ü';
                } else {
                    checkoutBadge.style.background = 'var(--light-gray)';
                    checkoutBadge.style.color = 'var(--text-gray)';
                    checkoutText.textContent = '--';
                }
            }
        }

        function markDateAsCheckedIn(date) {
            const checkedDates = JSON.parse(localStorage.getItem('mindful_checked_dates') || '[]');
            if (!checkedDates.includes(date)) {
                checkedDates.push(date);
                localStorage.setItem('mindful_checked_dates', JSON.stringify(checkedDates));
            }
            // „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏„ÇíÊõ¥Êñ∞
            updateDailyStatusBadges();
        }

        function init() {
            checkFields.forEach(f => checks[f] = null);
            mindFields.forEach(f => mindChecks[f] = null);
            loadHistory();
            setupStarRating();
            initWorkDate(); // Êó•‰ªò„ÇíÂàùÊúüÂåñ
            updateDailyStatusBadges(); // ===== Ëµ∑ÂãïÊôÇ„Å´C/IN„ÉªC/OUT„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÊõ¥Êñ∞ =====
            loadTodos(); // To-Do„É™„Çπ„Éà„Çí„É≠„Éº„Éâ
            const profile = JSON.parse(localStorage.getItem('mindful_profile') || 'null');
            if (profile) {
                showUserBadge(profile);
                updateTokenDisplay();
                showGoalsDisplay(profile);

                // ===== Êó¢Â≠ò„É¶„Éº„Ç∂„Éº„ÅÆPIN„ÉÅ„Çß„ÉÉ„ÇØ =====
                if (!profile.pin) {
                    // PIN„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ ‚Üí Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
                    const tokens = localStorage.getItem('mindful_tokens') || '0';
                    document.getElementById('setupTokenDisplay').textContent = tokens;
                    document.getElementById('pinSetupModal').style.display = 'block';
                    // ËÉåÂæå„ÅÆÁîªÈù¢„ÅØË°®Á§∫„Åó„Å¶„Åä„Åè
                    showScreen('screen-morning');
                } else {
                    checkActiveSession();
                    showScreen('screen-morning');
                }
            }
            else { showScreen('screen-register'); }
        }

        // ===== Êó¢Â≠ò„É¶„Éº„Ç∂„Éº„ÅÆPINË®≠ÂÆö‰øùÂ≠ò =====
        async function savePinSetup() {
            const pin = document.getElementById('setupPin').value.trim();
            const pinConfirm = document.getElementById('setupPinConfirm').value.trim();
            const errorEl = document.getElementById('setupPinError');

            errorEl.style.display = 'none';

            if (!pin || pin.length !== 4 || !/^\d{4}$/.test(pin)) {
                errorEl.textContent = 'PIN„ÅØ4Ê°Å„ÅÆÊï∞Â≠ó„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                errorEl.style.display = 'block';
                return;
            }

            if (pin !== pinConfirm) {
                errorEl.textContent = 'PIN„Åå‰∏ÄËá¥„Åó„Åæ„Åõ„Çì';
                errorEl.style.display = 'block';
                return;
            }

            // „Éó„É≠„Éï„Ç£„Éº„É´„Å´PIN„Çí‰øùÂ≠ò
            const profile = JSON.parse(localStorage.getItem('mindful_profile') || '{}');
            profile.pin = pin;
            localStorage.setItem('mindful_profile', JSON.stringify(profile));

            // „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Å´„ÇÇÁôªÈå≤ÔºàÈùûÂêåÊúüÔºâ
            const base = profile.base || todayBase || 'moiwayama';
            const url = SCRIPT_URLS[base];
            if (url) {
                try {
                    const tokens = localStorage.getItem('mindful_tokens') || '0';
                    await fetch(`${url}?action=register&name=${encodeURIComponent(profile.name)}&pin=${encodeURIComponent(pin)}&base=${encodeURIComponent(base)}${tokenParam()}`);
                    console.log('PIN saved to backend');
                } catch (e) {
                    console.error('Backend PIN save error:', e);
                }
            }

            // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
            document.getElementById('pinSetupModal').style.display = 'none';

            // ÈÄöÂ∏∏„ÅÆ„Éï„É≠„Éº„Å∏
            checkActiveSession();
        }


        function selectBase(el) {
            document.querySelectorAll('.base-option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            selectedBase = el.dataset.base;
            validateRegistration();
        }

        function validateRegistration() {
            const name = document.getElementById('inputName').value.trim();
            document.getElementById('registerBtn').disabled = !(name && selectedBase);
        }
        document.getElementById('inputName').addEventListener('input', validateRegistration);

        function register() {
            const name = document.getElementById('inputName').value.trim();
            const pin = document.getElementById('inputPin').value.trim();

            // PIN„Éê„É™„Éá„Éº„Ç∑„Éß„É≥
            if (!pin || pin.length !== 4 || !/^\d{4}$/.test(pin)) {
                alert('PIN„ÅØ4Ê°Å„ÅÆÊï∞Â≠ó„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            // ÁõÆÊ®ô„Å®Â§¢„ÇíÈÖçÂàó„Å®„Åó„Å¶ÂèéÈõÜÔºàÁ©∫„Åß„Å™„ÅÑ„ÇÇ„ÅÆ„ÅÆ„ÅøÔºâ
            const goalsThisYear = [
                document.getElementById('inputGoalThisYear1').value.trim(),
                document.getElementById('inputGoalThisYear2').value.trim(),
                document.getElementById('inputGoalThisYear3').value.trim()
            ].filter(g => g !== '');
            const goalsFuture = [
                document.getElementById('inputGoalFuture1').value.trim(),
                document.getElementById('inputGoalFuture2').value.trim(),
                document.getElementById('inputGoalFuture3').value.trim()
            ].filter(g => g !== '');

            if (name && selectedBase) {
                // „É≠„Éº„Ç´„É´„Å´‰øùÂ≠ò
                const profile = { name, base: selectedBase, pin: pin, goalsThisYear, goalsFuture };
                localStorage.setItem('mindful_profile', JSON.stringify(profile));

                // „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Å´„ÇÇÁôªÈå≤ÔºàÈùûÂêåÊúüÔºâ- ÁõÆÊ®ô„ÇíÂê´„ÇÅ„Çã
                registerToBackend(name, pin, selectedBase, goalsThisYear, goalsFuture);

                showUserBadge(profile);
                showGoalsDisplay(profile);
                showScreen('screen-morning');
            }
        }

        // „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Å´„É¶„Éº„Ç∂„ÉºÁôªÈå≤
        async function registerToBackend(name, pin, base, goalsThisYear, goalsFuture) {
            const url = SCRIPT_URLS[base];
            if (!url) return;

            try {
                const goalsThisYearStr = encodeURIComponent(JSON.stringify(goalsThisYear || []));
                const goalsFutureStr = encodeURIComponent(JSON.stringify(goalsFuture || []));
                const response = await fetch(`${url}?action=register&name=${encodeURIComponent(name)}&pin=${encodeURIComponent(pin)}&base=${encodeURIComponent(base)}&goalsThisYear=${goalsThisYearStr}&goalsFuture=${goalsFutureStr}${tokenParam()}`);
                const result = await response.json();
                console.log('Backend registration:', result);
            } catch (e) {
                console.error('Backend registration error:', e);
            }
        }

        // „É≠„Ç∞„Ç§„É≥ÁîªÈù¢„ÇíË°®Á§∫
        function showLoginScreen() {
            showScreen('screen-login');
        }

        // „É≠„Ç∞„Ç§„É≥ÂÆüË°å
        async function performLogin() {
            const name = document.getElementById('loginName').value.trim();
            const pin = document.getElementById('loginPin').value.trim();
            const errorEl = document.getElementById('loginError');

            if (!name || !pin) {
                errorEl.textContent = 'ÂêçÂâç„Å®PIN„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                errorEl.style.display = 'block';
                return;
            }

            // ÂÖ®Êã†ÁÇπ„ÅÆ„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„ÇíÈ†ÜÁï™„Å´Ë©¶„Åô
            const bases = ['moiwayama', 'okurayama', 'tvtower', 'akarenga'];
            let loginSuccess = false;

            for (const base of bases) {
                const url = SCRIPT_URLS[base];
                if (!url) continue;

                try {
                    const response = await fetch(`${url}?action=login&name=${encodeURIComponent(name)}&pin=${encodeURIComponent(pin)}${tokenParam()}`);
                    const result = await response.json();

                    if (result.success) {
                        // „É≠„Ç∞„Ç§„É≥ÊàêÂäüÔºÅ„Éá„Éº„Çø„ÇíÂæ©ÂÖÉÔºàÁõÆÊ®ô„Å®ÂÜôÁúü„ÇíÂê´„ÇÄÔºâ
                        const profile = {
                            name: result.name,
                            base: result.base || base,
                            pin: pin,
                            goalsThisYear: result.goalsThisYear || [],
                            goalsFuture: result.goalsFuture || []
                        };
                        localStorage.setItem('mindful_profile', JSON.stringify(profile));

                        // „Éà„Éº„ÇØ„É≥ÊÆãÈ´ò„ÇíÂæ©ÂÖÉ
                        if (result.tokenBalance) {
                            localStorage.setItem('mindful_tokens', result.tokenBalance.toString());
                        }

                        // C/OÂ±•Ê≠¥„ÇíÂæ©ÂÖÉ
                        if (result.checkoutDates && result.checkoutDates.length > 0) {
                            localStorage.setItem('mindful_checkout_dates', JSON.stringify(result.checkoutDates));
                        }

                        // ÂÜôÁúü„ÇíÂæ©ÂÖÉ
                        if (result.profileImage) {
                            localStorage.setItem('mindful_photo', result.profileImage);
                        }

                        loginSuccess = true;
                        showUserBadge(profile);
                        showGoalsDisplay(profile);
                        updateTokenDisplay();
                        loadProfilePhoto();
                        showScreen('screen-morning');
                        break;
                    }
                } catch (e) {
                    console.error('Login error for', base, ':', e);
                }
            }

            if (!loginSuccess) {
                errorEl.textContent = 'ÂêçÂâç„Åæ„Åü„ÅØPIN„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì';
                errorEl.style.display = 'block';
            }
        }

        // ===== PINÂ§âÊõ¥Èñ¢ÈÄ£Èñ¢Êï∞ =====
        function openPinChangeModal() {
            document.getElementById('pinChangeModal').style.display = 'block';
            document.getElementById('currentPin').value = '';
            document.getElementById('newPin').value = '';
            document.getElementById('confirmNewPin').value = '';
            document.getElementById('pinChangeError').style.display = 'none';
            document.getElementById('pinChangeSuccess').style.display = 'none';
        }

        function closePinChangeModal() {
            document.getElementById('pinChangeModal').style.display = 'none';
        }

        async function changePin() {
            const currentPin = document.getElementById('currentPin').value.trim();
            const newPin = document.getElementById('newPin').value.trim();
            const confirmNewPin = document.getElementById('confirmNewPin').value.trim();
            const errorEl = document.getElementById('pinChangeError');
            const successEl = document.getElementById('pinChangeSuccess');

            errorEl.style.display = 'none';
            successEl.style.display = 'none';

            // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥
            const profile = JSON.parse(localStorage.getItem('mindful_profile') || '{}');

            if (!currentPin || !newPin || !confirmNewPin) {
                errorEl.textContent = '„Åô„Åπ„Å¶„ÅÆÈ†ÖÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                errorEl.style.display = 'block';
                return;
            }

            if (!/^\d{4}$/.test(newPin)) {
                errorEl.textContent = 'Êñ∞„Åó„ÅÑPIN„ÅØ4Ê°Å„ÅÆÊï∞Â≠ó„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                errorEl.style.display = 'block';
                return;
            }

            if (newPin !== confirmNewPin) {
                errorEl.textContent = 'Êñ∞„Åó„ÅÑPIN„Åå‰∏ÄËá¥„Åó„Åæ„Åõ„Çì';
                errorEl.style.display = 'block';
                return;
            }

            // „É≠„Éº„Ç´„É´„Å´‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„ÇãPIN„Å®ÁÖßÂêà
            if (profile.pin && profile.pin !== currentPin) {
                errorEl.textContent = 'ÁèæÂú®„ÅÆPIN„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì';
                errorEl.style.display = 'block';
                return;
            }

            // „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„ÅßPINÂ§âÊõ¥„ÇíË©¶„Åø„Çã
            const base = profile.base || 'moiwayama';
            const url = SCRIPT_URLS[base];

            if (url) {
                try {
                    const response = await fetch(`${url}?action=changePin&name=${encodeURIComponent(profile.name)}&currentPin=${encodeURIComponent(currentPin)}&newPin=${encodeURIComponent(newPin)}${tokenParam()}`);
                    const result = await response.json();

                    if (!result.success) {
                        errorEl.textContent = result.error || 'PINÂ§âÊõ¥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü';
                        errorEl.style.display = 'block';
                        return;
                    }
                } catch (e) {
                    console.error('PIN change error:', e);
                    // „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Ç®„É©„Éº„Åß„ÇÇ„É≠„Éº„Ç´„É´„ÅØÊõ¥Êñ∞
                }
            }

            // „É≠„Éº„Ç´„É´„Éó„É≠„Éï„Ç£„Éº„É´„ÇíÊõ¥Êñ∞
            profile.pin = newPin;
            localStorage.setItem('mindful_profile', JSON.stringify(profile));

            successEl.textContent = 'PIN„ÇíÂ§âÊõ¥„Åó„Åæ„Åó„ÅüÔºÅ';
            successEl.style.display = 'block';

            // 2ÁßíÂæå„Å´„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
            setTimeout(() => {
                closePinChangeModal();
            }, 2000);
        }

        function showUserBadge(profile) {
            const badge = document.getElementById('userBadge');
            if (todayBase && todayBase !== profile.base) {
                badge.innerHTML = `${profile.name} <span style="font-size: 10px; opacity: 0.7;">üè†${BASE_NAMES[profile.base]}</span> ‚Üí <span style="color: var(--gold);">üìç${BASE_NAMES[todayBase]}</span>`;
            } else if (todayBase) {
                badge.textContent = `${profile.name} @ ${BASE_NAMES[todayBase]}`;
            } else {
                badge.textContent = `${profile.name} @ ${BASE_NAMES[profile.base]}`;
            }
            badge.style.display = 'inline-block';
        }

        function selectTodayBase(el) {
            document.querySelectorAll('.base-option.today-base').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            todayBase = el.dataset.base;
            localStorage.setItem('mindful_today_base', todayBase);
            document.getElementById('todayLocationStatus').innerHTML = `<span style="color: var(--gold); font-weight: 600;">‚úì ‰ªäÊó•„ÅØ ${BASE_NAMES[todayBase]} „ÅßÂã§Âãô„Åó„Åæ„Åô</span>`;
            const profile = JSON.parse(localStorage.getItem('mindful_profile'));
            if (profile) showUserBadge(profile);
            validateHealthCheck();
        }

        function showProfile() {
            const profile = JSON.parse(localStorage.getItem('mindful_profile') || 'null');
            if (!profile) {
                showScreen('screen-register');
                return;
            }

            // „Éó„É≠„Éï„Ç£„Éº„É´ÁîªÈù¢„Å´ÊÉÖÂ†±„ÇíË°®Á§∫
            document.getElementById('profileName').textContent = profile.name;
            document.getElementById('profileBase').textContent = BASE_NAMES[profile.base] || profile.base;

            // ÁõÆÊ®ô„Å®Â§¢„ÇíË°®Á§∫ÔºàÁ∑®ÈõÜÂèØËÉΩ„Å™„É™„Çπ„ÉàÂΩ¢ÂºèÔºâ
            const goalsThisYear = profile.goalsThisYear || (profile.goalThisYear ? [profile.goalThisYear] : []);
            const goalsFuture = profile.goalsFuture || (profile.goalFuture ? [profile.goalFuture] : []);

            document.getElementById('profileGoalsThisYear').innerHTML = goalsThisYear.length > 0
                ? goalsThisYear.map((g, i) => `
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px; padding: 8px; background: rgba(255,255,255,0.5); border-radius: 6px;">
                        <span style="flex: 1; color: var(--navy); font-size: 13px;">${i + 1}. ${g}</span>
                        <button onclick="editGoal('thisYear', ${i})" style="background: none; border: none; cursor: pointer; font-size: 14px;">‚úèÔ∏è</button>
                        <button onclick="deleteGoal('thisYear', ${i})" style="background: none; border: none; cursor: pointer; font-size: 14px;">üóëÔ∏è</button>
                    </div>
                `).join('')
                : '<div style="color: var(--text-gray); font-size: 12px;">„Åæ„Å†Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</div>';

            document.getElementById('profileGoalsFuture').innerHTML = goalsFuture.length > 0
                ? goalsFuture.map((g, i) => `
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px; padding: 8px; background: rgba(255,255,255,0.5); border-radius: 6px;">
                        <span style="flex: 1; color: var(--navy); font-size: 13px;">${i + 1}. ${g}</span>
                        <button onclick="editGoal('future', ${i})" style="background: none; border: none; cursor: pointer; font-size: 14px;">‚úèÔ∏è</button>
                        <button onclick="deleteGoal('future', ${i})" style="background: none; border: none; cursor: pointer; font-size: 14px;">üóëÔ∏è</button>
                    </div>
                `).join('')
                : '<div style="color: var(--text-gray); font-size: 12px;">„Åæ„Å†Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</div>';

            document.getElementById('profileTokens').textContent = getTokenBalance();

            // ÂÜôÁúü„ÇíË™≠„ÅøËæº„Åø
            loadProfilePhoto();

            showScreen('screen-profile');
        }

        function confirmEditProfile() {
            if (confirm('„Éó„É≠„Éï„Ç£„Éº„É´„ÇíÁ∑®ÈõÜ„Åó„Åæ„Åô„ÅãÔºü\nÔºàÁèæÂú®„ÅÆÁôªÈå≤ÊÉÖÂ†±„ÅØÂâäÈô§„Åï„Çå„Åæ„ÅôÔºâ')) {
                localStorage.removeItem('mindful_profile');
                localStorage.removeItem('mindful_checkin_time');
                localStorage.removeItem('mindful_photo');
                selectedBase = null;
                document.querySelectorAll('.base-option').forEach(o => o.classList.remove('selected'));
                document.getElementById('inputName').value = '';
                document.getElementById('inputGoalThisYear1').value = '';
                document.getElementById('inputGoalThisYear2').value = '';
                document.getElementById('inputGoalThisYear3').value = '';
                document.getElementById('inputGoalFuture1').value = '';
                document.getElementById('inputGoalFuture2').value = '';
                document.getElementById('inputGoalFuture3').value = '';
                document.getElementById('userBadge').style.display = 'none';
                document.getElementById('goalsDisplay').style.display = 'none';
                showScreen('screen-register');
            }
        }

        // Legacy function - redirects to showProfile
        function editProfile() {
            showProfile();
        }

        // ===== Êñ∞„Åó„ÅÑÁõÆÊ®ô„ÉªÂ§¢ÁÆ°ÁêÜÊ©üËÉΩÔºàprompt„Éô„Éº„ÇπÔºâ=====
        function addGoal(type) {
            const label = type === 'thisYear' ? '‰ªäÂπ¥„ÅÆÁõÆÊ®ô' : 'Â∞ÜÊù•„ÅÆÂ§¢';
            const input = prompt(`${label}„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:`);
            if (!input || input.trim() === '') return;

            const profile = JSON.parse(localStorage.getItem('mindful_profile') || 'null');
            if (!profile) return;

            const key = type === 'thisYear' ? 'goalsThisYear' : 'goalsFuture';
            if (!profile[key]) profile[key] = [];
            if (profile[key].length >= 3) {
                alert(`${label}„ÅØÊúÄÂ§ß3„Å§„Åæ„Åß„Åß„Åô`);
                return;
            }

            profile[key].push(input.trim());
            localStorage.setItem('mindful_profile', JSON.stringify(profile));
            showProfile(); // Ë°®Á§∫„ÇíÊõ¥Êñ∞
        }

        function editGoal(type, index) {
            const profile = JSON.parse(localStorage.getItem('mindful_profile') || 'null');
            if (!profile) return;

            const key = type === 'thisYear' ? 'goalsThisYear' : 'goalsFuture';
            const currentValue = profile[key] && profile[key][index] ? profile[key][index] : '';
            const label = type === 'thisYear' ? '‰ªäÂπ¥„ÅÆÁõÆÊ®ô' : 'Â∞ÜÊù•„ÅÆÂ§¢';

            const newValue = prompt(`${label}„ÇíÁ∑®ÈõÜ:`, currentValue);
            if (newValue === null) return; // „Ç≠„É£„É≥„Çª„É´

            if (newValue.trim() === '') {
                deleteGoal(type, index);
                return;
            }

            profile[key][index] = newValue.trim();
            localStorage.setItem('mindful_profile', JSON.stringify(profile));
            showProfile(); // Ë°®Á§∫„ÇíÊõ¥Êñ∞
        }

        function deleteGoal(type, index) {
            if (!confirm('ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;

            const profile = JSON.parse(localStorage.getItem('mindful_profile') || 'null');
            if (!profile) return;

            const key = type === 'thisYear' ? 'goalsThisYear' : 'goalsFuture';
            if (profile[key]) {
                profile[key].splice(index, 1);
                localStorage.setItem('mindful_profile', JSON.stringify(profile));
                showProfile(); // Ë°®Á§∫„ÇíÊõ¥Êñ∞
            }
        }

        // ÁõÆÊ®ô„ÉªÂ§¢„ÅÆÁ∑®ÈõÜÊ©üËÉΩ
        function openGoalsEditor() {
            const profile = JSON.parse(localStorage.getItem('mindful_profile') || 'null');
            if (!profile) return;

            // Êó¢Â≠ò„Éá„Éº„Çø„ÇíÁ∑®ÈõÜ„Éï„Ç£„Éº„É´„Éâ„Å´Ë™≠„ÅøËæº„ÅøÔºàÈÖçÂàóÂΩ¢ÂºèÂØæÂøúÔºâ
            const goalsThisYear = profile.goalsThisYear || (profile.goalThisYear ? [profile.goalThisYear] : []);
            const goalsFuture = profile.goalsFuture || (profile.goalFuture ? [profile.goalFuture] : []);

            document.getElementById('editGoalThisYear1').value = goalsThisYear[0] || '';
            document.getElementById('editGoalThisYear2').value = goalsThisYear[1] || '';
            document.getElementById('editGoalThisYear3').value = goalsThisYear[2] || '';
            document.getElementById('editGoalFuture1').value = goalsFuture[0] || '';
            document.getElementById('editGoalFuture2').value = goalsFuture[1] || '';
            document.getElementById('editGoalFuture3').value = goalsFuture[2] || '';

            document.getElementById('goalsEditModal').style.display = 'block';
            document.body.classList.add('modal-open');
        }

        function closeGoalsEditor() {
            document.getElementById('goalsEditModal').style.display = 'none';
            document.body.classList.remove('modal-open');
        }

        function saveGoalsEdit() {
            const profile = JSON.parse(localStorage.getItem('mindful_profile') || 'null');
            if (!profile) return;

            // Á∑®ÈõÜ„Éï„Ç£„Éº„É´„Éâ„Åã„ÇâÈÖçÂàó„ÇíÂèéÈõÜÔºàÁ©∫„Åß„Å™„ÅÑ„ÇÇ„ÅÆ„ÅÆ„ÅøÔºâ
            profile.goalsThisYear = [
                document.getElementById('editGoalThisYear1').value.trim(),
                document.getElementById('editGoalThisYear2').value.trim(),
                document.getElementById('editGoalThisYear3').value.trim()
            ].filter(g => g !== '');
            profile.goalsFuture = [
                document.getElementById('editGoalFuture1').value.trim(),
                document.getElementById('editGoalFuture2').value.trim(),
                document.getElementById('editGoalFuture3').value.trim()
            ].filter(g => g !== '');

            // Âè§„ÅÑÂΩ¢Âºè„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§
            delete profile.goalThisYear;
            delete profile.goalFuture;

            localStorage.setItem('mindful_profile', JSON.stringify(profile));

            // „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Å´„ÇÇÂêåÊúü
            syncGoalsToBackend(profile);

            // Ë°®Á§∫„ÇíÊõ¥Êñ∞
            showGoalsDisplay(profile);
            showProfile();
            closeGoalsEditor();
        }

        // ÁõÆÊ®ô„Çí„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Å´ÂêåÊúü
        async function syncGoalsToBackend(profile) {
            const base = profile.base || todayBase || 'moiwayama';
            const url = SCRIPT_URLS[base];
            if (!url || !profile.pin) return;

            try {
                const goalsThisYearStr = encodeURIComponent(JSON.stringify(profile.goalsThisYear || []));
                const goalsFutureStr = encodeURIComponent(JSON.stringify(profile.goalsFuture || []));
                const response = await fetch(`${url}?action=updateGoals&name=${encodeURIComponent(profile.name)}&pin=${encodeURIComponent(profile.pin)}&goalsThisYear=${goalsThisYearStr}&goalsFuture=${goalsFutureStr}${tokenParam()}`);
                const result = await response.json();
                console.log('Goals sync:', result);
            } catch (e) {
                console.error('Goals sync error:', e);
            }
        }

        // ===== Êã†ÁÇπÁßªÁ±çÊ©üËÉΩ =====
        let selectedNewBase = null;

        function openBaseTransferModal() {
            const profile = JSON.parse(localStorage.getItem('mindful_profile') || 'null');
            if (!profile) return;

            const currentBase = profile.base;
            const optionsContainer = document.getElementById('baseTransferOptions');

            // ÁèæÂú®„ÅÆÊã†ÁÇπ‰ª•Â§ñ„ÇíË°®Á§∫
            let html = '';
            for (const [key, name] of Object.entries(BASE_NAMES)) {
                const isDisabled = key === currentBase;
                html += `
                    <div onclick="${isDisabled ? '' : `selectNewBase('${key}')`}"
                        id="baseOption_${key}"
                        style="padding: 14px; border: 2px solid ${isDisabled ? '#ccc' : 'var(--border)'}; border-radius: 10px; 
                               text-align: center; cursor: ${isDisabled ? 'not-allowed' : 'pointer'}; 
                               background: ${isDisabled ? '#f0f0f0' : 'white'}; 
                               color: ${isDisabled ? '#999' : 'var(--navy)'}; font-size: 14px; transition: all 0.2s;">
                        ${name} ${isDisabled ? '(ÁèæÂú®)' : ''}
                    </div>
                `;
            }
            optionsContainer.innerHTML = html;

            selectedNewBase = null;
            document.getElementById('transferError').style.display = 'none';
            document.getElementById('baseTransferModal').style.display = 'block';
            document.body.classList.add('modal-open');
        }

        function closeBaseTransferModal() {
            document.getElementById('baseTransferModal').style.display = 'none';
            document.body.classList.remove('modal-open');
            selectedNewBase = null;
        }

        function selectNewBase(base) {
            selectedNewBase = base;
            // UI„ÇíÊõ¥Êñ∞
            document.querySelectorAll('[id^="baseOption_"]').forEach(el => {
                el.style.border = '2px solid var(--border)';
                el.style.background = 'white';
            });
            const selected = document.getElementById(`baseOption_${base}`);
            if (selected) {
                selected.style.border = '2px solid var(--gold)';
                selected.style.background = 'var(--gold-light)';
            }
            document.getElementById('transferError').style.display = 'none';
        }

        async function confirmBaseTransfer() {
            if (!selectedNewBase) {
                document.getElementById('transferError').textContent = 'ÁßªÁ±çÂÖà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                document.getElementById('transferError').style.display = 'block';
                return;
            }

            const profile = JSON.parse(localStorage.getItem('mindful_profile') || 'null');
            if (!profile || !profile.pin) {
                alert('„Éó„É≠„Éï„Ç°„Ç§„É´ÊÉÖÂ†±„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            const confirmTransfer = confirm(`${BASE_NAMES[selectedNewBase]}„Å´ÁßªÁ±ç„Åó„Åæ„Åô„ÅãÔºü\n\nÂÖ®„Å¶„ÅÆ„Éá„Éº„ÇøÔºà„Éà„Éº„ÇØ„É≥„ÄÅÁõÆÊ®ô„ÄÅÂÜôÁúü„Å™„Å©Ôºâ„ÅåÂºï„ÅçÁ∂ô„Åå„Çå„Åæ„Åô„ÄÇ`);
            if (!confirmTransfer) return;

            const btn = document.getElementById('confirmTransferBtn');
            btn.textContent = 'ÁßªÁ±ç‰∏≠...';
            btn.disabled = true;

            try {
                // ÁßªÁ±çÂÖàGAS„Å´POST„Åß„Éá„Éº„Çø„ÇíÈÄÅ‰ø°
                const url = SCRIPT_URLS[selectedNewBase];
                if (!url) {
                    throw new Error('ÁßªÁ±çÂÖà„ÅÆURL„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                }

                const transferData = {
                    action: 'transferUser',
                    name: profile.name,
                    pin: profile.pin,
                    newBase: selectedNewBase,
                    tokenBalance: parseInt(localStorage.getItem('mindful_tokens') || '0'),
                    goalsThisYear: JSON.stringify(profile.goalsThisYear || []),
                    goalsFuture: JSON.stringify(profile.goalsFuture || []),
                    profileImage: localStorage.getItem('mindful_photo') || '',
                    checkoutDates: localStorage.getItem('mindful_checkout_dates') || '[]'
                };

                const response = await fetch(url, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(transferData)
                });

                // no-cors„É¢„Éº„Éâ„Å™„ÅÆ„Åß„É¨„Çπ„Éù„É≥„Çπ„ÅØË™≠„ÇÅ„Å™„ÅÑ„Åå„ÄÅÊàêÂäü„Å®„Åø„Å™„Åô
                // „É≠„Éº„Ç´„É´ÊÉÖÂ†±„ÇíÊõ¥Êñ∞
                profile.base = selectedNewBase;
                localStorage.setItem('mindful_profile', JSON.stringify(profile));

                closeBaseTransferModal();
                alert(`${BASE_NAMES[selectedNewBase]}„Å∏„ÅÆÁßªÁ±ç„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ`);
                showProfile();
                showUserBadge(profile);

            } catch (e) {
                console.error('Transfer error:', e);
                document.getElementById('transferError').textContent = 'ÁßªÁ±ç„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + e.message;
                document.getElementById('transferError').style.display = 'block';
            } finally {
                btn.textContent = 'ÁßªÁ±ç„Åô„Çã';
                btn.disabled = false;
            }
        }

        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.size > 2 * 1024 * 1024) {
                alert('ÁîªÂÉè„Çµ„Ç§„Ç∫„ÅØ2MB‰ª•‰∏ã„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                const img = new Image();
                img.onload = function () {
                    const canvas = document.createElement('canvas');
                    const maxSize = 200;
                    let width = img.width;
                    let height = img.height;

                    if (width > height) {
                        if (width > maxSize) { height *= maxSize / width; width = maxSize; }
                    } else {
                        if (height > maxSize) { width *= maxSize / height; height = maxSize; }
                    }

                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);

                    const dataUrl = canvas.toDataURL('image/jpeg', 0.8);
                    localStorage.setItem('mindful_photo', dataUrl);
                    loadProfilePhoto();

                    // „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Å´„ÇÇÂêåÊúü
                    syncPhotoToBackend(dataUrl);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // ÂÜôÁúü„Çí„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Å´ÂêåÊúü
        async function syncPhotoToBackend(imageData) {
            const profile = JSON.parse(localStorage.getItem('mindful_profile') || 'null');
            if (!profile || !profile.pin) return;

            const base = profile.base || todayBase || 'moiwayama';
            const url = SCRIPT_URLS[base];
            if (!url) return;

            try {
                const response = await fetch(`${url}?action=uploadProfileImage&name=${encodeURIComponent(profile.name)}&pin=${encodeURIComponent(profile.pin)}&image=${encodeURIComponent(imageData)}${tokenParam()}`);
                const result = await response.json();
                console.log('Photo sync:', result);
            } catch (e) {
                console.error('Photo sync error:', e);
            }
        }

        function loadProfilePhoto() {
            const photoData = localStorage.getItem('mindful_photo');
            const photoEl = document.getElementById('profilePhoto');
            const placeholderEl = document.getElementById('profilePhotoPlaceholder');

            if (photoData && photoEl && placeholderEl) {
                photoEl.src = photoData;
                photoEl.style.display = 'block';
                placeholderEl.style.display = 'none';
            } else if (photoEl && placeholderEl) {
                photoEl.style.display = 'none';
                placeholderEl.style.display = 'block';
            }
        }

        function showGoalsDisplay(profile) {
            const container = document.getElementById('goalsDisplay');
            // ÈÖçÂàóÂΩ¢Âºè„ÅÆÁõÆÊ®ô„ÉªÂ§¢„ÇíÂèñÂæóÔºàÂæåÊñπ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅÂè§„ÅÑÂΩ¢Âºè„ÇÇÂØæÂøúÔºâ
            const goalsThisYear = profile.goalsThisYear || (profile.goalThisYear ? [profile.goalThisYear] : []);
            const goalsFuture = profile.goalsFuture || (profile.goalFuture ? [profile.goalFuture] : []);

            if (goalsThisYear.length > 0 || goalsFuture.length > 0) {
                container.style.display = 'block';

                // Áï™Âè∑‰ªò„Åç„É™„Çπ„Éà„ÅßË°®Á§∫
                document.getElementById('goalsThisYearList').innerHTML = goalsThisYear.length > 0
                    ? goalsThisYear.map((g, i) => `${i + 1}. ${g}`).join('<br>')
                    : '-';
                document.getElementById('goalsFutureList').innerHTML = goalsFuture.length > 0
                    ? goalsFuture.map((g, i) => `${i + 1}. ${g}`).join('<br>')
                    : '-';

                // MY VISION„Å´ÂÜôÁúü„ÇíË°®Á§∫Ôºà„Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥„Éò„ÉÉ„ÉÄ„ÉºÁî®Ôºâ
                const photoData = localStorage.getItem('mindful_photo');
                const goalsPhotoHeader = document.getElementById('goalsPhotoHeader');
                const goalsPhotoPlaceholderHeader = document.getElementById('goalsPhotoPlaceholderHeader');
                if (photoData && goalsPhotoHeader && goalsPhotoPlaceholderHeader) {
                    goalsPhotoHeader.src = photoData;
                    goalsPhotoHeader.style.display = 'block';
                    goalsPhotoPlaceholderHeader.style.display = 'none';
                } else if (goalsPhotoHeader && goalsPhotoPlaceholderHeader) {
                    goalsPhotoHeader.style.display = 'none';
                    goalsPhotoPlaceholderHeader.style.display = 'block';
                }
            } else {
                container.style.display = 'none';
            }
        }

        function checkActiveSession() {
            const checkinTime = localStorage.getItem('mindful_checkin_time');
            if (checkinTime) {
                const savedQuests = JSON.parse(localStorage.getItem('mindful_active_quests') || '[]');
                if (savedQuests.length > 0) {
                    currentQuests = savedQuests;
                    const container = document.getElementById('activeQuestsContainer');
                    container.innerHTML = currentQuests.map((q, i) => `
                        <div class="active-quest-card">
                            <div class="quest-label">QUEST ${i + 1}</div>
                            <div class="quest-number">#${q.id}</div>
                            <div class="quest-title">${q.titleEn}</div>
                            <div class="quest-subtitle">${q.titleJp}</div>
                            <div class="quest-philosophy">${q.action}</div>
                        </div>
                    `).join('');
                    updateReflectionButton();
                    showScreen('screen-active');
                }
            }
        }

        function updateReflectionButton() {
            const checkinTime = localStorage.getItem('mindful_checkin_time');
            const reflectionBtn = document.getElementById('reflectionBtn');
            const reflectionNotice = document.getElementById('reflectionNotice');
            const reflectionTimer = document.getElementById('reflectionTimer');

            // ===== workDate„Éô„Éº„Çπ„ÅßÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ =====
            const targetDate = workDate || new Date().toISOString().split('T')[0];
            const checkedOutDates = JSON.parse(localStorage.getItem('mindful_checkout_dates') || '[]');
            const alreadyCheckedOut = checkedOutDates.includes(targetDate);

            // Already checked out for this work date - disable button
            if (alreadyCheckedOut) {
                reflectionBtn.disabled = true;
                reflectionBtn.style.opacity = '0.5';
                reflectionBtn.textContent = 'CHECK OUT ÂÆå‰∫ÜÊ∏à„Åø';
                reflectionBtn.style.pointerEvents = 'none'; // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„ÇÇÁÑ°ÂäπÂåñ
                reflectionNotice.style.display = 'none';
                return;
            }

            // Reset button text and pointer events
            reflectionBtn.textContent = 'CHECK OUT ‚Üí';
            reflectionBtn.style.pointerEvents = 'auto';

            // No check-in recorded - disable button
            if (!checkinTime) {
                reflectionBtn.disabled = true;
                reflectionBtn.style.opacity = '0.5';
                reflectionBtn.textContent = '„Åæ„ÅöC/IN„ÇíÂÆå‰∫Ü„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                reflectionNotice.style.display = 'none';
                return;
            }

            const checkinDate = new Date(checkinTime);
            const now = new Date();
            const diffMs = now - checkinDate;
            const diffHours = diffMs / (1000 * 60 * 60);
            const MIN_HOURS = 3;

            if (diffHours >= MIN_HOURS) {
                reflectionBtn.disabled = false;
                reflectionBtn.style.opacity = '1';
                reflectionNotice.style.display = 'none';
            } else {
                reflectionBtn.disabled = true;
                reflectionBtn.style.opacity = '0.5';
                reflectionNotice.style.display = 'block';
                const remainingMs = (MIN_HOURS * 60 * 60 * 1000) - diffMs;
                const remainingHours = Math.floor(remainingMs / (1000 * 60 * 60));
                const remainingMins = Math.floor((remainingMs % (1000 * 60 * 60)) / (1000 * 60));
                reflectionTimer.textContent = `„ÅÇ„Å® ${remainingHours}ÊôÇÈñì ${remainingMins}ÂàÜ`;

                // Update every minute
                setTimeout(updateReflectionButton, 60000);
            }
        }

        function setCheck(btn, value) {
            const field = btn.dataset.field;
            checks[field] = value;
            btn.parentElement.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            validateHealth();
        }

        function validateHealth() {
            const statusEl = document.getElementById('healthStatus');
            const drawArea = document.getElementById('drawArea');
            const card = document.getElementById('healthCheckCard');
            const allAnswered = checkFields.every(f => checks[f] !== null);
            const ngCount = checkFields.filter(f => checks[f] === 'ng').length;

            if (!allAnswered) {
                statusEl.className = 'health-status incomplete';
                statusEl.textContent = '„Åô„Åπ„Å¶„ÅÆÈ†ÖÁõÆ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                card.classList.remove('complete');
            } else if (ngCount > 2) {
                // 3„Å§‰ª•‰∏äNG„ÅÆÂ†¥Âêà„ÅØÂá∫Âã§‰∏çÂèØ
                statusEl.className = 'health-status ng';
                statusEl.innerHTML = '‚õîNGÈ†ÖÁõÆ„ÅåÂ§ö„ÅÑ„Åü„ÇÅÂá∫Âã§„Åß„Åç„Åæ„Åõ„Çì<br><span style="font-size: 10px; color: #666;">‰∏äÂ∏≠ËÄÖ„Å´ÈÄ£Áµ°„ÅÆ‰∏ä„ÄÅÊåáÁ§∫„Çí‰ª∞„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ</span>';
                card.classList.remove('complete');
            } else if (ngCount > 0) {
                // 1„Äú2„Å§NG„ÅÆÂ†¥Âêà„ÅØÂá∫Âã§ÂèØËÉΩ„Å†„ÅåÂ†±ÂëäÂøÖÈ†à
                statusEl.className = 'health-status warning';
                statusEl.innerHTML = '‚ö†Ô∏è Á¢∫Ë™çÂÆå‰∫ÜÔºàNG: ' + ngCount + 'È†ÖÁõÆÔºâ<br><span style="font-size: 10px; color: #C9A962;">ÂøÖ„Åö‰∏äÂ∏≠ËÄÖ„Å´Â†±Âëä„Åó„ÄÅÊåáÁ§∫„Çí‰ª∞„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ</span>';
                card.classList.add('complete');
            } else {
                // ÂÖ®„Å¶OK
                statusEl.className = 'health-status ok';
                statusEl.textContent = '‚úì Á¢∫Ë™çÂÆå‰∫Ü';
                card.classList.add('complete');
            }
            updateDrawArea();
        }

        function setMindCheck(btn, value) {
            const field = btn.dataset.field;
            mindChecks[field] = value;
            btn.parentElement.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            validateMind();
        }

        function validateMind() {
            const statusEl = document.getElementById('mindStatus');
            const card = document.getElementById('mindCheckCard');
            const allAnswered = mindFields.every(f => mindChecks[f] !== null);

            if (!allAnswered) {
                statusEl.className = 'health-status incomplete'; statusEl.textContent = 'ÂøÉ„ÅÆÁä∂ÊÖã„ÇÇÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                card.classList.remove('complete');
            } else {
                statusEl.className = 'health-status ok'; statusEl.textContent = '‚úì ÂøÉ„ÅÆÁ¢∫Ë™çÂÆå‰∫Ü';
                card.classList.add('complete');
                // Ë¶Å„Éï„Ç©„É≠„Éº„ÅÆÂ†¥Âêà„ÅÆ„Åø„É°„ÉÉ„Çª„Éº„Ç∏Â§âÊõ¥
                if (mindChecks.mind_consult === 'urgent' || mindChecks.mind_consult === 'sometime') {
                    statusEl.textContent = 'üí¨ „ÅÑ„Å§„Åß„ÇÇÁõ∏Ë´á„Åó„Å¶„Å≠';
                }
            }
            updateDrawArea();
        }

        function updateDrawArea() {
            const drawArea = document.getElementById('drawArea');
            const healthAnswered = checkFields.every(f => checks[f] !== null);
            const ngCount = checkFields.filter(f => checks[f] === 'ng').length;
            const healthPassable = healthAnswered && ngCount <= 2;  // NG2„Å§„Åæ„ÅßOK
            const mindAnswered = mindFields.every(f => mindChecks[f] !== null);
            const locationSelected = todayBase !== null;

            if (healthPassable && mindAnswered && locationSelected) {
                drawArea.classList.remove('disabled');
                if (ngCount > 0) {
                    drawArea.querySelector('.draw-hint').textContent = '‚ö†Ô∏è ‰∏äÂ∏≠ËÄÖ„Å´Â†±ÂëäÂæå„ÄÅ„Çø„ÉÉ„Éó„Åó„Å¶„Ç´„Éº„Éâ„ÇíÂºï„Åè';
                } else {
                    drawArea.querySelector('.draw-hint').textContent = '„Çø„ÉÉ„Éó„Åó„Å¶3Êûö„ÅÆ„Ç´„Éº„Éâ„ÇíÂºï„Åè';
                }
            } else if (!locationSelected) {
                drawArea.classList.add('disabled');
                drawArea.querySelector('.draw-hint').textContent = 'üìç „Åæ„Åö‰ªäÊó•„ÅÆÂã§ÂãôÂÖà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
            } else if (ngCount > 2) {
                drawArea.classList.add('disabled');
                drawArea.querySelector('.draw-hint').textContent = '‚õî NGÈ†ÖÁõÆ„ÅåÂ§ö„ÅÑ„Åü„ÇÅÂá∫Âã§„Åß„Åç„Åæ„Åõ„Çì';
            } else {
                drawArea.classList.add('disabled');
                drawArea.querySelector('.draw-hint').textContent = 'ÂÖ®È†ÖÁõÆ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åã„Çâ„Ç´„Éº„Éâ„ÇíÂºï„Åë„Åæ„Åô';
            }
        }

        // ‚ïê‚ïê‚ïê KIRARA CARD DATA ‚ïê‚ïê‚ïê
        const kiraraCards = [
            { id: 'K01', rarity: 'sr', titleEn: 'GOLDEN HOUR', titleJp: '„Ç¥„Éº„É´„Éá„É≥„Ç¢„ÉØ„Éº', action: '‰ªäÊó•„ÄÅ„ÉÅ„Éº„É†„ÅßÊúÄÈ´ò„ÅÆ1ÊôÇÈñì„ÇíÂâµ„ÇäÂá∫„Åõ„ÄÇ„Åù„ÅÆ1ÊôÇÈñì„Åå„ÄÅ„Ç≤„Çπ„Éà„ÅÆ‰∏ÄÁîü„ÅÆË®òÊÜ∂„Å´„Å™„Çã' },
            { id: 'K02', rarity: 'sr', titleEn: 'THE INVISIBLE HAND', titleJp: '„Ç§„É≥„Éì„Ç∏„Éñ„É´„Éª„Éè„É≥„Éâ', action: '„Ç≤„Çπ„Éà„Åã„ÇâË¶ã„Åà„Å™„ÅÑÂ†¥ÊâÄ„Åß„ÄÅ‰ª≤Èñì„ÅÆ„Åü„ÇÅ„Å´‰∏Ä„Å§‰ªï‰∫ã„ÇíÂºï„ÅçÂèó„Åë„Çã' },
            { id: 'K03', rarity: 'sr', titleEn: '100-YEAR TABLE', titleJp: '100Âπ¥„ÉÜ„Éº„Éñ„É´', action: '"„Åì„ÅÆÈ£üÊùê„Çí100Âπ¥Âæå„ÅÆ„Ç≤„Çπ„Éà„Å´„ÇÇÂ±ä„Åë„Åü„ÅÑ"„Å®ÊÄù„Åà„Çã„ÅãÔºüÂøÉ„ÅßÁ¢∫Ë™ç„Åô„Çã' },
            { id: 'K04', rarity: 'sr', titleEn: 'PRIDE MIRROR', titleJp: '„Éó„É©„Ç§„Éâ„Éª„Éü„É©„Éº', action: 'Â∏∞„ÇäÈÅì„ÄÅ‰ªäÊó•„ÅÆ„ÅÇ„Å™„Åü„ÅÆ‰ªï‰∫ã„ÇíÂÆ∂Êóè„Å´Ë©±„Åó„Å¶„Åø„Çà„ÅÜ„ÄÇËÉ∏„ÇíÂºµ„Çå„Çã„ÅãÔºü' },
            { id: 'K05', rarity: 'sr', titleEn: 'SILENT GOLD', titleJp: '„Çµ„Ç§„É¨„É≥„Éà„Éª„Ç¥„Éº„É´„Éâ', action: 'Ë®ÄËëâ„Çí‰Ωø„Çè„Åö„ÄÅÊâÄ‰Ωú„Å®Á¨ëÈ°î„Å†„Åë„ÅßÊúÄÈ´ò„ÅÆ„Çµ„Éº„Éì„Çπ„Çí1„ÉÜ„Éº„Éñ„É´„Å´Â±ä„Åë„Çã' },
            { id: 'K06', rarity: 'ssr', titleEn: "ASIA'S BEST", titleJp: '„Ç¢„Ç∏„Ç¢„Ç∫„Éª„Éô„Çπ„Éà', action: '‰ªäÊó•„ÅÆ„Çµ„Éº„Éì„Çπ„Çí„Ç¢„Ç∏„Ç¢„Éô„Çπ„ÉàÂØ©ÊüªÂì°„ÅåË¶ã„Å¶„ÅÑ„Çã„Å®ÊÄù„Å£„Å¶„ÄÅÂÖ®Âäõ„Åß' },
            { id: 'K07', rarity: 'ssr', titleEn: 'VIEWTIFUL MOMENT', titleJp: '„Éì„É•„Éº„ÉÜ„Ç£„Éï„É´„Éª„É¢„Éº„É°„É≥„Éà', action: 'ÊôØËâ≤„Åå‰∏ÄÁï™Áæé„Åó„ÅÑÁû¨Èñì„ÄÅ„Ç≤„Çπ„Éà„ÅÆË¶ñÁ∑ö„Çí„Åù„Å£„Å®Ë™òÂ∞é„Åô„Çã' },
            { id: 'K08', rarity: 'ssr', titleEn: "CHEF'S TABLE MIND", titleJp: '„Ç∑„Çß„Éï„Ç∫„Éª„ÉÜ„Éº„Éñ„É´„Éª„Éû„Ç§„É≥„Éâ', action: '‰ªäÊó•„ÅÆ„Åä„Åô„Åô„ÇÅ„Çí„ÄÅÊñôÁêÜ‰∫∫„ÅÆÊ∞óÊåÅ„Å°„ÅßË™û„Çã„ÄÇÂΩº„Çâ„ÅÆË™á„Çä„Çí‰ª£ÂºÅ„Åõ„Çà' },
            { id: 'K09', rarity: 'ur', titleEn: 'HAPPINESS WEAVERS', titleJp: '„Éè„Éî„Éç„Çπ„Éª„Ç¶„Ç£„Éº„Éê„Éº„Ç∫', action: '„É¨„Çπ„Éà„É©„É≥„Å´„ÅØÂπ∏„Åõ„Åó„Åã„Å™„ÅÑ„ÄÄ„Åù„ÅÆÂπ∏„Åõ„ÇíÁ¥°„Åê„ÅÆ„ÅØÁßÅ„Åü„Å°„Åß„Åô' },
            { id: 'K10', rarity: 'ur', titleEn: 'THE GENTLE REVOLUTION', titleJp: '„Ç∏„Çß„É≥„Éà„É´„Éª„É¨„Éú„É™„É•„Éº„Ç∑„Éß„É≥', action: '‰ªäÊó•„ÅÇ„Å™„Åü„ÅåÁ§∫„ÅôÂÑ™„Åó„Åï„Å®ÂçìË∂ä„Åå„ÄÅÊ•≠Áïå„ÇíÂ§â„Åà„Çã‰∏ÄÊ≠©„Å´„Å™„Çã' }
        ];

        function getTotalCheckinDays() {
            return JSON.parse(localStorage.getItem('mindful_checkout_dates') || '[]').length;
        }

        function getKiraraCollection() {
            return JSON.parse(localStorage.getItem('mindful_kirara_collection') || '[]');
        }

        function addToKiraraCollection(cardId) {
            const collection = getKiraraCollection();
            if (!collection.includes(cardId)) {
                collection.push(cardId);
                localStorage.setItem('mindful_kirara_collection', JSON.stringify(collection));
            }
        }

        function tryKiraraDraw() {
            const totalDays = getTotalCheckinDays();
            const rand = Math.random() * 100;

            // UR: 0.05% ‚Äî Á¥ØË®à30Êó•‰ª•‰∏ä
            if (totalDays >= 30 && rand < 0.05) {
                const urCards = kiraraCards.filter(c => c.rarity === 'ur');
                return urCards[Math.floor(Math.random() * urCards.length)];
            }
            // SSR: 0.3% ‚Äî Á¥ØË®à10Êó•‰ª•‰∏ä
            if (totalDays >= 10 && rand < 0.3) {
                const ssrCards = kiraraCards.filter(c => c.rarity === 'ssr');
                return ssrCards[Math.floor(Math.random() * ssrCards.length)];
            }
            // SR: 0.9%
            if (rand < 0.9) {
                const srCards = kiraraCards.filter(c => c.rarity === 'sr');
                return srCards[Math.floor(Math.random() * srCards.length)];
            }
            return null;
        }

        function renderKiraraCard(card) {
            const rarityLabel = { sr: '‚≠ê SR', ssr: '‚≠ê‚≠ê SSR', ur: 'üëë UR' };
            const particles = Array.from({ length: 8 }, () => {
                const x = Math.random() * 100;
                const delay = Math.random() * 3;
                const dur = 2 + Math.random() * 2;
                return '<div class="kirara-particle" style="left:' + x + '%;bottom:0;animation-delay:' + delay + 's;animation-duration:' + dur + 's;"></div>';
            }).join('');

            return '<div class="kirara-card">' +
                '<div class="kirara-particles">' + particles + '</div>' +
                '<div class="kirara-rarity ' + card.rarity + '">' + rarityLabel[card.rarity] + '</div>' +
                '<div class="quest-label" style="color:#FFD700;">‚ú® KIRARA CARD ‚ú®</div>' +
                '<div class="quest-number" style="background:linear-gradient(135deg,#FFD700,#FFF8DC,#C9A962);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">#' + card.id + '</div>' +
                '<div class="quest-title" style="color:#FFF8DC;">' + card.titleEn + '</div>' +
                '<div class="quest-subtitle" style="color:rgba(255,255,255,0.8);">' + card.titleJp + '</div>' +
                '<div class="quest-philosophy" style="background:rgba(201,169,98,0.15);color:#FFF8DC;border:1px solid rgba(201,169,98,0.3);">' + card.action + '</div>' +
                '</div>';
        }

        function renderKiraraCollection() {
            const collection = getKiraraCollection();
            let slots = '';
            kiraraCards.forEach(function (card) {
                const unlocked = collection.includes(card.id);
                const slotClass = unlocked ? 'unlocked' + (card.rarity === 'ur' ? ' ur-slot' : '') : 'locked';
                const label = unlocked ? card.id.replace('K', '') : '?';
                const title = unlocked ? card.titleEn : '???';
                slots += '<div class="kirara-slot ' + slotClass + '" title="' + title + '">' + label + '</div>';
            });
            return '<div class="kirara-collection">' +
                '<div class="kirara-collection-title">‚ú® KIRARA COLLECTION ‚Äî ' + collection.length + '/10</div>' +
                '<div class="kirara-collection-grid">' + slots + '</div>' +
                '</div>';
        }

        function drawQuests() {
            if (document.getElementById('drawArea').classList.contains('disabled')) return;

            // ‚ïê‚ïê‚ïê KIRARA CARD CHECK ‚ïê‚ïê‚ïê
            const kiraraResult = tryKiraraDraw();

            // Â±•Ê≠¥Ë™≠„ÅøËæº„Åø
            let history = JSON.parse(localStorage.getItem('mindful_quest_history') || '[]');

            // Â±•Ê≠¥„Å´Âê´„Åæ„Çå„Å™„ÅÑ„ÇØ„Ç®„Çπ„Éà„ÇíÊäΩÂá∫
            let candidates = playbook.filter(q => !history.includes(q.id));

            // ÂÄôË£ú„Åå3„Å§Êú™Ê∫Ä„Å™„Çâ„ÄÅÂ±•Ê≠¥„Çí„ÇØ„É™„Ç¢„Åó„Å¶ÂÖ®Âì°ÊïóËÄÖÂæ©Ê¥ªÔºàÂÖ®‰ª∂„Åã„ÇâÊäΩÈÅ∏Ôºâ
            if (candidates.length < 3) {
                console.log('Resetting quest history');
                history = [];
                candidates = [...playbook];
            }

            // Shuffle candidates
            const shuffled = candidates.sort(() => Math.random() - 0.5);

            if (kiraraResult) {
                // „Ç≠„É©„Ç≠„É©„Ç´„Éº„ÉâÂΩìÈÅ∏ÔºÅ1ÊûöÁõÆ„Çí„Ç≠„É©„Ç´„Éº„Éâ„Å´„ÄÅÊÆã„Çä2Êûö„ÅØÈÄöÂ∏∏
                currentQuests = [kiraraResult, shuffled[0], shuffled[1]];
                addToKiraraCollection(kiraraResult.id);
            } else {
                currentQuests = shuffled.slice(0, 3);
            }

            // Â±•Ê≠¥Êõ¥Êñ∞ÔºàÈÄöÂ∏∏„Ç´„Éº„Éâ„ÅÆID„ÅÆ„ÅøËøΩÂä†Ôºâ
            const normalIds = currentQuests.filter(q => !q.rarity).map(q => q.id);
            history = [...history, ...normalIds];

            // Â±•Ê≠¥Âà∂ÈôêÔºàÈÅéÂéª15‰ª∂Ôºù5Êó•ÂàÜ„Å†„Åë‰øùÊåÅÔºâ
            if (history.length > 15) {
                history = history.slice(history.length - 15);
            }
            localStorage.setItem('mindful_quest_history', JSON.stringify(history));

            document.getElementById('drawArea').style.display = 'none';
            const container = document.getElementById('questCardsContainer');
            container.innerHTML = currentQuests.map((q, i) => {
                if (q.rarity) {
                    return renderKiraraCard(q);
                }
                return `
            <div class="quest-card revealed" style="animation-delay: ${i * 0.15}s;">
                <div class="quest-label">QUEST ${i + 1}</div>
                <div class="quest-number">#${q.id}</div>
                <div class="quest-title">${q.titleEn}</div>
                <div class="quest-subtitle">${q.titleJp}</div>
                <div class="quest-philosophy">${q.action}</div>
            </div>
        `;
            }).join('');
            document.getElementById('startBtn').style.display = 'block';
        }

        function startDay() {
            // ===== ‰∫åÈáç„ÇØ„É™„ÉÉ„ÇØÈò≤Ê≠¢: „Éú„Çø„É≥„ÇíÂç≥Â∫ß„Å´ÁÑ°ÂäπÂåñ =====
            const startBtn = document.getElementById('startBtn');
            if (startBtn.disabled) return; // Êó¢„Å´Âá¶ÁêÜ‰∏≠„Å™„Çâ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            startBtn.disabled = true;
            startBtn.textContent = 'C/IN‰∏≠...';
            startBtn.style.opacity = '0.5';

            // Save check-in time and quests for session persistence
            localStorage.setItem('mindful_checkin_time', new Date().toISOString());
            localStorage.setItem('mindful_active_quests', JSON.stringify(currentQuests));

            // „Åì„ÅÆÊó•‰ªò„ÇíC/INÊ∏à„Åø„Å®„Åó„Å¶„Éû„Éº„ÇØÔºà1Êó•1ÂõûÂà∂ÈôêÔºâ
            markDateAsCheckedIn(workDate);

            const container = document.getElementById('activeQuestsContainer');
            container.innerHTML = currentQuests.map((q, i) => `
            <div class="active-quest-card">
                <div class="quest-label">QUEST ${i + 1}</div>
                <div class="quest-number">#${q.id}</div>
                <div class="quest-title">${q.titleEn}</div>
                <div class="quest-subtitle">${q.titleJp}</div>
                <div class="quest-philosophy">${q.action}</div>
            </div>
        `).join('');
            sendToSheets('healthcheck');
            updateReflectionButton();
            showScreen('screen-active');
        }

        function showReflection() {
            // ===== C/INÂøÖÈ†à„ÉÅ„Çß„ÉÉ„ÇØ =====
            const checkinTime = localStorage.getItem('mindful_checkin_time');
            const activeQuests = JSON.parse(localStorage.getItem('mindful_active_quests') || '[]');

            if (!checkinTime || activeQuests.length === 0) {
                alert('„Åæ„ÅöC/IN„ÇíÂÆå‰∫Ü„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            // ===== ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ: „Åì„ÅÆÂã§ÂãôÊó•„ÅßÊó¢„Å´C/OÊ∏à„Åø„ÅãÁ¢∫Ë™ç =====
            const targetDate = workDate || new Date().toISOString().split('T')[0];

            // Êñ∞ÂΩ¢Âºè„ÅÆÈÖçÂàó„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            let checkedOutDates = JSON.parse(localStorage.getItem('mindful_checkout_dates') || '[]');

            // ÂæåÊñπ‰∫íÊèõÊÄß: ÊóßÂΩ¢ÂºèÔºàÂçò‰∏ÄÊó•‰ªòÔºâ„ÇÇ„ÉÅ„Çß„ÉÉ„ÇØ
            const oldCheckoutDate = localStorage.getItem('mindful_checkout_date');
            if (oldCheckoutDate && !checkedOutDates.includes(oldCheckoutDate)) {
                checkedOutDates.push(oldCheckoutDate);
                localStorage.setItem('mindful_checkout_dates', JSON.stringify(checkedOutDates));
            }

            if (checkedOutDates.includes(targetDate)) {
                alert('„Åì„ÅÆÊó•‰ªò„ÅÆCHECK OUT„ÅØÊó¢„Å´ÂÆå‰∫Ü„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ');
                return;
            }

            // currentQuests„ÅåÁ©∫„ÅÆÂ†¥Âêà„ÅØactiveQuests„Çí‰ΩøÁî®
            if (currentQuests.length === 0) {
                currentQuests = activeQuests;
            }

            document.getElementById('reflectionQuestTitles').innerHTML = currentQuests.map(q => q.titleEn).join('<br>');
            showScreen('screen-reflection');
        }

        function setupStarRating() {
            document.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', () => {
                    currentRating = parseInt(star.dataset.value);
                    document.querySelectorAll('.star').forEach((s, i) => s.classList.toggle('active', i < currentRating));
                });
            });
        }

        function submitReflection() {
            // ===== ‰∫åÈáç„ÇØ„É™„ÉÉ„ÇØÈò≤Ê≠¢: „Éú„Çø„É≥„ÇíÂç≥Â∫ß„Å´ÁÑ°ÂäπÂåñ =====
            const completeBtn = document.getElementById('completeBtn');
            if (completeBtn.disabled) return; // Êó¢„Å´Âá¶ÁêÜ‰∏≠„Å™„Çâ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            completeBtn.disabled = true;
            completeBtn.textContent = 'ÈÄÅ‰ø°‰∏≠...';
            completeBtn.style.opacity = '0.5';

            // ===== workDate„Éô„Éº„Çπ„ÅßÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ =====
            const targetDate = workDate || new Date().toISOString().split('T')[0];
            let checkedOutDates = JSON.parse(localStorage.getItem('mindful_checkout_dates') || '[]');

            // ÊóßÂΩ¢Âºè„Åã„Çâ„ÅÆ„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥
            const oldCheckoutDate = localStorage.getItem('mindful_checkout_date');
            if (oldCheckoutDate && !checkedOutDates.includes(oldCheckoutDate)) {
                checkedOutDates.push(oldCheckoutDate);
            }

            // ===== ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØÔºö„Åì„ÅÆÊó•‰ªò„ÅßÊó¢„Å´C/OÊ∏à„Åø„Å™„Çâ‰∏≠Ê≠¢ =====
            if (checkedOutDates.includes(targetDate)) {
                alert('„Åì„ÅÆÊó•‰ªò„ÅÆCHECK OUT„ÅØÊó¢„Å´ÂÆå‰∫Ü„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Éà„Éº„ÇØ„É≥„ÅØ‰ªò‰∏é„Åï„Çå„Åæ„Åõ„Çì„ÄÇ');
                completeBtn.disabled = false;
                completeBtn.textContent = 'COMPLETE';
                completeBtn.style.opacity = '1';
                return;
            }

            // ===== ÊúÄÂàù„Å´C/OÊ∏à„Åø„Å®„Åó„Å¶Ë®òÈå≤Ôºà„Éà„Éº„ÇØ„É≥‰ªò‰∏é„Çà„ÇäÂÖàÔºÅÔºâ=====
            checkedOutDates.push(targetDate);
            if (checkedOutDates.length > 30) {
                checkedOutDates.shift();
            }
            localStorage.setItem('mindful_checkout_dates', JSON.stringify(checkedOutDates));
            localStorage.setItem('mindful_checkout_date', targetDate);

            // ===== „Åì„Åì„ÅßC/OË®òÈå≤„ÅåÂÆå‰∫Ü„ÄÇ‰ª•Èôç„ÅØ„Éà„Éº„ÇØ„É≥‰ªò‰∏é =====
            const memo = document.getElementById('memoInput').value;
            const history = JSON.parse(localStorage.getItem('mindful_history') || '[]');
            history.unshift({ date: targetDate, quests: currentQuests.map(q => ({ id: q.id, title: q.titleEn })), rating: currentRating, memo });
            localStorage.setItem('mindful_history', JSON.stringify(history.slice(0, 30)));

            // Token reward calculation (C/OË®òÈå≤‰øùÂ≠òÂæå„Å´ÂÆüË°å)
            const tokenReward = calculateTokenReward(currentRating, memo);
            addTokens(tokenReward.total);
            displayTokenReward(tokenReward);

            sendToSheets('reflection', tokenReward);

            localStorage.removeItem('mindful_checkin_time');

            showScreen('screen-completion');

            // CHECK OUT„Éú„Çø„É≥„ÇíÂç≥Â∫ß„Å´Êõ¥Êñ∞
            updateReflectionButton();
        }

        // TOKEN SYSTEM FUNCTIONS
        function getTokenBalance() {
            return parseInt(localStorage.getItem('mindful_tokens') || '0');
        }

        function addTokens(amount) {
            const current = getTokenBalance();
            const newBalance = current + amount;
            localStorage.setItem('mindful_tokens', newBalance.toString());
            updateTokenDisplay();
            return newBalance;
        }

        function updateTokenDisplay() {
            const balance = getTokenBalance();
            const display = document.getElementById('tokenDisplay');
            const balanceEl = document.getElementById('tokenBalance');
            if (display && balanceEl) {
                display.style.display = 'inline-flex';
                balanceEl.textContent = balance;
            }
        }

        function calculateTokenReward(rating, memo) {
            const breakdown = [];
            let total = 0;

            // Base reward for completion
            total += 10;
            breakdown.push({ label: 'ÊåØ„ÇäËøî„ÇäÂÆå‰∫Ü', amount: 10 });

            // Rating bonus
            if (rating === 5) {
                total += 5;
                breakdown.push({ label: '‚òÖ5Ë©ï‰æ°„Éú„Éº„Éä„Çπ', amount: 5 });
            } else if (rating >= 4) {
                total += 2;
                breakdown.push({ label: '‚òÖ4Ë©ï‰æ°„Éú„Éº„Éä„Çπ', amount: 2 });
            }

            // Memo bonus
            if (memo && memo.trim().length > 0) {
                total += 3;
                breakdown.push({ label: '„É°„É¢Ë®òÂÖ•„Éú„Éº„Éä„Çπ', amount: 3 });
            }

            return { total, breakdown };
        }

        function displayTokenReward(reward) {
            const amountEl = document.getElementById('tokenEarnedAmount');
            const breakdownEl = document.getElementById('tokenBreakdown');

            if (amountEl) {
                amountEl.textContent = '+' + reward.total;
            }

            if (breakdownEl) {
                breakdownEl.innerHTML = reward.breakdown.map(item =>
                    `<div class="token-breakdown-item"><span>${item.label}</span><span>+${item.amount}</span></div>`
                ).join('');
            }
        }

        // ===== KNOWLEDGE VIEWING TOKEN SYSTEM =====
        const KNOWLEDGE_ITEMS = {
            tactics: { url: 'https://wearemssatoshi.github.io/SVD_TACTICS/', label: 'È£üÂìÅÊ∂àË≤ªÁ®é„Çº„É≠ÊîøÁ≠ñ' },
            tvtower: { url: 'https://wearemssatoshi.github.io/SVD_MINDFUL/tvtower_3years.html', label: 'TV TOWER 3Âπ¥Èñì„ÅÆËªåË∑°' },
            deliciousness: { url: 'https://wearemssatoshi.github.io/deliciousness/', label: 'ÁæéÂë≥„Åó„Åï„ÅÆÂÆöÁæ©' },
            momentum: { url: 'https://wearemssatoshi.github.io/momentum-peaks/', label: 'MOMENTUM PEAKS' }
        };
        const KNOWLEDGE_TOKEN_REWARD = 5;

        function getKnowledgeViewKey() {
            const now = new Date();
            const jstOffset = 9 * 60;
            const jst = new Date(now.getTime() + (now.getTimezoneOffset() + jstOffset) * 60000);
            const today = jst.toISOString().split('T')[0];
            return `mindful_knowledge_viewed_${today}`;
        }

        function getViewedKnowledge() {
            return JSON.parse(localStorage.getItem(getKnowledgeViewKey()) || '[]');
        }

        function trackKnowledgeView(id) {
            const viewed = getViewedKnowledge();
            if (!viewed.includes(id)) {
                viewed.push(id);
                localStorage.setItem(getKnowledgeViewKey(), JSON.stringify(viewed));
                addTokens(KNOWLEDGE_TOKEN_REWARD);
                // Show toast notification
                showKnowledgeTokenToast(KNOWLEDGE_ITEMS[id].label);
            }
            updateKnowledgeBadges();
            window.open(KNOWLEDGE_ITEMS[id].url, '_blank');
        }

        function updateKnowledgeBadges() {
            const viewed = getViewedKnowledge();
            Object.keys(KNOWLEDGE_ITEMS).forEach(id => {
                const badge = document.getElementById(`knowledgeBadge_${id}`);
                if (badge) {
                    if (viewed.includes(id)) {
                        badge.textContent = '‚úÖ Áç≤ÂæóÊ∏à„Åø';
                        badge.style.color = '#2ecc71';
                    } else {
                        badge.textContent = 'ü™ô +5';
                        badge.style.color = 'var(--gold)';
                    }
                }
            });
        }

        function showKnowledgeTokenToast(label) {
            const toast = document.createElement('div');
            toast.style.cssText = 'position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, var(--navy), var(--navy-dark)); color: var(--gold); padding: 12px 24px; border-radius: 30px; font-family: Montserrat, sans-serif; font-size: 13px; font-weight: 600; z-index: 9999; box-shadow: 0 4px 20px rgba(0,0,0,0.3); border: 1px solid var(--gold); animation: tokenToastIn 0.4s ease-out;';
            toast.innerHTML = `ü™ô +5 TOKEN <span style="font-weight: 400; opacity: 0.8; margin-left: 6px;">${label}</span>`;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.transition = 'opacity 0.5s, transform 0.5s';
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(-50%) translateY(-20px)';
                setTimeout(() => toast.remove(), 500);
            }, 2500);
        }

        // Initialize knowledge badges on page load
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(updateKnowledgeBadges, 500);
        });

        async function sendToSheets(type, tokenData = null) {
            const profile = JSON.parse(localStorage.getItem('mindful_profile'));
            if (!profile) return;
            // ‰ªäÊó•„ÅÆÂã§ÂãôÂÖà„Åå„ÅÇ„Çå„Å∞„Åù„Å°„Çâ„Çí‰ΩøÁî®„ÄÅ„Å™„Åë„Çå„Å∞ÊâÄÂ±ûÊã†ÁÇπ
            const targetBase = todayBase || profile.base;
            const url = SCRIPT_URLS[targetBase];
            if (!url || url.startsWith('YOUR_')) { console.log('Sheets URL not configured'); return; }
            document.getElementById('sendingOverlay').classList.add('active');

            const payload = {
                type,
                timestamp: workDate ? new Date(workDate + 'T' + new Date().toTimeString().slice(0, 8)).toISOString() : new Date().toISOString(),
                workDate: workDate || new Date().toISOString().split('T')[0],
                name: profile.name,
                homeBase: profile.base,
                todayBase: todayBase || profile.base,
                base: todayBase || profile.base, // ÂæåÊñπ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅ
                shiftStart: shiftTimes.start,
                shiftEnd: shiftTimes.end,
                checks,
                mindChecks,
                quests: currentQuests.map(q => ({ id: q.id, title: q.titleEn })),
                rating: currentRating,
                memo: document.getElementById('memoInput')?.value || ''
            };

            // „Éà„Éº„ÇØ„É≥ÊÉÖÂ†±„ÇíËøΩÂä†
            if (tokenData) {
                payload.tokenEarned = tokenData.total;
                payload.tokenBreakdown = tokenData.breakdown.map(b => `${b.label}:+${b.amount}`).join(', ');
            }

            // SVD API Token
            if (SVD_API_TOKEN) payload.token = SVD_API_TOKEN;

            try { await fetch(url, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify(payload) }); } catch (e) { console.error('Failed:', e); }
            setTimeout(() => { document.getElementById('sendingOverlay').classList.remove('active'); }, 800);
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('mindful_history') || '[]');
            const container = document.getElementById('historyList');
            container.innerHTML = history.length === 0 ? '<p style="color: var(--text-gray); text-align: center; font-size: 12px;">No history yet.</p>' : history.map(item => `
            <div class="history-item">
                <div>
                    <div class="history-date">${item.date}</div>
                    <div class="history-quest">${item.quests ? item.quests.map(q => '#' + q.id).join(', ') : '#' + item.questId}</div>
                </div>
                <div class="history-stars">${'‚òÖ'.repeat(item.rating)}${'‚òÜ'.repeat(5 - item.rating)}</div>
            </div>
        `).join('');
        }

        function showHistory() { loadHistory(); const kc = document.getElementById('kiraraCollectionContainer'); if (kc) kc.innerHTML = renderKiraraCollection(); showScreen('screen-history'); }

        // ============ MY VISION Accordion ============
        let goalsAccordionOpen = false;

        function toggleGoalsAccordion() {
            const content = document.getElementById('goalsAccordionContent');
            const arrow = document.getElementById('goalsAccordionArrow');
            const header = document.getElementById('goalsAccordionHeader');

            goalsAccordionOpen = !goalsAccordionOpen;

            if (goalsAccordionOpen) {
                content.style.maxHeight = content.scrollHeight + 'px';
                arrow.style.transform = 'rotate(180deg)';
                header.style.borderRadius = '12px 12px 0 0';
            } else {
                content.style.maxHeight = '0';
                arrow.style.transform = 'rotate(0deg)';
                header.style.borderRadius = '12px';
            }
        }

        function showInsight() {
            loadInsightArticles();
            showScreen('screen-insight');
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');

            // Hide header/footer/nav for PDF viewer
            const isPdf = screenId === 'screen-pdf-viewer';
            document.querySelector('header').style.display = isPdf ? 'none' : '';
            document.querySelector('footer').style.display = isPdf ? 'none' : '';
            document.querySelector('nav').style.display = isPdf ? 'none' : '';

            document.querySelectorAll('.nav-item').forEach((n, i) => {
                n.classList.toggle('active',
                    (screenId === 'screen-morning' && i === 0) ||
                    (screenId === 'screen-active' && i === 1) ||
                    (screenId === 'screen-history' && i === 2) ||
                    (screenId === 'screen-insight' && i === 3) ||
                    (screenId === 'screen-profile' && i === 4)
                );
            });

            // Load announcements when STAY screen is shown
            if (screenId === 'screen-active') {
                loadAnnouncements();
            }
        }

        // ============ ANNOUNCEMENTS ============
        async function loadAnnouncements() {
            const profile = JSON.parse(localStorage.getItem('mindful_profile') || '{}');
            const targetBase = todayBase || profile.base;
            const url = SCRIPT_URLS[targetBase];
            if (!url) return;

            try {
                const response = await fetch(`${url}?action=announcements${tokenParam()}`);
                const result = await response.json();

                if (result.success && result.announcements) {
                    renderAnnouncements(result.announcements);
                }
            } catch (e) {
                console.log('Announcements not available:', e);
            }
        }

        function renderAnnouncements(announcements) {
            const container = document.getElementById('announcementsList');
            const countEl = document.getElementById('announcementsCount');

            if (!container) return;

            if (!announcements || announcements.length === 0) {
                container.innerHTML = '<div style="padding: 16px; background: var(--light-gray); border-radius: 10px; font-size: 12px; color: var(--text-gray); text-align: center;">„ÅäÁü•„Çâ„Åõ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                if (countEl) countEl.textContent = '';
                return;
            }

            // ÊúÄÊñ∞5‰ª∂„ÅÆ„ÅøË°®Á§∫
            const recent = announcements.slice(0, 5);
            if (countEl) countEl.textContent = recent.length;

            container.innerHTML = recent.map(ann => {
                const date = new Date(ann.date);
                const dateStr = date.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' });
                const timeStr = date.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });

                return `
                    <div style="padding: 14px; background: var(--white); border: 1px solid var(--border); border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.03);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-size: 11px; color: var(--gold); font-weight: 600;">${ann.author}</span>
                            <span style="font-size: 10px; color: var(--text-gray);">${dateStr} ${timeStr}</span>
                        </div>
                        <div style="font-size: 13px; color: var(--navy); line-height: 1.6; white-space: pre-wrap;">${ann.content}</div>
                    </div>
                `;
            }).join('');
        }

        // PDF Viewer with PDF.js
        let lastScreenBeforePdf = 'screen-morning';
        let pdfDoc = null;
        let pdfScale = 1.0;
        const PDF_SCALE_STEP = 0.25;
        const PDF_MIN_SCALE = 0.5;
        const PDF_MAX_SCALE = 3.0;

        async function openPdf(url) {
            const activeScreen = document.querySelector('.screen.active');
            if (activeScreen) lastScreenBeforePdf = activeScreen.id;

            // Add history entry so back button closes PDF
            history.pushState({ pdf: true }, '', '');

            showScreen('screen-pdf-viewer');

            // Reset zoom
            pdfScale = 1.0;
            document.getElementById('pdfZoomLevel').textContent = '100%';
            document.getElementById('pdfContainer').innerHTML = '<div style="color: white; padding: 40px;">Loading PDF...</div>';

            try {
                // Set worker source
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

                // Load PDF
                pdfDoc = await pdfjsLib.getDocument(url).promise;
                renderAllPages();
            } catch (err) {
                console.error('PDF load error:', err);
                document.getElementById('pdfContainer').innerHTML = `
                    <div style="color: white; padding: 40px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 20px;">‚ö†Ô∏è</div>
                        <div>PDF„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</div>
                        <a href="${url}" target="_blank" style="color: var(--gold); margin-top: 10px; display: inline-block;">Â§ñÈÉ®„ÅßÈñã„Åè</a>
                    </div>
                `;
            }
        }

        async function renderAllPages() {
            if (!pdfDoc) return;
            const container = document.getElementById('pdfContainer');
            container.innerHTML = '';

            for (let pageNum = 1; pageNum <= pdfDoc.numPages; pageNum++) {
                const page = await pdfDoc.getPage(pageNum);
                const viewport = page.getViewport({ scale: pdfScale * 1.5 }); // Base scale for mobile readability

                const canvas = document.createElement('canvas');
                canvas.style.maxWidth = '100%';
                canvas.style.boxShadow = '0 4px 20px rgba(0,0,0,0.5)';
                canvas.style.borderRadius = '4px';
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                await page.render({ canvasContext: context, viewport: viewport }).promise;
                container.appendChild(canvas);
            }
        }

        function pdfZoomIn() {
            if (pdfScale < PDF_MAX_SCALE) {
                pdfScale += PDF_SCALE_STEP;
                document.getElementById('pdfZoomLevel').textContent = Math.round(pdfScale * 100) + '%';
                renderAllPages();
            }
        }

        function pdfZoomOut() {
            if (pdfScale > PDF_MIN_SCALE) {
                pdfScale -= PDF_SCALE_STEP;
                document.getElementById('pdfZoomLevel').textContent = Math.round(pdfScale * 100) + '%';
                renderAllPages();
            }
        }

        function closePdf() {
            pdfDoc = null;
            document.getElementById('pdfContainer').innerHTML = '';
            showScreen(lastScreenBeforePdf);
        }

        // Handle browser back button for PDF viewer
        window.addEventListener('popstate', function (e) {
            const pdfViewer = document.getElementById('screen-pdf-viewer');
            if (pdfViewer && pdfViewer.classList.contains('active')) {
                closePdf();
            }
        });

        // Force Update - „Ç≠„É£„ÉÉ„Ç∑„É•„Çí„ÇØ„É™„Ç¢„Åó„Å¶ÊúÄÊñ∞Áâà„Çí„É≠„Éº„Éâ
        function forceUpdate() {
            const url = new URL(window.location.href);
            url.searchParams.set('v', Date.now());
            window.location.href = url.toString();
        }

        // PDFÁ¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞
        function confirmOpenPdf(pdfUrl) {
            if (confirm('Êñ∞„Åó„ÅÑ„Çø„Éñ„ÅßPDF„ÇíÈñã„Åç„Åæ„Åô„ÄÇ\n\nMINDFUL„Å´Êàª„Çã„Å´„ÅØ„ÄÅ„Éõ„Éº„É†ÁîªÈù¢„ÅÆ„Ç¢„Ç§„Ç≥„É≥„Çí„Çø„ÉÉ„Éó„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ')) {
                window.open(pdfUrl, '_blank');
            }
        }

        // ============ INSIGHT - Ë®ò‰∫ã„Ç≠„É•„É¨„Éº„Ç∑„Éß„É≥ ============
        const INSIGHT_API_URL = 'https://script.google.com/macros/s/YOUR_INSIGHT_SCRIPT_ID/exec';
        let articlesLoaded = false;

        async function loadInsightArticles() {
            if (articlesLoaded) return;

            const carousel = document.getElementById('articleCarousel');

            // „Çµ„É≥„Éó„É´Ë®ò‰∫ã„ÇíË°®Á§∫ÔºàGASÂÆüË£ÖÂâç„ÅÆ„Éá„É¢Áî®Ôºâ
            const sampleArticles = [
                {
                    title: '2026Âπ¥„ÅÆ„É¨„Çπ„Éà„É©„É≥Ê•≠Áïå„Éà„É¨„É≥„Éâ‰∫àÊ∏¨ÔºöAI„Å®„Çµ„Çπ„ÉÜ„Éä„Éì„É™„ÉÜ„Ç£„ÅåÈçµ',
                    source: 'FOODIST',
                    date: '2026.01.09',
                    url: 'https://www.inshokuten.com/foodist/'
                },
                {
                    title: 'È£≤È£üÂ∫ó„ÅÆ‰∫∫ÊùêÁ¢∫‰øùË°ìÔºöZ‰∏ñ‰ª£„ÅåÂÉç„Åç„Åü„ÅÑÂ∫óËàó„ÅÆÊù°‰ª∂„Å®„ÅØ',
                    source: 'FOODIST',
                    date: '2026.01.08',
                    url: 'https://www.inshokuten.com/foodist/'
                },
                {
                    title: 'Âéü‰æ°È´òÈ®∞„Çí‰πó„ÇäË∂ä„Åà„ÇãÔºö„É°„Éã„É•„Éº‰æ°Ê†ºÊîπÂÆö„ÅÆ„Éô„Çπ„Éà„Éó„É©„ÇØ„ÉÜ„Ç£„Çπ',
                    source: 'È£≤È£üÂ∫ó.COM',
                    date: '2026.01.07',
                    url: 'https://www.inshokuten.com/'
                },
                {
                    title: '„Ç§„É≥„Éê„Ç¶„É≥„ÉâÂæ©Ê¥ªÔºöÂ§ñÂõΩ‰∫∫Ë¶≥ÂÖâÂÆ¢„Å´ÈÅ∏„Å∞„Çå„Çã„É¨„Çπ„Éà„É©„É≥„ÅÆÂÖ±ÈÄöÁÇπ',
                    source: 'FOODIST',
                    date: '2026.01.06',
                    url: 'https://www.inshokuten.com/foodist/'
                },
                {
                    title: '„ÉÅ„Éº„É†„Éì„É´„Éá„Ç£„É≥„Ç∞„ÅÆÊñ∞Â∏∏Ë≠òÔºö„É¨„Çπ„Éà„É©„É≥ÁµåÂñ∂ËÄÖ„ÅåÂÆüË∑µ„Åô„Çã1on1Ë°ì',
                    source: 'È£≤È£üÂ∫ó.COM',
                    date: '2026.01.05',
                    url: 'https://www.inshokuten.com/'
                }
            ];

            carousel.innerHTML = sampleArticles.map(article => `
                <a href="${article.url}" target="_blank" rel="noopener" class="article-card">
                    <div class="article-source">${article.source}</div>
                    <div class="article-title">${article.title}</div>
                    <div class="article-date">${article.date}</div>
                </a>
            `).join('');

            articlesLoaded = true;
        }

        // ============ INSIGHT - SATOSHI AI ============
        const AI_API_URL = 'https://script.google.com/macros/s/AKfycbw655OvGtlygwrjWsgKm-3tXpetrTWgXnv5uALe07t-_Fr886F4uZPN6bZX9OsgDmgW/exec';
        let isAIProcessing = false;
        const AI_DAILY_TOKEN_LIMIT = 10;

        function getAITokensToday() {
            const data = JSON.parse(localStorage.getItem('mindful_ai_tokens') || '{}');
            const today = new Date().toISOString().split('T')[0];
            if (data.date !== today) {
                return 0;
            }
            return data.count || 0;
        }

        function addAIToken() {
            const today = new Date().toISOString().split('T')[0];
            let data = JSON.parse(localStorage.getItem('mindful_ai_tokens') || '{}');

            if (data.date !== today) {
                data = { date: today, count: 0 };
            }

            if (data.count >= AI_DAILY_TOKEN_LIMIT) {
                return { success: false, remaining: 0 };
            }

            data.count++;
            localStorage.setItem('mindful_ai_tokens', JSON.stringify(data));
            addTokens(1);
            return { success: true, remaining: AI_DAILY_TOKEN_LIMIT - data.count };
        }

        async function sendToAI() {
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendAIBtn');
            const question = input.value.trim();

            if (!question || isAIProcessing) return;

            isAIProcessing = true;
            sendBtn.disabled = true;
            input.value = '';

            // „É¶„Éº„Ç∂„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML += `
                <div class="chat-bubble user">${escapeHtml(question)}</div>
            `;

            // „Çø„Ç§„Éî„É≥„Ç∞„Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºË°®Á§∫
            messagesContainer.innerHTML += `
                <div class="chat-bubble ai" id="typingIndicator">
                    <div class="ai-name">SATOSHI</div>
                    <div class="ai-typing"><span></span><span></span><span></span></div>
                </div>
            `;
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            try {
                // Áõ∏Ë´áËÄÖ„Éó„É≠„Éï„Ç°„Ç§„É´„Å®Â±•Ê≠¥„ÇíÂèñÂæó
                const profile = JSON.parse(localStorage.getItem('mindful_profile') || '{}');
                const chatHistory = JSON.parse(localStorage.getItem('mindful_chat_history') || '[]');

                // Â±•Ê≠¥„ÇíÊñáÂ≠óÂàó„Å´Â§âÊèõÔºàÊúÄÊñ∞5‰ª∂Ôºâ
                const historyText = chatHistory.slice(-5).map(h =>
                    `${h.date}: ${h.topic}„Å´„Å§„ÅÑ„Å¶Áõ∏Ë´á`
                ).join('\n');

                // „ÇØ„Ç®„É™„Éë„É©„É°„Éº„Çø„ÇíÊßãÁØâ
                const params = new URLSearchParams({
                    action: 'chat',
                    q: question,
                    name: profile.name || '',
                    base: profile.base || '',
                    role: profile.role || '',
                    history: historyText
                });

                // GASÁµåÁî±„ÅßGemini API„Å´„É™„ÇØ„Ç®„Çπ„Éà
                const response = await fetch(AI_API_URL + '?' + params.toString(), {
                    method: 'GET',
                    mode: 'cors'
                });

                let aiResponse;
                if (response.ok) {
                    const data = await response.json();
                    aiResponse = data.response || generateLocalResponse(question);
                } else {
                    aiResponse = generateLocalResponse(question);
                }

                // „Çø„Ç§„Éî„É≥„Ç∞„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„ÇíÂâäÈô§„Åó„Å¶ÂõûÁ≠îË°®Á§∫
                document.getElementById('typingIndicator')?.remove();

                // Áõ∏Ë´áÂ±•Ê≠¥„Çí‰øùÂ≠ò
                saveChatHistory(question);

                // „Éà„Éº„ÇØ„É≥‰ªò‰∏éÂá¶ÁêÜ
                const tokenResult = addAIToken();
                let tokenNotice = '';
                if (tokenResult.success) {
                    tokenNotice = `<div class="ai-token-notice">ü™ô +1 TOKENÔºàÊú¨Êó•ÊÆã„Çä: ${tokenResult.remaining}ÂõûÔºâ</div>`;
                } else {
                    tokenNotice = `<div class="ai-token-notice" style="color: var(--text-gray);">üìå Êú¨Êó•„ÅÆ„Éà„Éº„ÇØ„É≥‰∏äÈôêÔºà${AI_DAILY_TOKEN_LIMIT}ÂõûÔºâ„Å´ÈÅî„Åó„Åæ„Åó„Åü</div>`;
                }

                messagesContainer.innerHTML += `
                    <div class="chat-bubble ai">
                        <div class="ai-name">SATOSHI</div>
                        ${escapeHtml(aiResponse)}
                        ${tokenNotice}
                    </div>
                `;
            } catch (error) {
                console.log('AI API error, using local response:', error);
                document.getElementById('typingIndicator')?.remove();
                const localResponse = generateLocalResponse(question);

                // Áõ∏Ë´áÂ±•Ê≠¥„Çí‰øùÂ≠ò
                saveChatHistory(question);

                // „Éà„Éº„ÇØ„É≥‰ªò‰∏éÂá¶ÁêÜÔºà„É≠„Éº„Ç´„É´„É¨„Çπ„Éù„É≥„Çπ„Åß„ÇÇ‰ªò‰∏éÔºâ
                const tokenResult = addAIToken();
                let tokenNotice = '';
                if (tokenResult.success) {
                    tokenNotice = `<div class="ai-token-notice">ü™ô +1 TOKENÔºàÊú¨Êó•ÊÆã„Çä: ${tokenResult.remaining}ÂõûÔºâ</div>`;
                } else {
                    tokenNotice = `<div class="ai-token-notice" style="color: var(--text-gray);">üìå Êú¨Êó•„ÅÆ„Éà„Éº„ÇØ„É≥‰∏äÈôêÔºà${AI_DAILY_TOKEN_LIMIT}ÂõûÔºâ„Å´ÈÅî„Åó„Åæ„Åó„Åü</div>`;
                }

                messagesContainer.innerHTML += `
                    <div class="chat-bubble ai">
                        <div class="ai-name">SATOSHI</div>
                        ${escapeHtml(localResponse)}
                        ${tokenNotice}
                    </div>
                `;
            }

            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            isAIProcessing = false;
            sendBtn.disabled = false;
        }

        // Áõ∏Ë´áÂ±•Ê≠¥„Çí‰øùÂ≠ò
        function saveChatHistory(question) {
            let history = JSON.parse(localStorage.getItem('mindful_chat_history') || '[]');

            history.push({
                date: new Date().toISOString().split('T')[0],
                question: question.slice(0, 50),
                topic: detectTopic(question)
            });

            // ÊúÄÊñ∞10‰ª∂„ÅÆ„Åø‰øùÊåÅ
            if (history.length > 10) {
                history = history.slice(-10);
            }

            localStorage.setItem('mindful_chat_history', JSON.stringify(history));
        }

        // „ÉÜ„Éº„ÉûËá™ÂãïÂàÜÈ°û
        function detectTopic(question) {
            const q = question.toLowerCase();
            if (q.includes('„Çµ„Éº„Éì„Çπ') || q.includes('Êé•ÂÆ¢') || q.includes('„ÅäÂÆ¢Êßò')) return '„Çµ„Éº„Éì„Çπ';
            if (q.includes('„ÉØ„Ç§„É≥') || q.includes('ÊñôÁêÜ') || q.includes('„É°„Éã„É•„Éº')) return 'ÂïÜÂìÅÁü•Ë≠ò';
            if (q.includes('„ÉÅ„Éº„É†') || q.includes('‰ª≤Èñì') || q.includes('‰∫∫ÈñìÈñ¢‰øÇ')) return '„ÉÅ„Éº„É†„ÉØ„Éº„ÇØ';
            if (q.includes('„Ç≠„É£„É™„Ç¢') || q.includes('Â∞ÜÊù•') || q.includes('ÊàêÈï∑')) return '„Ç≠„É£„É™„Ç¢';
            if (q.includes('Âøô„Åó„ÅÑ') || q.includes('Áñ≤„Çå') || q.includes('Â§ßÂ§â')) return '„É°„É≥„Çø„É´';
            if (q.includes('„ÇØ„É¨„Éº„É†') || q.includes('„Éà„É©„Éñ„É´')) return '„Éà„É©„Éñ„É´ÂØæÂøú';
            return '„Åù„ÅÆ‰ªñ';
        }

        function generateLocalResponse(question) {
            // GASÊú™Ë®≠ÂÆöÊôÇ„ÅÆ„É≠„Éº„Ç´„É´ÂøúÁ≠îÔºàÂØÑ„ÇäÊ∑ª„ÅÑÂûãÔºâ
            const responses = [
                `„ÅÑ„ÅÑË≥™Âïè„Å†„Å≠„ÄÇ„ÇÇ„ÅÜÂ∞ë„ÅóË©≥„Åó„ÅèÁä∂Ê≥Å„ÇíÊïô„Åà„Å¶„ÇÇ„Çâ„Åà„ÇãÔºüÂÖ∑‰ΩìÁöÑ„Å™„Ç¢„Éâ„Éê„Ç§„Çπ„Åå„Åß„Åç„Çã„Å®ÊÄù„ÅÜ„ÄÇ`,
                `„Åù„ÅÆÊÇ©„Åø„ÄÅ„Åó„Å£„Åã„ÇäËÅû„Åç„Åü„ÅÑ„ÄÇËÉåÊôØ„ÇÑÁä∂Ê≥Å„Çí„ÇÇ„ÅÜÂ∞ë„ÅóÊïô„Åà„Å¶„Åè„Çå„Çã„Å®„ÄÅ‰∏ÄÁ∑í„Å´ËÄÉ„Åà„Çâ„Çå„Çã„Çà„ÄÇ`,
                `ÂàÜ„Åã„Å£„Åü„ÄÅËÄÉ„Åà„Å¶„Åø„Çà„ÅÜ„ÄÇ‰Ωï„ÅãÁâπ„Å´Ê∞ó„Å´„Å™„Å£„Å¶„ÅÑ„Çã„Åì„Å®„ÇÑ„ÄÅË©¶„Åó„Å¶„Åø„Åü„ÅÑ„Åì„Å®„ÅØ„ÅÇ„ÇãÔºü`,
                `Áõ∏Ë´á„Åó„Å¶„Åè„Çå„Å¶„ÅÇ„Çä„Åå„Å®„ÅÜ„ÄÇ„Å©„Çì„Å™ÁµêÊûú„ÇíÁõÆÊåá„Åó„Å¶„ÅÑ„Çã„ÅãÊïô„Åà„Å¶„ÇÇ„Çâ„Åà„Çã„Å®„ÄÅÂÖ∑‰ΩìÁöÑ„Å™ÊèêÊ°à„Åå„Åß„Åç„Åù„ÅÜ„ÄÇ`
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML.replace(/\n/g, '<br>');
        }

        function resetApp() {
            // Clear session data
            localStorage.removeItem('mindful_checkin_time');
            localStorage.removeItem('mindful_active_quests');
            localStorage.removeItem('mindful_today_base'); // Clear today's work location

            currentRating = 0; currentQuests = [];
            todayBase = null; // Reset today's work location
            checkFields.forEach(f => checks[f] = null);
            mindFields.forEach(f => mindChecks[f] = null);
            document.getElementById('memoInput').value = '';
            document.querySelectorAll('.star').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('selected'));
            document.querySelectorAll('.base-option.today-base').forEach(o => o.classList.remove('selected')); // Reset location selector
            document.getElementById('todayLocationStatus').innerHTML = '<span style="color: var(--text-gray);">Âã§ÂãôÂÖà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</span>';
            document.getElementById('healthStatus').className = 'health-status incomplete';
            document.getElementById('healthStatus').textContent = '„Åô„Åπ„Å¶„ÅÆÈ†ÖÁõÆ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
            document.getElementById('healthCheckCard').classList.remove('complete');
            document.getElementById('mindStatus').className = 'health-status incomplete';
            document.getElementById('mindStatus').textContent = 'ÂøÉ„ÅÆÁä∂ÊÖã„ÇÇÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
            document.getElementById('mindCheckCard').classList.remove('complete');
            document.getElementById('drawArea').style.display = 'block';
            document.getElementById('drawArea').classList.add('disabled');
            document.getElementById('drawArea').querySelector('.draw-hint').textContent = 'üìç „Åæ„Åö‰ªäÊó•„ÅÆÂã§ÂãôÂÖà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
            document.getElementById('questCardsContainer').innerHTML = '';
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('reflectionNotice').style.display = 'none';
            // Update badge to show only home base
            const profile = JSON.parse(localStorage.getItem('mindful_profile'));
            if (profile) showUserBadge(profile);
            showScreen('screen-morning');
        }

        init();

        // ===== Service Worker Registration with Auto-Update =====
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then((registration) => {
                    console.log('Service Worker registered:', registration.scope);

                    // Check for updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // New version available - show update notification
                                showUpdateNotification();
                            }
                        });
                    });
                })
                .catch((error) => {
                    console.log('Service Worker registration failed:', error);
                });

            // Listen for messages from Service Worker
            navigator.serviceWorker.addEventListener('message', (event) => {
                if (event.data && event.data.type === 'SW_UPDATED') {
                    console.log('App updated to:', event.data.version);
                    showUpdateNotification();
                }
            });
        }

        function showUpdateNotification() {
            // Create update notification banner
            const banner = document.createElement('div');
            banner.id = 'updateBanner';
            banner.style.cssText = 'position: fixed; bottom: 80px; left: 20px; right: 20px; background: linear-gradient(135deg, var(--navy), var(--navy-dark)); color: white; padding: 16px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 10000; text-align: center; font-family: Inter, sans-serif;';
            banner.innerHTML = `
                <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">üöÄ Êñ∞„Åó„ÅÑ„Éê„Éº„Ç∏„Éß„É≥„Åå„ÅÇ„Çä„Åæ„Åô</div>
                <button onclick="location.reload(true)" style="background: var(--gold); color: var(--navy-dark); border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 13px;">‰ªä„Åô„ÅêÊõ¥Êñ∞</button>
                <button onclick="document.getElementById('updateBanner').remove()" style="background: transparent; color: rgba(255,255,255,0.7); border: 1px solid rgba(255,255,255,0.3); padding: 10px 15px; border-radius: 8px; margin-left: 8px; cursor: pointer; font-size: 13px;">Âæå„Åß</button>
            `;
            document.body.appendChild(banner);
        }
    </script>
</body>

</html>