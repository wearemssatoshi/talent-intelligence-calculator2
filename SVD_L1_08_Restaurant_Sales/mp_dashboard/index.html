<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOMENTUM PEAKS â€” Restaurant OS</title>
    <meta name="description" content="SVD Demand Intelligence Dashboard â€” 7-store MP monitoring">
    <link rel="stylesheet" href="style.css?v=20260222a">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="gas_bridge.js?v=20260222a"></script>
</head>

<body>

    <!-- â•â•â• Header â•â•â• -->
    <div class="header">
        <div>
            <h1>MOMENTUM PEAKS</h1>
            <div class="subtitle">Restaurant OS â€” Demand Intelligence</div>
        </div>
        <div class="header-controls">
            <div class="control-group">
                <label>DATE</label>
                <input type="date" id="selDate">
            </div>
            <button class="tax-display-btn active" id="taxDisplayToggle" onclick="toggleTaxDisplay()">
                <span class="tax-label" id="taxLabel">ç¨æŠœ</span>
            </button>
        </div>
    </div>

    <!-- â•â•â• Navigation â•â•â• -->
    <nav class="nav" id="mainNav">
        <button class="nav-btn active" data-tab="command">â‘  THE BRIDGE<span class="nav-sub">SVDæ“èˆµå®¤</span></button>
        <button class="nav-btn" data-tab="dive">â‘¡ FORECAST DETAIL<span class="nav-sub">äºˆæ¸¬è©³ç´°</span></button>
        <button class="nav-btn" data-tab="forecast">â‘¢ FORECAST CHART<span class="nav-sub">äºˆæ¸¬ãƒãƒ£ãƒ¼ãƒˆ</span></button>
        <button class="nav-btn" data-tab="entry">â‘£ ENTRY<span class="nav-sub">å£²ä¸Šå…¥åŠ›</span></button>
        <button class="nav-btn" data-tab="import">â‘¤ DATA IMPORT<span class="nav-sub">ãƒ‡ãƒ¼ã‚¿å–è¾¼</span></button>
        <button class="nav-btn" data-tab="staffing">â‘¥ STAFFING<span class="nav-sub">äººå“¡é…ç½®</span></button>
        <button class="nav-btn" data-tab="report">â‘¦ REPORT<span class="nav-sub">å®Ÿç¸¾ãƒ¬ãƒãƒ¼ãƒˆ</span></button>
        <button class="nav-btn" data-tab="bg">â‘§ BG POP UP<span class="nav-sub">ãƒ“ã‚¢ã‚¬ãƒ¼ãƒ‡ãƒ³</span></button>
    </nav>

    <!-- â•â•â• â‘  THE BRIDGE â•â•â• -->
    <div class="panel active" id="p-command">

        <!-- Base Filter -->
        <div class="base-filter" id="base-filter"></div>

        <!-- Today's Forecast vs Actual -->
        <div class="card">
            <h3>ğŸ“Š æœ¬æ—¥ã®äºˆæ¸¬ vs å®Ÿç¸¾</h3>
            <div id="forecast-comparison"></div>
        </div>

        <!-- Channel Breakdown -->
        <div class="card">
            <h3>ğŸ“‹ ãƒãƒ£ãƒãƒ«åˆ¥å†…è¨³</h3>
            <div id="channel-breakdown"></div>
        </div>

        <!-- Store Cards -->
        <div class="store-grid" id="store-grid"></div>



        <!-- Monthly Summary -->
        <div class="card">
            <h3>ğŸ“Š æœˆé–“ã‚µãƒãƒªãƒ¼</h3>
            <div class="grid-2">
                <div id="monthly-summary"></div>
                <div class="chart-wrap"><canvas id="chart-monthly"></canvas></div>
            </div>
        </div>
    </div>

    <!-- â•â•â• â‘¡ FORECAST DETAIL â•â•â• -->
    <div class="panel" id="p-dive">
        <!-- Store Selector -->
        <div class="controls">
            <div class="control-group">
                <label>åº—èˆ—</label>
                <select id="selBase"></select>
            </div>
            <button class="btn" id="btn-compare-modal" style="margin-left:auto;">ğŸ“Š å…¨åº—æ¯”è¼ƒ</button>
        </div>

        <!-- Forecast detail: matching records, channel breakdown, KF factors -->
        <div id="dive-content"></div>
    </div>

    <!-- â•â•â• CROSS COMPARE Modal â•â•â• -->
    <div class="modal-overlay hidden" id="compare-modal">
        <div class="modal-content">
            <div style="display:flex;justify-content:space-between;align-items:center;">
                <h3>ğŸ“Š å…¨åº—èˆ—æ¯”è¼ƒ</h3>
                <button class="btn" id="btn-close-compare">âœ• é–‰ã˜ã‚‹</button>
            </div>
            <div class="chart-wrap tall"><canvas id="chart-compare-monthly"></canvas></div>
            <div class="chart-wrap tall"><canvas id="chart-season-perf"></canvas></div>
            <div class="year-cards" id="compare-year-cards"></div>
        </div>
    </div>

    <!-- â•â•â• â‘¢ FORECAST â•â•â• -->
    <div class="panel" id="p-forecast">
        <div class="controls">
            <div class="control-group">
                <label>æ‹ ç‚¹</label>
                <select id="fcBase"></select>
            </div>
            <div class="control-group">
                <label>FROM</label>
                <input type="date" id="fcFrom">
            </div>
            <div class="control-group">
                <label>TO</label>
                <input type="date" id="fcTo">
            </div>
            <button class="btn btn-gold" id="fcRun">GENERATE FORECAST</button>
        </div>

        <div class="card mt-16">
            <h3>ğŸ“Š FORECAST RESULTS</h3>
            <div class="chart-wrap tall"><canvas id="chart-forecast"></canvas></div>
        </div>

        <!-- Per-store forecast tables rendered dynamically -->
        <div id="fc-content"></div>
    </div>




    <!-- â•â•â• â‘£ ENTRYï¼ˆå£²ä¸Šå…¥åŠ›ï¼‰ â•â•â• -->
    <div class="panel" id="p-entry">
        <div id="entry-form"></div>
    </div>

    <!-- â•â•â• â‘¤ DATA IMPORT â•â•â• -->
    <div class="panel" id="p-import">
        <div class="card" id="gasSettingsCard"></div>
        <div class="card">
            <h3>ğŸ“ MP DATA (mp_data.json)</h3>
            <div class="drop-zone" id="dz-main" data-type="main">
                <div class="dz-icon">ğŸ“Š</div>
                <div class="dz-text">ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ— ã¾ãŸã¯ ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</div>
                <div class="dz-hint">mp_data.json â€” ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«</div>
            </div>
            <div class="import-status" id="is-main"></div>
            <input type="file" id="fi-main" accept=".json" class="hidden">
        </div>

        <div class="card">
            <h3>ğŸ“ äºˆç´„ãƒ‡ãƒ¼ã‚¿ (reservations.csv) â€” OPTIONAL</h3>
            <div class="drop-zone" id="dz-reserve" data-type="reserve">
                <div class="dz-icon">ğŸ“…</div>
                <div class="dz-text">ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ— ã¾ãŸã¯ ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</div>
                <div class="dz-hint">date,store_id,reservation_count,reservation_sales_est,note</div>
            </div>
            <div class="import-status" id="is-reserve"></div>
            <input type="file" id="fi-reserve" accept=".csv" class="hidden">
        </div>

        <div class="card">
            <h3>ğŸ“ äººå“¡å®šç¾© (staffing_rules.csv) â€” OPTIONAL</h3>
            <div class="drop-zone" id="dz-staff" data-type="staff">
                <div class="dz-icon">ğŸ‘¥</div>
                <div class="dz-text">ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ— ã¾ãŸã¯ ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</div>
                <div class="dz-hint">store_id,segment,mp_low,mp_high,hall_count,kitchen_count,note</div>
            </div>
            <div class="import-status" id="is-staff"></div>
            <input type="file" id="fi-staff" accept=".csv" class="hidden">
        </div>

        <div style="display:flex;gap:12px;margin-top:16px;">
            <button class="btn btn-gold" id="btn-save-local">ğŸ’¾ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜</button>
            <button class="btn" id="btn-clear-local">ğŸ—‘ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢</button>
            <button class="btn" id="btn-load-default">ğŸ“¥ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆJSONèª­è¾¼</button>
        </div>
    </div>

    <!-- â•â•â• â‘¥ STAFFING â•â•â• -->
    <div class="panel" id="p-staffing">
        <div class="controls">
            <div class="control-group">
                <label>DATE</label>
                <input type="date" id="stDate">
            </div>
        </div>

        <div class="card mt-16" id="staffing-content">
            <h3>ğŸ‘¥ å¿…è¦äººå“¡ç®—å‡º</h3>
            <div id="staffing-grid"></div>
        </div>

        <div class="card hidden" id="enter-placeholder">
            <div style="text-align:center;padding:40px;">
                <div style="font-size:48px;margin-bottom:16px;">ğŸ”´</div>
                <div
                    style="font-family:'JetBrains Mono';font-size:18px;font-weight:800;color:var(--red);letter-spacing:3px;">
                    ENTER</div>
                <div style="font-size:12px;color:var(--text-dim);margin-top:8px;">TI (Talent Intelligence) ãŒæ¥ç¶šã•ã‚ŒãŸæ™‚ã€èµ·å‹•ã™ã‚‹ã€‚
                </div>
                <div style="font-size:11px;color:var(--text-muted);margin-top:4px;">MP (DEMAND) Ã— TI (SUPPLY) =
                    ONE-BUTTON SHIFT MAKER</div>
            </div>
        </div>
    </div>

    <!-- â•â•â• â‘¦ REPORT â•â•â• -->
    <div class="panel" id="p-report">
        <div id="report-root"></div>
    </div>

    <!-- â•â•â• â‘§ BG POP UPï¼ˆãƒ“ã‚¢ã‚¬ãƒ¼ãƒ‡ãƒ³ï¼‰ â•â•â• -->
    <div class="panel" id="p-bg">
        <div id="bg-root"></div>
    </div>

    <style>
        .gas-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
        }

        .gas-badge-on {
            background: rgba(76, 175, 80, 0.15);
            color: #4caf50;
        }

        .gas-badge-offline {
            background: rgba(244, 67, 54, 0.15);
            color: #f44336;
        }

        .gas-badge-off {
            background: rgba(158, 158, 158, 0.15);
            color: #9e9e9e;
        }

        .gas-settings-panel {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
        }

        .gas-settings-panel h3 {
            color: var(--gold);
            margin: 0 0 16px 0;
            font-size: 16px;
        }

        .gas-settings-row {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .gas-settings-row label {
            color: var(--text-dim);
            font-size: 13px;
            min-width: 120px;
        }

        .gas-settings-row input {
            flex: 1;
            min-width: 250px;
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-family: 'JetBrains Mono', monospace;
        }

        .gas-btn {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .gas-btn:hover {
            border-color: var(--gold);
            color: var(--gold);
        }

        .gas-btn-primary {
            background: rgba(212, 175, 55, 0.15);
            border-color: var(--gold);
            color: var(--gold);
        }

        .gas-test-result {
            font-size: 13px;
            margin-top: 8px;
            min-height: 20px;
        }

        .gas-settings-info {
            display: flex;
            gap: 16px;
            align-items: center;
            margin-top: 12px;
        }

        .gas-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 13px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            z-index: 10000;
        }

        .gas-toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Performance Report */
        .period-btn {
            padding: 6px 14px;
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.04);
            color: #aaa;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .period-btn:hover {
            background: rgba(212, 168, 67, 0.15);
            color: #d4a843;
            border-color: rgba(212, 168, 67, 0.3);
        }

        .period-btn.active {
            background: rgba(212, 168, 67, 0.2);
            color: #d4a843;
            border-color: #d4a843;
        }

        .svd-btn {
            padding: 8px 16px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.06);
            color: #ccc;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .svd-btn:hover {
            background: rgba(255, 255, 255, 0.12);
            color: #fff;
        }

        .svd-btn.gold {
            border-color: rgba(212, 168, 67, 0.4);
            color: #d4a843;
        }

        .svd-btn.gold:hover {
            background: rgba(212, 168, 67, 0.2);
            color: #f0d060;
        }

        #rpt-body input[type="date"] {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 6px;
            color: #ccc;
            padding: 4px 8px;
        }
    </style>
    <script src="app.js?v=20260222b"></script>
</body>

</html>