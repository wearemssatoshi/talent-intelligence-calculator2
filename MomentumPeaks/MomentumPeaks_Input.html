<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentum Peaks | SVD Daily Input</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: rgba(20, 20, 30, 0.85);
            --accent-gold: #d4af37;
            --accent-blue: #4a90d9;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --glass-border: rgba(255, 255, 255, 0.1);
            --success: #4ade80;
            --error: #f87171;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', 'Montserrat', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        header h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-gold);
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        header p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent-gold);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--accent-gold);
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        select,
        input[type="text"],
        input[type="number"],
        input[type="date"],
        textarea {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        select:focus,
        input:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent-gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
        }

        select option {
            background: var(--bg-dark);
            color: var(--text-primary);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 28px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-gold) 0%, #c9a227 100%);
            color: #000;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .segment-entry {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .segment-entry h4 {
            font-size: 0.95rem;
            color: var(--accent-blue);
            margin-bottom: 12px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .channel-section {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--glass-border);
        }

        .channel-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .channel-header {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        #channelInputs {
            /* Controlled by JavaScript - no default display:none */
        }

        .hidden {
            display: none !important;
        }

        .success-message {
            background: rgba(74, 222, 128, 0.1);
            border: 1px solid var(--success);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            color: var(--success);
            margin-top: 20px;
        }

        .footer {
            text-align: center;
            padding: 30px 0;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        @media (max-width: 600px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>MOMENTUM PEAKS</h1>
            <p>SVD Daily Performance Input System</p>
        </header>

        <!-- Step 1: Êó•‰ªò„Å®Êã†ÁÇπÈÅ∏Êäû -->
        <div class="card" id="step1">
            <div class="card-title">Step 1: Êó•‰ªò„Å®Êã†ÁÇπ</div>

            <div class="form-group">
                <label>Êó•‰ªò</label>
                <input type="date" id="inputDate">
            </div>

            <div class="form-group">
                <label>Êã†ÁÇπ„ÇíÈÅ∏Êäû</label>
                <select id="baseSelect">
                    <option value="">-- ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ --</option>
                </select>
            </div>

            <div class="form-group">
                <label>Êã†ÁÇπÊù•Â†¥ËÄÖÊï∞</label>
                <input type="number" id="baseVisitors" placeholder="‰æã: 1500">
            </div>

            <!-- Â§úÊôØ„Éù„Ç§„É≥„ÉàÔºàËóªÂ≤©Â±±„ÅÆ„ÅøË°®Á§∫Ôºâ -->
            <div class="form-group hidden" id="nightViewGroup">
                <label>üåÉ Â§úÊôØ„Éù„Ç§„É≥„ÉàÔºàËóªÂ≤©Â±±Â∞ÇÁî®Ôºâ</label>
                <input type="number" id="nightViewPoints" placeholder="‰æã: 85">
            </div>
        </div>

        <!-- Step 2: „ÉÅ„É£„É≥„Éç„É´Âà•ÂÖ•Âäõ -->
        <div class="card hidden" id="step2">
            <div class="card-title">Step 2: „ÉÅ„É£„É≥„Éç„É´Âà•„Éá„Éº„ÇøÂÖ•Âäõ</div>
            <div id="channelInputs"></div>
        </div>

        <!-- Step 3: ÈÄÅ‰ø° -->
        <div class="card hidden" id="step3">
            <button class="btn btn-primary" id="submitBtn" onclick="submitData()">
                ÈÄÅ‰ø°„Åô„Çã
            </button>
            <div id="successMessage" class="success-message hidden">
                ‚úì „Éá„Éº„Çø„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ
            </div>
        </div>

        <footer class="footer">
            SAPPORO VIEWTIFUL DINING ‚Äî ORIGIN
        </footer>
    </div>

    <script>
        // ========== Ë®≠ÂÆö ==========
        // ‚òÖ„Åì„Åì„Å´Apps Script„ÅÆ„Éá„Éó„É≠„Ç§URL„ÇíÂÖ•„Çå„Å¶„Åè„Å†„Åï„ÅÑ‚òÖ
        const API_URL = 'YOUR_APPS_SCRIPT_WEB_APP_URL';

        // „É≠„Éº„Ç´„É´Ë®≠ÂÆö„Éá„Éº„ÇøÔºàAPI„Åå‰Ωø„Åà„Å™„ÅÑÂ†¥Âêà„ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ
        const CONFIG = {
            bases: [
                {
                    id: 'MOIWAYAMA',
                    name: 'ËóªÂ≤©Â±±',
                    channels: [
                        { id: 'JW', name: 'THE JEWELS', segments: ['LUNCH', 'DINNER'] },
                        { id: 'JW_TO', name: 'JW_TakeOut', segments: ['ALL'] }
                    ]
                },
                {
                    id: 'OKURAYAMA',
                    name: 'Â§ßÂÄâÂ±±',
                    channels: [
                        { id: 'NP', name: 'NOUVELLE POUSSE OKURAYAMA', segments: ['LUNCH', 'DINNER'] },
                        { id: 'CE', name: 'CELEST√â', segments: ['ALL'] },
                        { id: 'RP', name: 'PEPOS', segments: ['ALL'] }
                    ]
                },
                {
                    id: 'TV_TOWER',
                    name: '„Åï„Å£„ÅΩ„Çç„ÉÜ„É¨„ÉìÂ°î',
                    channels: [
                        { id: 'GA', name: 'THE GARDEN SAPPORO HOKKAIDO GRILLE', segments: ['LUNCH', 'DINNER'] },
                        { id: 'GA_WINE', name: 'GA_WINEBAR', segments: ['NIGHT'] },
                        { id: 'GA_BQ', name: 'GA_BANQUET', segments: ['EVENT'] },
                        { id: 'BG', name: 'BEER GARDEN', segments: ['SUMMER'] }
                    ]
                },
                {
                    id: 'AKARENGA',
                    name: 'Ëµ§„Çå„Çì„Åå„ÉÜ„É©„Çπ',
                    channels: [
                        { id: 'BQ', name: 'LA BRIQUE SAPPORO Akarenga Terrace', segments: ['LUNCH', 'DINNER'] },
                        { id: 'RYB', name: '„É´„Çπ„ÉÑÁæäËπÑ„Å∂„Åü', segments: ['LUNCH', 'DINNER'] }
                    ]
                }
            ],
            weatherOptions: ['Êô¥„Çå', 'Êõá„Çä', 'Èõ®', 'Èõ™']
        };

        // ========== ÂàùÊúüÂåñ ==========
        document.addEventListener('DOMContentLoaded', () => {
            // ‰ªäÊó•„ÅÆÊó•‰ªò„Çí„Çª„ÉÉ„Éà
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('inputDate').value = today;

            // Êã†ÁÇπÈÅ∏ÊäûËÇ¢„ÇíÁîüÊàê
            const baseSelect = document.getElementById('baseSelect');
            CONFIG.bases.forEach(base => {
                const option = document.createElement('option');
                option.value = base.id;
                option.textContent = base.name;
                baseSelect.appendChild(option);
            });

            // Êã†ÁÇπÈÅ∏ÊäûÊôÇ„ÅÆ„Ç§„Éô„É≥„Éà
            baseSelect.addEventListener('change', onBaseChange);
        });

        // ========== Êã†ÁÇπÂ§âÊõ¥ÊôÇ ==========
        function onBaseChange() {
            const baseId = document.getElementById('baseSelect').value;
            const channelInputs = document.getElementById('channelInputs');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3');
            const nightViewGroup = document.getElementById('nightViewGroup');

            if (!baseId) {
                step2.classList.add('hidden');
                step3.classList.add('hidden');
                nightViewGroup.classList.add('hidden');
                return;
            }

            const base = CONFIG.bases.find(b => b.id === baseId);
            if (!base) return;

            // ËóªÂ≤©Â±±„ÅÆÊôÇ„Å†„ÅëÂ§úÊôØ„Éù„Ç§„É≥„ÉàË°®Á§∫
            if (baseId === 'MOIWAYAMA') {
                nightViewGroup.classList.remove('hidden');
            } else {
                nightViewGroup.classList.add('hidden');
            }

            // „ÉÅ„É£„É≥„Éç„É´ÂÖ•Âäõ„Éï„Ç©„Éº„É†„ÇíÁîüÊàê
            channelInputs.innerHTML = '';

            base.channels.forEach(channel => {
                const section = document.createElement('div');
                section.className = 'channel-section';

                // „Éì„Ç¢„Ç¨„Éº„Éá„É≥Â∞ÇÁî®„ÅÆÊôÇÈñìÂ∏ØÂà•ÂÖ•Âäõ
                if (channel.id === 'BG') {
                    section.innerHTML = `
                      <div class="channel-header">üç∫ ${channel.name}</div>
                      <div class="segment-entry" data-channel="${channel.id}" data-segment="SUMMER" data-is-beergarden="true">
                        <h4>„Éì„Ç¢„Ç¨„Éº„Éá„É≥ÔºàÊôÇÈñìÂ∏ØÂà•Ôºâ</h4>
                        <div class="grid-2">
                          <div class="form-group">
                            <label>Â£≤‰∏äÔºàÂÜÜÔºâ</label>
                            <input type="number" class="sales-input" placeholder="0">
                          </div>
                          <div class="form-group">
                            <label>ÂÆ¢Êï∞Ôºà‰∫∫Ôºâ</label>
                            <input type="number" class="visitors-input" placeholder="0">
                          </div>
                        </div>
                        <div class="form-group" style="margin-top:12px; padding:12px; background:rgba(74,144,217,0.1); border-radius:8px;">
                          <label style="color:var(--accent-blue); font-weight:600;">‚è∞ 12:00</label>
                          <div class="grid-2">
                            <div class="form-group">
                              <label>Â§©Ê∞ó</label>
                              <select class="weather-12">
                                ${CONFIG.weatherOptions.map(w => `<option value="${w}">${w}</option>`).join('')}
                              </select>
                            </div>
                            <div class="form-group">
                              <label>Ê∞óÊ∏©Ôºà‚ÑÉÔºâ</label>
                              <input type="number" class="temp-12" placeholder="25">
                            </div>
                          </div>
                        </div>
                        <div class="form-group" style="padding:12px; background:rgba(74,144,217,0.15); border-radius:8px;">
                          <label style="color:var(--accent-blue); font-weight:600;">‚è∞ 15:00</label>
                          <div class="grid-2">
                            <div class="form-group">
                              <label>Â§©Ê∞ó</label>
                              <select class="weather-15">
                                ${CONFIG.weatherOptions.map(w => `<option value="${w}">${w}</option>`).join('')}
                              </select>
                            </div>
                            <div class="form-group">
                              <label>Ê∞óÊ∏©Ôºà‚ÑÉÔºâ</label>
                              <input type="number" class="temp-15" placeholder="28">
                            </div>
                          </div>
                        </div>
                        <div class="form-group" style="padding:12px; background:rgba(74,144,217,0.2); border-radius:8px;">
                          <label style="color:var(--accent-blue); font-weight:600;">‚è∞ 18:00</label>
                          <div class="grid-2">
                            <div class="form-group">
                              <label>Â§©Ê∞ó</label>
                              <select class="weather-18">
                                ${CONFIG.weatherOptions.map(w => `<option value="${w}">${w}</option>`).join('')}
                              </select>
                            </div>
                            <div class="form-group">
                              <label>Ê∞óÊ∏©Ôºà‚ÑÉÔºâ</label>
                              <input type="number" class="temp-18" placeholder="24">
                            </div>
                          </div>
                        </div>
                      </div>
                    `;
                } else {
                    // ÈÄöÂ∏∏„ÉÅ„É£„É≥„Éç„É´
                    let segmentsHtml = '';
                    channel.segments.forEach(seg => {
                        const segLabel = getSegmentLabel(seg);
                        segmentsHtml += `
                          <div class="segment-entry" data-channel="${channel.id}" data-segment="${seg}">
                            <h4>${segLabel}</h4>
                            <div class="grid-2">
                              <div class="form-group">
                                <label>Â£≤‰∏äÔºàÂÜÜÔºâ</label>
                                <input type="number" class="sales-input" placeholder="0">
                              </div>
                              <div class="form-group">
                                <label>ÂÆ¢Êï∞Ôºà‰∫∫Ôºâ</label>
                                <input type="number" class="visitors-input" placeholder="0">
                              </div>
                            </div>
                            <div class="grid-2">
                              <div class="form-group">
                                <label>Â§©Ê∞ó</label>
                                <select class="weather-input">
                                  ${CONFIG.weatherOptions.map(w => `<option value="${w}">${w}</option>`).join('')}
                                </select>
                              </div>
                              <div class="form-group">
                                <label>Ê∞óÊ∏©Ôºà‚ÑÉÔºâ</label>
                                <input type="number" class="temp-input" placeholder="20">
                              </div>
                            </div>
                          </div>
                        `;
                    });

                    section.innerHTML = `
                      <div class="channel-header">${channel.name}</div>
                      ${segmentsHtml}
                    `;
                }

                channelInputs.appendChild(section);
            });

            step2.classList.remove('hidden');
            step3.classList.remove('hidden');
        }

        function getSegmentLabel(seg) {
            const labels = {
                'LUNCH': '„É©„É≥„ÉÅ',
                'DINNER': '„Éá„Ç£„Éä„Éº',
                'ALL': 'ÁµÇÊó•',
                'NIGHT': '„Éä„Ç§„Éà',
                'EVENT': 'ÂÆ¥‰ºö',
                'SUMMER': '„Éì„Ç¢„Ç¨„Éº„Éá„É≥'
            };
            return labels[seg] || seg;
        }

        // ========== „Éá„Éº„ÇøÈÄÅ‰ø° ==========
        async function submitData() {
            const btn = document.getElementById('submitBtn');
            const successMsg = document.getElementById('successMessage');

            btn.disabled = true;
            btn.textContent = 'ÈÄÅ‰ø°‰∏≠...';

            const baseId = document.getElementById('baseSelect').value;
            const base = CONFIG.bases.find(b => b.id === baseId);

            const data = {
                date: document.getElementById('inputDate').value,
                baseId: baseId,
                baseName: base.name,
                baseVisitors: parseInt(document.getElementById('baseVisitors').value) || 0,
                nightViewPoints: baseId === 'MOIWAYAMA'
                    ? parseInt(document.getElementById('nightViewPoints').value) || 0
                    : null,
                entries: []
            };

            // ÂêÑ„Çª„Ç∞„É°„É≥„Éà„Åã„Çâ„Éá„Éº„Çø„ÇíÂèéÈõÜ
            document.querySelectorAll('.segment-entry').forEach(entry => {
                const channelId = entry.dataset.channel;
                const segment = entry.dataset.segment;
                const channel = base.channels.find(c => c.id === channelId);
                const isBeerGarden = entry.dataset.isBeergarden === 'true';

                if (isBeerGarden) {
                    // „Éì„Ç¢„Ç¨„Éº„Éá„É≥Â∞ÇÁî®ÔºöÊôÇÈñìÂ∏ØÂà•„Éá„Éº„Çø
                    data.entries.push({
                        channelId: channelId,
                        channelName: channel ? channel.name : channelId,
                        segment: segment,
                        sales: parseInt(entry.querySelector('.sales-input').value) || 0,
                        visitors: parseInt(entry.querySelector('.visitors-input').value) || 0,
                        isBeerGarden: true,
                        weather12: entry.querySelector('.weather-12')?.value || '',
                        temp12: parseInt(entry.querySelector('.temp-12')?.value) || null,
                        weather15: entry.querySelector('.weather-15')?.value || '',
                        temp15: parseInt(entry.querySelector('.temp-15')?.value) || null,
                        weather18: entry.querySelector('.weather-18')?.value || '',
                        temp18: parseInt(entry.querySelector('.temp-18')?.value) || null
                    });
                } else {
                    // ÈÄöÂ∏∏„Çª„Ç∞„É°„É≥„Éà
                    data.entries.push({
                        channelId: channelId,
                        channelName: channel ? channel.name : channelId,
                        segment: segment,
                        sales: parseInt(entry.querySelector('.sales-input').value) || 0,
                        visitors: parseInt(entry.querySelector('.visitors-input').value) || 0,
                        weather: entry.querySelector('.weather-input')?.value || '',
                        temperature: parseInt(entry.querySelector('.temp-input')?.value) || null
                    });
                }
            });

            try {
                // APIÂëº„Å≥Âá∫„ÅóÔºà„Éá„Éó„É≠„Ç§Âæå„Å´ÊúâÂäπÂåñÔºâ
                if (API_URL !== 'YOUR_APPS_SCRIPT_WEB_APP_URL') {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        body: JSON.stringify(data)
                    });
                    const result = await response.json();
                    console.log('API Response:', result);
                } else {
                    // „Éá„É¢„É¢„Éº„Éâ: „Ç≥„É≥„ÇΩ„Éº„É´„Å´Âá∫Âäõ
                    console.log('ÈÄÅ‰ø°„Éá„Éº„Çø:', data);
                }

                successMsg.classList.remove('hidden');
                btn.textContent = 'ÈÄÅ‰ø°ÂÆå‰∫Ü';

                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = 'ÈÄÅ‰ø°„Åô„Çã';
                }, 3000);

            } catch (error) {
                console.error('Error:', error);
                btn.disabled = false;
                btn.textContent = '„Ç®„É©„Éº - ÂÜçË©¶Ë°å';
            }
        }
    </script>
</body>

</html>