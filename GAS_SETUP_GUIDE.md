# Cybozu Office to Google Calendar Sync - Setup Guide

このガイドでは、サイボウズ Officeの「iCalendar公開URL」を使って、Googleカレンダーにスケジュールを同期する方法を説明します。

## 手順 0: 管理者設定（メニューがない場合）

「iCalendar形式での出力」メニューが表示されない場合、管理者による設定が必要です。
もしSATさんが管理者の場合は、以下の2つの設定を行ってください。

### 1. cybozu.com 共通管理での設定
1.  画面右上の歯車アイコン → **「cybozu.com共通管理」** をクリック。
2.  左メニューの **「その他」**（または「システム設定」）→ **「公開URLの発行」** をクリック。
3.  **「サイボウズ Officeの公開URLの発行を許可する」** にチェックを入れて保存します。

### 2. サイボウズ Office システム設定
1.  画面右上の歯車アイコン → **「サイボウズ Officeシステム設定」** をクリック。
2.  **「詳細設定を開く」** をクリック。
3.  「各アプリケーション」の **「スケジュールと施設予約」** をクリック。
4.  **「iCalendar形式での出力」** をクリック。
5.  **「iCalendar形式での出力を許可する」** にチェックを入れ、対象ユーザー（または「すべてのユーザー」）を選択して「変更する」をクリック。

---

## 手順 1: iCalendar URLの取得（ユーザー操作）

管理者設定が完了すると、メニューが表示されるようになります。

1.  **サイボウズ Office** にログインします。
2.  画面右上の **「ユーザー名」** をクリックし、**「個人設定」** を選択します。
3.  **「各アプリケーションの設定」** タブ（またはセクション）にある **「スケジュールと施設予約」** をクリックします。
4.  **「iCalendar形式での出力」** をクリックします。
    *   *もしこのメニューがない場合、システム管理者が機能を許可していない可能性があります。管理者に「スケジュールのiCalendar出力を許可してください」と依頼してください。*
5.  **「iCalendar形式での出力を許可する」** にチェックを入れ、「変更する」をクリックします。
6.  表示された **URL**（`https://.../ag.cgi?page=ScheduleICal&...` のような長いURL）をすべてコピーします。
    *   **注意**: このURLを知っている人は誰でもあなたの予定を見れてしまうので、他人に教えないでください。

## 手順 2: Google Apps Script プロジェクトの作成

1.  [Google Apps Script](https://script.google.com/) にアクセスします。
2.  左上の **「新しいプロジェクト」** をクリックします。
3.  プロジェクト名を「Cybozu Sync」などに変更します。

## 手順 3: コードの貼り付け

1.  エディタの内容をすべて削除します。
2.  今回作成した `cybozu_sync.js` の中身をすべてコピーして貼り付けます。

## 手順 4: 設定の入力

コードの上部にある `CONFIG` セクションを書き換えます。

```javascript
const CONFIG = {
  // ★ここに手順1でコピーしたURLを貼り付けます
  CYBOZU_ICAL_URL: 'https://sapporo-dc.cybozu.com/o/ag.cgi?page=ScheduleICal&UID=...',

  // 同期先のGoogleカレンダーID（通常は 'primary'）
  GOOGLE_CALENDAR_ID: 'primary',

  // 同期する期間（今日から何日後までか）
  SYNC_DAYS_AFTER: 90, 
};
```

## 手順 5: 動作テスト

1.  ツールバーのプルダウンから **`testConnection`** を選択し、**「実行」** をクリックします。
2.  承認画面が出たら、自分のアカウントを選択し、「詳細」→「安全ではないページに移動」→「許可」と進みます。
3.  実行ログに `Connection Successful!` と表示されればOKです。

## 手順 6: 本番実行と自動化

1.  **`main`** 関数を選択して「実行」し、Googleカレンダーに予定が入るか確認します。
2.  左メニューの **「トリガー（時計アイコン）」** をクリックします。
3.  「トリガーを追加」ボタンを押し、以下のように設定します。
    *   実行する関数: `main`
    *   イベントのソース: `時間主導型`
    *   タイプ: `時間ベースのタイマー`
    *   間隔: `1時間おき`
4.  「保存」をクリックします。

これで設定完了です！
